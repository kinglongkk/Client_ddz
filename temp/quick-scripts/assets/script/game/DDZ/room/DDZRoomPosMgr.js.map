{"version":3,"sources":["DDZRoomPosMgr.js"],"names":["app","require","DDZRoomPosMgr","BaseClass","extend","Init","JS_Name","ComTool","subGameName","ShareDefine","WeChatManager","OnReload","Log","dataInfo","clientPos","downPos","upPos","facePos","posCount","OnInitRoomPosData","roomPosInfoList","heroImageUrlDict","heroID","GetHeroID","length","index","roomPosInfo","pos","pid","headImageUrl","InitHeroHeadImageByDict","GetRoomPlayerCount","UpdateOwnerID","ownerID","OnPosLeave","playerInfo","ErrLog","OnPosUpdate","posInfo","InitHeroHeadImage","OnPosIsReady","isReady","isCardReady","OnPosReadyChg","roomReady","OnPosContinueGame","OnSetEnd","setEnd","pointList","sportsPoint","sp","parseFloat","toFixed","addSp","sportsPointList","totalSp","real","addReal","totalReal","OnSportsPointChange","serverPack","posId","GetPlayerReadyState","roomSetID","ReadyState","GetPlayerInfoByPos","SetPlayerOfflineState","isLostConnect","isShowLeave","hasOwnProperty","GetRoomAllPlayerInfo","GetPlayerInfoByPid","i","SetPlayerInfoByPos","propertyName","propertyValue","GetClientPos","GetClientUpPos","GetClientDownPos","GetClientFacePos","GetPosCount","GetUIPosByDataPos","dataPos","playerCount","uiPos","g_DDZRoomPosMgr","exports","GetModel"],"mappings":"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","file":"DDZRoomPosMgr.js","sourceRoot":"../../../../../../../assets/script/game/DDZ/room","sourcesContent":["/*\r\n *  ----------------------------------------------------------------------------------------------------\r\n *  @copyright: Copyright (c) 2004, 2010 Xiamen DDM Network Technology Co.,Ltd., All rights reserved.\r\n *  ----------------------------------------------------------------------------------------------------\r\n *  @package SSSRoomPosMgr.js\r\n *  @todo: 十三水房间\r\n *\r\n *  @author hongdian\r\n *  @date 2014-10-30 16:04\r\n *  @version 1.0\r\n *\r\n *  修改时间 修改人 修改内容\r\n *  -------------------------------------------------------------------------------\r\n *\r\n */\r\nvar app = require(\"ddz_app\");\r\n\r\n/**\r\n * 类构造\r\n */\r\nvar DDZRoomPosMgr = app.BaseClass.extend({\r\n\r\n\t/**\r\n\t * 初始化\r\n\t */\r\n\tInit:function(){\r\n\r\n\t\tthis.JS_Name = \"DDZRoomPosMgr\";\r\n\r\n\t\tthis.ComTool = app[app.subGameName + \"_ComTool\"]();\r\n\t\tthis.ShareDefine = app[app.subGameName + \"_ShareDefine\"]();\r\n\t\tthis.WeChatManager = app[app.subGameName + \"_WeChatManager\"]();\r\n\r\n        // S2228_LostConnect\r\n        this.OnReload();\r\n\r\n\t\tthis.Log(\"Init\");\r\n\r\n\r\n\t},\r\n\r\n\tOnReload:function(){\r\n\t\t\r\n\t\tthis.dataInfo = {};\r\n\r\n\t\tthis.clientPos = -1;\r\n\t\tthis.downPos = -1;\r\n\t\tthis.upPos = -1;\r\n\t\tthis.facePos = -1;\r\n\t\tthis.posCount = -1;\r\n\t},\r\n\r\n\r\n\t//-----------------------回调函数-----------------------------\r\n\tOnInitRoomPosData:function(roomPosInfoList){\r\n\t\tthis.dataInfo = {};\r\n\r\n\t\tthis.clientPos = -1;\r\n\t\tthis.downPos = -1;\r\n\t\tthis.upPos = -1;\r\n\t\tthis.facePos = -1;\r\n\t\tthis.posCount = -1;\r\n\t\tlet heroImageUrlDict = {};\r\n\t\tlet heroID = app[app.subGameName + \"_HeroManager\"]().GetHeroID();\r\n\t\tthis.posCount = roomPosInfoList.length;\r\n\r\n\t\tfor(let index=0; index<this.posCount; index++){\r\n\t\t\tlet roomPosInfo = roomPosInfoList[index];\r\n\t\t\tlet pos = roomPosInfo[\"pos\"];\r\n\t\t\tthis.dataInfo[pos] = roomPosInfo;\r\n\r\n\t\t\tlet pid = roomPosInfo[\"pid\"];\r\n\t\t\tlet headImageUrl = roomPosInfo[\"headImageUrl\"];\r\n\t\t\tif(pid == heroID){\r\n\t\t\t\tthis.clientPos = pos;\r\n\t\t\t}\r\n\t\t\tif(pid && headImageUrl){\r\n\t\t\t\theroImageUrlDict[pid] = headImageUrl;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.WeChatManager.InitHeroHeadImageByDict(heroImageUrlDict);\r\n\t\t// if(this.clientPos < 0){\r\n\t\t// \tthis.ErrLog(\"OnInitRoomPosData clientPos not find\");\r\n\t\t// }\r\n\t\t// else{\r\n\t\t// \tlet posNum = 4;\r\n\t\t// \tif(this.posCount != 2){\r\n\t\t// \t\tthis.upPos = (this.clientPos + posNum - 1)%posNum;\r\n\t\t// \t\tthis.downPos = (this.clientPos + 1)%posNum;\r\n\t\t// \t\tthis.facePos = (this.clientPos + 2)%posNum;\r\n\r\n\t\t// \t}\r\n\t\t// \telse\r\n\t\t// \t\tthis.facePos = this.clientPos == 0 ? 1 : 0;\r\n\t\t\t\r\n\t\t// \tthis.Log(\"upPos(%s) clientPos(%s) downPos(%s) facePos(%s)\", this.upPos, this.clientPos, this.downPos, this.facePos);\r\n\t\t// }\r\n\r\n\t\tthis.upPos = (this.clientPos + this.posCount - 1)%this.posCount;\r\n\t\tthis.downPos = (this.clientPos + 1)%this.posCount;\r\n\t\tthis.facePos = (this.clientPos + 2)%this.posCount;\r\n\r\n\t\tthis.Log(\"OnInitRoomPosData:\", this.dataInfo)\r\n\t},\r\n\t//获取房间有几个玩家\r\n    GetRoomPlayerCount:function(){\r\n        return this.posCount;\r\n    },\r\n    UpdateOwnerID:function(ownerID){\r\n\t\tthis.dataInfo['ownerID']=ownerID;\r\n\t},\r\n\r\n\tOnPosLeave:function(pos){\r\n\t\tlet playerInfo = this.dataInfo[pos];\r\n\t\tif(!playerInfo){\r\n\t\t\tthis.ErrLog(\"OnPosLeave not find:%s\", pos);\r\n\t\t\treturn\r\n\t\t}\r\n\t\tplayerInfo[\"pid\"] = 0;\r\n\t\tplayerInfo[\"name\"] = 0;\r\n\t\tplayerInfo[\"roomReady\"] = false;\r\n\t\tplayerInfo[\"gameReady\"] = false;\r\n\t\tplayerInfo[\"giveUpGame\"] = 0;\r\n\t\tplayerInfo[\"point\"] = 0;\r\n\t\tplayerInfo[\"flashCnt\"] = 0;\r\n\t\tplayerInfo[\"paiPin\"] = 0;\r\n\t\tplayerInfo[\"up\"] = 0;\r\n\t\tplayerInfo[\"down\"] = 0;\r\n\t},\r\n\r\n\r\n\t//座位信息更新\r\n\tOnPosUpdate:function(pos, posInfo){\r\n\t\tlet playerInfo = this.dataInfo[pos];\r\n\t\tif(!playerInfo){\r\n\t\t\tthis.Log(\"OnPosUpdate not find:%s\", pos);\r\n\t\t\treturn false\r\n\t\t}\r\n\t\tthis.dataInfo[pos] = posInfo;\r\n\r\n\t\tlet heroID = posInfo[\"pid\"];\r\n\t\tlet headImageUrl = posInfo[\"headImageUrl\"];\r\n\t\tif(heroID && headImageUrl){\r\n\t\t\tthis.WeChatManager.InitHeroHeadImage(heroID, headImageUrl);\r\n\t\t}\r\n\r\n\t\treturn true\r\n\t},\r\n\r\n\tOnPosIsReady:function(pos, isReady){\r\n\t\tlet playerInfo = this.dataInfo[pos];\r\n\t\tif(!playerInfo){\r\n\t\t\tthis.Log(\"onPosTotalJifen not find:%s\", pos);\r\n\t\t\treturn false\r\n\t\t}\r\n\t\tplayerInfo.isCardReady = isReady;\r\n\t\t\r\n\t},\r\n\r\n\t//开局准备\r\n\tOnPosReadyChg:function(pos, roomReady){\r\n\t\tlet playerInfo = this.dataInfo[pos];\r\n\t\tif(!playerInfo){\r\n\t\t\tthis.Log(\"OnPosReadyChg not find:%s\", pos);\r\n\t\t\treturn false\r\n\t\t}\r\n\t\tplayerInfo[\"roomReady\"] = roomReady;\r\n\r\n\t\treturn true\r\n\t},\r\n\r\n\t//准备下一句\r\n\tOnPosContinueGame:function(pos){\r\n\t\tlet playerInfo = this.dataInfo[pos];\r\n\t\tif(!playerInfo){\r\n\t\t\tthis.ErrLog(\"OnPosContinueGame not find:%s\", pos);\r\n\t\t\treturn\r\n\t\t}\r\n\t\tplayerInfo[\"gameReady\"] = true;\r\n\t},\r\n\r\n\tOnSetEnd:function(setEnd){\r\n\t\t//清除准备状态\r\n\t\tfor(let pos in this.dataInfo){\r\n\t\t\tlet playerInfo = this.dataInfo[pos];\r\n\t\t\tplayerInfo[\"gameReady\"] = false;\r\n\t\t\tplayerInfo[\"point\"] += setEnd.pointList[pos];\r\n\t\t\tthis.dataInfo[pos]['point'] = playerInfo[\"point\"];\r\n\t\t    //比赛分\r\n\t        if (typeof(playerInfo.sportsPoint)!=\"undefined\") {\r\n\t            let sp = parseFloat(playerInfo[\"sportsPoint\"]).toFixed(2);\r\n\t            let addSp = parseFloat(setEnd.sportsPointList[pos]).toFixed(2);\r\n\t            let totalSp = parseFloat(sp) + parseFloat(addSp);\r\n\t            //保留小数点后面两位\r\n\t\t\t\tplayerInfo[\"sportsPoint\"] = totalSp.toFixed(2);\r\n\t            this.dataInfo[pos]['sportsPoint'] = totalSp.toFixed(2);\r\n\r\n\t            let real = parseFloat(playerInfo[\"realPoint\"]).toFixed(2);\r\n                let addReal = parseFloat(setEnd.sportsPointList[pos]).toFixed(2);\r\n                let totalReal = parseFloat(real) + parseFloat(addReal);\r\n                playerInfo[\"realPoint\"] = totalReal.toFixed(2);\r\n\t        }else{\r\n\t        \tlet real = parseFloat(playerInfo[\"realPoint\"]).toFixed(2);\r\n                let addReal = parseFloat(setEnd.pointList[pos]).toFixed(2);\r\n                let totalReal = parseFloat(real) + parseFloat(addReal);\r\n                playerInfo[\"realPoint\"] = totalReal.toFixed(2);\r\n\t        }\r\n\t\t}\r\n\r\n\t\t// this.OnPoint(setEnd.pointList);\r\n\t},\r\n\r\n\tOnSportsPointChange:function(serverPack){\r\n\t\t//同步更新比赛分\r\n\t\tfor(let pos in this.dataInfo){\r\n\t\t\tlet playerInfo = this.dataInfo[pos];\r\n\t\t\tif (pos == serverPack.posId &&\r\n\t\t\t\tplayerInfo.pid == serverPack.pid) {\r\n\t            let sp = parseFloat(playerInfo[\"sportsPoint\"]).toFixed(2);\r\n\t            let addSp = parseFloat(serverPack.sportsPoint).toFixed(2);\r\n\t            let totalSp = parseFloat(sp) + parseFloat(addSp);\r\n\t            //保留小数点后面两位\r\n\t\t\t\tplayerInfo[\"sportsPoint\"] = totalSp.toFixed(2);\r\n\t            this.dataInfo[pos]['sportsPoint'] = totalSp.toFixed(2);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t//更新积分，如果是断线重连不需要增加分数，直接同步服务端的分数就好\r\n\t// OnPoint:function(pointList, isReconnect = false){\r\n\t// \tfor(let pos in this.dataInfo){\r\n\t// \t\tlet playerInfo = this.dataInfo[pos];\r\n\t// \t\tif(isReconnect){\r\n\t// \t\t\tplayerInfo[\"point\"] = pointList[pos].point;\r\n\t// \t\t}\r\n\t// \t\telse{\r\n\t// \t\t\tplayerInfo[\"point\"] += pointList[pos];\r\n\t// \t\t}\r\n\t// \t}\r\n\t// },\r\n\r\n\t//-------------------------获取接口---------------------\r\n\t//获取客户端玩家准备状态\r\n\tGetPlayerReadyState:function (roomSetID) {\r\n        let ReadyState = \"\";\r\n        if(roomSetID > 0){\r\n            ReadyState = \"gameReady\";\r\n        }\r\n        else {\r\n            ReadyState = \"roomReady\";\r\n        }\r\n\t\treturn this.GetPlayerInfoByPos(this.clientPos)[ReadyState];\r\n    },\r\n\r\n\t//设置玩家离线状态\r\n\tSetPlayerOfflineState:function (pos, isLostConnect, isShowLeave) {\r\n\t\tif(!this.dataInfo.hasOwnProperty(pos)){\r\n\t\t\tthis.ErrLog(\"SetPlayerOfflineState not find:%s\", pos);\r\n\t\t\treturn\r\n\t\t}\r\n\t\tthis.dataInfo[pos][\"isLostConnect\"] = isLostConnect;\r\n\t\tthis.dataInfo[pos][\"isShowLeave\"] = isShowLeave;\r\n    },\r\n\r\n\t//获取房间所有玩家信息\r\n\tGetRoomAllPlayerInfo:function(){\r\n\t\treturn this.dataInfo\r\n\t},\r\n\r\n\tGetPlayerInfoByPid:function(pid){\r\n\t\tfor(let i in this.dataInfo){\r\n\t\t\tif(pid == this.dataInfo[i].pid)\r\n\t\t\t\treturn this.dataInfo[i];\r\n\t\t}\r\n        return null;\r\n    },\r\n\r\n\t//获取房间指定位置玩家信息\r\n\tGetPlayerInfoByPos:function(pos){\r\n\t\tif(!this.dataInfo.hasOwnProperty(pos)){\r\n\t\t\tthis.ErrLog(\"GetPlayerInfoByPos(%s) not find\", pos);\r\n\t\t\treturn\r\n\t\t}\r\n\t\treturn this.dataInfo[pos];\r\n\t},\r\n\r\n\t//设置房间指定位置玩家指定字段信息\r\n\tSetPlayerInfoByPos:function(pos, propertyName, propertyValue){\r\n\t\tif(!this.dataInfo.hasOwnProperty(pos)){\r\n\t\t\tthis.ErrLog(\"SetPlayerInfoByPos(%s) not find\", pos);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.dataInfo[pos][propertyName] = propertyValue;\r\n\t},\r\n\r\n\t//获取客户端玩家的座位\r\n\tGetClientPos:function(){\r\n\t\treturn this.clientPos\r\n\t},\r\n\r\n\t//获取客户端玩家的上家位置ID\r\n\tGetClientUpPos:function(){\r\n\t\treturn this.upPos\r\n\t},\r\n\r\n\t//获取客户端玩家下家位置ID\r\n\tGetClientDownPos:function(){\r\n\t\treturn this.downPos\r\n\t},\r\n\r\n\t//获取客户端玩家对家位置ID\r\n\tGetClientFacePos:function(){\r\n\t\treturn this.facePos\r\n\t},\r\n\r\n\t//获取开设房间位置的数量\r\n\tGetPosCount:function(){\r\n\t\treturn this.posCount;\r\n\t},\r\n\r\n\t//服务端位置转客户端位置\r\n\tGetUIPosByDataPos:function(dataPos){\r\n\t\tlet playerCount = this.posCount;\r\n\t\tlet uiPos = (dataPos + (playerCount - this.clientPos)) % playerCount;\r\n\t\t//如果是两人场，是对面做，用0和2位置\r\n\t\t//如果是三人场，是使用0,1,3位置\r\n\t\t// if (playerCount == 2 && uiPos == 1) {\r\n\t\t// \tuiPos = 2;\r\n\t\t// }else if (playerCount == 3 && uiPos == 2) {\r\n\t\t// \tuiPos = 3;\r\n\t\t// }\r\n\t\r\n\t\treturn uiPos;\r\n\t}\r\n})\r\n\r\n\r\nvar g_DDZRoomPosMgr = null;\r\n\r\n/**\r\n * 绑定模块外部方法\r\n */\r\nexports.GetModel = function(){\r\n\tif(!g_DDZRoomPosMgr)\r\n\t\tg_DDZRoomPosMgr = new DDZRoomPosMgr();\r\n\treturn g_DDZRoomPosMgr;\r\n\r\n}\r\n"]}