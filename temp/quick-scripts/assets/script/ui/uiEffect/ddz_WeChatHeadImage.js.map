{"version":3,"sources":["ddz_WeChatHeadImage.js"],"names":["app","require","cc","Class","extends","subGameName","properties","onLoad","isLoadEnd","JS_Name","node","name","HeroAccountManager","ddz_HeroAccountManager","HeroManager","ddz_HeroManager","SysDataManager","ddz_SysDataManager","ShareDefine","ddz_ShareDefine","ControlManager","ddz_ControlManager","WeChatManager","ddz_WeChatManager","IntegrateImage","GetTableDict","defaultManHeadPath","defaultWoMenHeadPath","headSprite","getComponent","Sprite","heroID","RegEvent","Event_RefreshHeadImageSprite","event","heroIDList","InArray","spriteFrame","GetHeroHeadSpriteFrame","OnReloadHeroHead","heroSex","ShowHeroHead","bMag","console","log","that","defaultHeadPath","HeroSex_Boy","CreateLoadPromise","SpriteFrame","then","catch","error"],"mappings":"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","file":"ddz_WeChatHeadImage.js","sourceRoot":"../../../../../../assets/script/ui/uiEffect","sourcesContent":["var app = require(\"ddz_app\");\r\n\r\ncc.Class({\r\n\textends: require(app.subGameName + \"_BaseComponent\"),\r\n\r\n\tproperties: {\r\n\t},\r\n\r\n\t// use this for initialization\r\n\tonLoad: function () {\r\n\t\tif(this.isLoadEnd)\r\n\t\t\treturn;\r\n\t\tthis.isLoadEnd = true;\r\n\t\tthis.JS_Name = this.node.name + \"_WeChatHeadImage\";\r\n\t\tthis.HeroAccountManager = app.ddz_HeroAccountManager();\r\n\t\tthis.HeroManager = app.ddz_HeroManager();\r\n\t\tthis.SysDataManager = app.ddz_SysDataManager();\r\n\t\tthis.ShareDefine = app.ddz_ShareDefine();\r\n\t\tthis.ControlManager = app.ddz_ControlManager();\r\n\t\tthis.WeChatManager = app.ddz_WeChatManager();\r\n\t\tthis.IntegrateImage = this.SysDataManager.GetTableDict(\"IntegrateImage\")\r\n\t\tthis.defaultManHeadPath = this.IntegrateImage[\"DefaultManHead\"][\"FilePath\"];\r\n\t\tthis.defaultWoMenHeadPath = this.IntegrateImage[\"DefaultWomenHead\"][\"FilePath\"];\r\n\r\n\t\tthis.headSprite = this.node.getComponent(cc.Sprite);\r\n\t\tthis.heroID = 0;\r\n\t\tapp[app.subGameName + \"Client\"].RegEvent(\"RefreshHeadImageSprite\", this.Event_RefreshHeadImageSprite, this);\r\n\t},\r\n\r\n\t/*//显示\r\n\tonEnable:function(){\r\n\t\tapp[app.subGameName + \"Client\"].RegEvent(\"RefreshHeadImageSprite\", this.Event_RefreshHeadImageSprite, this);\r\n\t},\r\n\r\n\t//关闭时\r\n\tonDisable:function(){\r\n\t\tapp[app.subGameName + \"Client\"].UnRegTargetEvent(this);\r\n\t},*/\r\n\r\n\tEvent_RefreshHeadImageSprite:function(event){\r\n\t\tlet heroIDList = event[\"HeroIDList\"]||[];\r\n\t\tif(heroIDList.InArray(this.heroID)){\r\n\t\t\tlet spriteFrame = this.WeChatManager.GetHeroHeadSpriteFrame(this.heroID);\r\n\t\t\tthis.headSprite.spriteFrame = spriteFrame\r\n\t\t}\r\n\t},\r\n\tOnReloadHeroHead:function(heroID, heroSex=0){\r\n\r\n\t},\r\n\t//显示微信头像\r\n\tShowHeroHead:function(heroID, heroSex=0){\r\n\t\tlet bMag = false;\r\n\t\tif(this.WeChatManager)\r\n\t\t\tbMag = true;\r\n\t\tconsole.log('ShowHeroHead bMag = ' + bMag);\r\n\t\tif(!this.WeChatManager){\r\n\t\t\t// this.ErrLog(\"ShowHeroHead(%s) not active\", heroID);\r\n\t\t\treturn\r\n\t\t}\r\n\t\tthis.heroID = heroID;\r\n\r\n\t\tlet spriteFrame = this.WeChatManager.GetHeroHeadSpriteFrame(heroID);\r\n\t\tlet that = this;\r\n\r\n\r\n\t\tif(spriteFrame){\r\n\t\t\tconsole.log('ShowHeroHead bMag spriteFrame = ' + true);\r\n\t\t\tthis.headSprite.spriteFrame = spriteFrame\r\n\t\t}\r\n\t\telse{\r\n\t\t\tconsole.log('ShowHeroHead bMag spriteFrame = ' + false);\r\n\t\t\tlet defaultHeadPath = \"\";\r\n\t\t\tif(heroSex == this.ShareDefine.HeroSex_Boy){\r\n\t\t\t\tdefaultHeadPath = this.defaultManHeadPath;\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\tdefaultHeadPath = this.defaultWoMenHeadPath;\r\n\t\t\t}\r\n\r\n\t\t\t//清空图片\r\n\t\t\tthis.headSprite.spriteFrame = null;\r\n\r\n\t\t\tthis.ControlManager.CreateLoadPromise(defaultHeadPath, cc.SpriteFrame)\r\n\t\t\t\t\t\t\t\t.then(function(spriteFrame){\r\n\t\t\t\t\t\t\t\t\tif(!spriteFrame){\r\n\t\t\t\t\t\t\t\t\t\t// that.ErrLog(\"defaultHeadPath:%s not find\", defaultHeadPath);\r\n\t\t\t\t\t\t\t\t\t\treturn\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t//如果已经被设置了图片过滤,有可能Event_RefreshHeadImageSprite回调设置了微信头像\r\n\t\t\t\t\t\t\t\t\tif(that.headSprite.spriteFrame){\r\n\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\t\t\t\tthat.headSprite.spriteFrame = spriteFrame\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t.catch(function(error){\r\n\t\t\t\t\t\t\t\t\t// that.ErrLog(\"error:%s\", error.stack);\r\n\t\t\t\t\t\t\t\t})\r\n\r\n\t\t}\r\n\t},\r\n});\r\n"]}