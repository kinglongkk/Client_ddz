{"version":3,"sources":["ddz_UIChat.js"],"names":["app","require","cc","Class","extends","subGameName","properties","EditBox","layout_face","Node","layout_chat","scr_chat","scr_typing","sp_face","sp_chat","sp_typing","layout_record","typing_kuang","btn_send","OnCreateInit","OnShow","RoomMgr","DDZRoomMgr","roomID","GetEnterRoom","GetRoomProperty","string","active","idx","children","length","node","content","isShow","i18n","t","ErrLog","getChildByName","getComponent","Label","OnClickForm","OnClick","btnName","btnNode","Click_btn_send","Click_btn_face","Click_btn_chat","Click_btn_typing","CloseForm","startsWith","Click_Btn","ddz_NetManager","SendPack","GetChatMessageRecord","bind","ddz_GameManager","SendChat","quickID","parseInt","substring","serverPack","removeAllChildren","list","data","anchorX","label","addComponent","fontSize","lineHeight","horizontalAlign","HorizontalAlign","LEFT","enableWrapText","overflow","Overflow","RESIZE_HEIGHT","senderName","width","color","addChild"],"mappings":"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","file":"ddz_UIChat.js","sourceRoot":"../../../../../assets/script/ui","sourcesContent":["var app = require(\"ddz_app\");\r\ncc.Class({\r\n    extends: require(app.subGameName + \"_BaseForm\"),\r\n\r\n    properties: {\r\n        EditBox:cc.EditBox,\r\n        layout_face:cc.Node,\r\n        layout_chat:cc.Node,\r\n        scr_chat:cc.Node,\r\n        scr_typing:cc.Node,\r\n        sp_face:cc.Node,\r\n        sp_chat:cc.Node,\r\n        sp_typing:cc.Node,\r\n        layout_record:cc.Node,\r\n        typing_kuang:cc.Node,\r\n        btn_send:cc.Node,\r\n    },\r\n\r\n    OnCreateInit: function () {\r\n\t\t\r\n    },\r\n\r\n    OnShow:function () {\r\n\t\tthis.RoomMgr = app.DDZRoomMgr();\r\n\t\tlet roomID = this.RoomMgr.GetEnterRoom().GetRoomProperty(\"roomID\");\r\n        this.EditBox.string = \"\";\r\n\r\n        //this.scr_chat.active = false;\r\n        this.scr_chat.active = true;\r\n        this.scr_typing.active = false;\r\n        this.layout_face.active = true;\r\n        this.sp_face.active = true;\r\n        this.sp_chat.active = false;\r\n        this.sp_typing.active = false;\r\n        //this.typing_kuang.active = false;\r\n        //this.btn_send.active = false;\r\n        this.typing_kuang.active = true;\r\n        this.btn_send.active = true;\r\n        for(let idx=0; idx < this.layout_chat.children.length; idx++){\r\n            let node = this.layout_chat.children[idx];\r\n            let content = \"\";\r\n            let isShow = true;\r\n            switch (idx){\r\n\t            case 0:\r\n\t\t            content = app.i18n.t(\"UIVoiceStringBieChao\");\r\n\t\t            break;\r\n\t            case 1:\r\n\t\t            content = app.i18n.t(\"UIVoiceStringBieZou\");\r\n\t\t            break;\r\n\t            case 2:\r\n\t\t            content = app.i18n.t(\"UIVoiceStringZhaoHu\");\r\n\t\t            break;\r\n\t            case 3:\r\n\t\t            content = app.i18n.t(\"UIVoiceStringZanLi\");\r\n\t\t            break;\r\n\t            case 4:\r\n\t\t            content = app.i18n.t(\"UIVoiceStringZanShang\");\r\n\t\t            break;\r\n\t            case 5:\r\n\t\t            content = app.i18n.t(\"UIVoiceStringCuiCu\");\r\n\t\t            break;\r\n\t            case 6:\r\n\t\t            content = app.i18n.t(\"UIVoiceStringKuaJiang\");\r\n\t\t            break;\r\n\t            default:\r\n\t\t            isShow=false;\r\n\t\t            this.ErrLog(\"Event_chatmessage not find(%s)\",idx);\r\n            }\r\n            node.active=isShow;\r\n            node.getChildByName(\"lb_chat\").getComponent(cc.Label).string = content;\r\n        }\r\n    },\r\n\r\n\r\n    //-----------------回调函数------------------\r\n\r\n    //---------点击函数---------------------\r\n    OnClickForm:function(){\r\n     //   this.CloseForm();\r\n    },\r\n\r\n    OnClick:function(btnName, btnNode){\r\n        if(btnName == \"btn_send\"){\r\n            this.Click_btn_send();\r\n        }\r\n        else if(btnName == \"btn_face\"){\r\n            this.Click_btn_face();\r\n        }\r\n        else if(btnName == \"btn_chat\"){\r\n            this.Click_btn_chat();\r\n        }\r\n        else if(btnName == \"btn_typing\"){\r\n            this.Click_btn_typing();\r\n        }\r\n        else if(btnName == \"btn_close\"){\r\n            this.CloseForm();\r\n        }\r\n        else if(btnName.startsWith(\"btn_\")){\r\n            this.Click_Btn(btnName);\r\n        }\r\n        else{\r\n            this.ErrLog(\"OnClick(%s) not find btnName\",btnName);\r\n        }\r\n    },\r\n    Click_btn_face:function(){\r\n        this.scr_chat.active = false;\r\n        this.scr_typing.active = false;\r\n        this.layout_face.active = true;\r\n        this.sp_face.active = true;\r\n        this.sp_chat.active = false;\r\n        this.sp_typing.active = false;\r\n        this.typing_kuang.active = false;\r\n        this.btn_send.active = false;\r\n    },\r\n    Click_btn_chat:function(){\r\n        this.layout_face.active = false;\r\n        this.scr_chat.active = true;\r\n        this.scr_typing.active = false;\r\n        this.sp_face.active = false;\r\n        this.sp_chat.active = true;\r\n        this.sp_typing.active = false;\r\n        this.typing_kuang.active = false;\r\n        this.btn_send.active = false;\r\n    },\r\n    Click_btn_typing:function(){\r\n        this.layout_face.active = false;\r\n        this.scr_chat.active = false;\r\n        this.scr_typing.active = true;\r\n        this.sp_face.active = false;\r\n        this.sp_chat.active = false;\r\n        this.sp_typing.active = true;\r\n        this.typing_kuang.active = true;\r\n        this.btn_send.active = true;\r\n        let roomID = this.RoomMgr.GetEnterRoom().GetRoomProperty(\"roomID\");\r\n        app.ddz_NetManager().SendPack(\"game.SChatMessageHandler\",{\"roomID\":roomID}, this.GetChatMessageRecord.bind(this));\r\n    },\r\n    Click_btn_send:function () {\r\n        let content = this.EditBox.string;\r\n        if(!content || \"\" == content)return;\r\n        let roomID = this.RoomMgr.GetEnterRoom().GetRoomProperty(\"roomID\");\r\n        app.ddz_GameManager().SendChat(5, 0, roomID, content);\r\n        this.EditBox.string = \"\";\r\n        this.CloseForm();\r\n    },\r\n    Click_Btn:function (btnName){\r\n        let quickID = 0;\r\n        if(btnName.startsWith(\"btn_face\")){\r\n            quickID = parseInt(btnName.substring(btnName.length - 3));\r\n        }\r\n        else if(btnName.startsWith(\"btn_chat\")){\r\n            quickID = parseInt(btnName.substring(btnName.length - 2));\r\n        }\r\n        let roomID = this.RoomMgr.GetEnterRoom().GetRoomProperty(\"roomID\");\r\n        let content = \"\";\r\n        \r\n        app.ddz_GameManager().SendChat(5, quickID, roomID, content);\r\n        \r\n        this.CloseForm();\r\n    },\r\n\r\n    GetChatMessageRecord:function(serverPack){\r\n        this.layout_record.removeAllChildren();\r\n        let list = serverPack;\r\n\r\n        if(!list.length) return;\r\n\r\n        for(let idx = 0; idx < list.length; idx++){\r\n            let data = list[idx];\r\n            if(data.content == \"\") continue;\r\n            let node = new cc.Node();\r\n            node.anchorX = 0;\r\n            let label = node.addComponent(cc.Label);\r\n            label.fontSize  = 30;\r\n            label.lineHeight = 35;\r\n            label.horizontalAlign = cc.Label.HorizontalAlign.LEFT;\r\n            label.enableWrapText = true;\r\n            label.overflow = cc.Label.Overflow.RESIZE_HEIGHT;\r\n            let string = data.senderName + \":\" + data.content;\r\n            label.string = string;\r\n            node.width = this.layout_record.width;\r\n            node.color=cc.color(82,98,69);\r\n            this.layout_record.addChild(node);\r\n        }\r\n\r\n        //this.scr_typing.getComponent(cc.ScrollView).scrollToBottom(2.0);\r\n    },\r\n\r\n});"]}