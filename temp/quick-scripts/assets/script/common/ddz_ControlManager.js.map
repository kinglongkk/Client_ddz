{"version":3,"sources":["ddz_ControlManager.js"],"names":["app","require","ddz_ControlManager","BaseClass","extend","Init","JS_Name","catchDataDict","CreateLoadPromise","resPath","resType","that","hasOwnProperty","loadData","bluebird","resolve","promisefunc","reject","cc","loader","loadRes","error","ErrLog","stack","CreateLoadPromiseByUrl","load","CreateLoadDirPromise","loadResAll","loadDataList","ReleaseAllRes","key","console","log","indexOf","releaseRes","g_ddz_ControlManager","exports","GetModel"],"mappings":"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","file":"ddz_ControlManager.js","sourceRoot":"../../../../../assets/script/common","sourcesContent":["/*\r\n    控制器管理器\r\n*/\r\nvar app = require(\"ddz_app\");\r\n\r\nvar ddz_ControlManager = app.BaseClass.extend({\r\n\r\n    Init:function(){\r\n        this.JS_Name = app[\"subGameName\"] + \"_ControlManager\";\r\n\r\n        this.catchDataDict = {};\r\n    },\r\n\r\n    //---------------加载资源-----------------\r\n\r\n    //创建异步下载资源对象\r\n    CreateLoadPromise:function(resPath, resType=\"\"){\r\n        let that = this;\r\n\t    //如果已经加载\r\n\t    if(this.catchDataDict.hasOwnProperty(resPath)){\r\n\t\t    let loadData = this.catchDataDict[resPath];\r\n\t\t    return app.bluebird.resolve(loadData)\r\n\t    }\r\n        \r\n        // let gamePath = jsb.fileUtils.getSearchPaths() + \"resources/\" + resPath;\r\n        \r\n        //创建异步函数\r\n        let promisefunc = function(resolve, reject){\r\n            //加载资源\r\n            \r\n            cc.loader.loadRes(resPath, resType, function (error, loadData) {\r\n                if(error){\r\n                    reject(error);\r\n                    that.ErrLog(\"CreateLoadPromise failed resPath(%s) resType(%s), error:%s\", resPath, resType, error.stack);\r\n                    that.ErrLog(\"CreateLoadPromise loadData(%s)\", loadData);\r\n                    \r\n                    return\r\n                }\r\n                that.catchDataDict[resPath] = loadData;\r\n\r\n                resolve(loadData);\r\n            })};\r\n        //返回异步对象\r\n        return new app.bluebird(promisefunc);\r\n    },\r\n\r\n    //加载JSON文件 cc.url.raw('resources/json/' + jsonFileName + \".json\");\r\n    CreateLoadPromiseByUrl:function(resPath){\r\n        let that = this;\r\n\r\n        //创建异步函数\r\n        let promisefunc = function(resolve, reject){\r\n            //加载资源\r\n            cc.loader.load(resPath, function (error, loadData) {\r\n\r\n                if(error){\r\n                    reject(error);\r\n                    return\r\n                }\r\n\r\n                resolve(loadData);\r\n            })};\r\n        //返回异步对象\r\n        return new app.bluebird(promisefunc);   \r\n    },\r\n\r\n    //创建异步下载文件夹所有文件对象\r\n    CreateLoadDirPromise:function(resPath, resType=\"\"){\r\n        //创建异步函数\r\n        let promisefunc = function(resolve, reject){\r\n            //加载资源\r\n            cc.loader.loadResAll(resPath, resType, function (error, loadDataList) {\r\n\r\n                if(error){\r\n                    reject(error);\r\n                    return\r\n                }\r\n\r\n                resolve(loadDataList);\r\n            })};\r\n        //返回异步对象\r\n        return new app.bluebird(promisefunc);\r\n    },\r\n\r\n    //---------------释放资源-----------------\r\n    ReleaseAllRes:function(){\r\n        for(var key in this.catchDataDict){\r\n            console.log(\"ReleaseAllRes key:\" + key);\r\n            if (key.indexOf(\"jsonData\") > -1) {\r\n                //只释放配表资源\r\n                cc.loader.releaseRes(key);\r\n            }\r\n        }\r\n        this.catchDataDict = {};\r\n    },\r\n});\r\n\r\n\r\nvar g_ddz_ControlManager = null;\r\n\r\n/**\r\n * 绑定模块外部方法\r\n */\r\nexports.GetModel = function(){\r\n    if(!g_ddz_ControlManager){\r\n        g_ddz_ControlManager = new ddz_ControlManager();\r\n    }\r\n    return g_ddz_ControlManager;\r\n}"]}