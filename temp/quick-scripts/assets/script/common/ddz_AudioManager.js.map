{"version":3,"sources":["ddz_AudioManager.js"],"names":["app","require","ddz_AudioManager","BaseClass","extend","Init","JS_Name","subGameName","audioFileName","recordFileName","recordPos","isRecording","isVoiceTouchEnd","audioList","RegEvent","OnEvent_PlayAudioFinish","OnEvent_AudioError","OnEvent_AudioStopError","OnEvent_MedioRecordError","OnEvent_wellPrepared","ddz_NetManager","RegNetPack","OnPack_SPlayer_Voice","OnEvt_AmrFileDownLoadFinish","OnEvt_RecordAudioFinsh","OnDestory","setHeadInfo","stopRecord","stopPlayAudio","setSound","flag","value","LocalDataManager","GetConfigProperty","ddz_SceneManager","RecoverySceneMusic","ddz_SoundManager","PauseAllSound","pos","OnEvent","checkAudioList","length","audioInfo","shift","playAudioOrDownLoad","setTouchEnd","startRecord","IsAudio","ddz_SysNotifyManager","ShowSysMsg","that","setTimeout","pausePlayAudio","getFileName","argList","ddz_NativeManager","CallToNative","ddz_FormManager","CloseForm","sendRecordFile","cc","sys","isNative","data","jsb","fileUtils","getDataFromFile","url","httpRequest","ActiveXObject","e","XMLHttpRequest","open","setRequestHeader","onerror","ErrLog","onreadystatechange","SysLog","status","responseText","receivePack","JSON","parse","sendAudioURLToServer","readyState","send","downLoadRecordFile","serverURL","LocalURL","downLoadMgr","ddz_DownLoadMgr","DownFile","urls","RoomMgr","DDZRoomMgr","room","GetEnterRoom","roomID","GetRoomProperty","SendPack","serverPack","GetEnterRoomID","push","GetRoomPosMgr","GetClientPos","resumePlayAudio","playAudio","filename","event","ShowForm","timestamp","Date","valueOf","storagePath","getWritablePath","AccountID","ddz_HeroAccountManager","GetAccountProperty","fileName","Math","random","g_ddz_AudioManager","exports","GetModel"],"mappings":"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","file":"ddz_AudioManager.js","sourceRoot":"../../../../../assets/script/common","sourcesContent":["/*\r\n录音管理器\r\n */\r\nvar app = require(\"ddz_app\");\r\n\r\nvar ddz_AudioManager = app.BaseClass.extend({\r\n\r\n    Init:function(){\r\n        this.JS_Name = app.subGameName + \"_AudioManager\";\r\n        \r\n        this.audioFileName = \"\"; //播放录音文件位置\r\n        this.recordFileName = \"\";//录音文件\r\n        \r\n        this.recordPos = null; //录音位置\r\n\r\n        this.isRecording = false; //是否正在录音\r\n\r\n        this.isVoiceTouchEnd = false;\r\n\r\n        this.audioList = [];\r\n\r\n        //播放录音完成\r\n        app[app.subGameName + \"Client\"].RegEvent(\"palyAudioFinsh\",           this.OnEvent_PlayAudioFinish,   this);\r\n        //录音失败\r\n        app[app.subGameName + \"Client\"].RegEvent(\"AudioError\",               this.OnEvent_AudioError,        this);\r\n        //录音停止失败\r\n        app[app.subGameName + \"Client\"].RegEvent(\"AudioStopError\",           this.OnEvent_AudioStopError,        this);\r\n        //播放失败\r\n        app[app.subGameName + \"Client\"].RegEvent(\"MedioRecordError\",         this.OnEvent_MedioRecordError,  this);\r\n        //准备录音\r\n        app[app.subGameName + \"Client\"].RegEvent(\"wellPrepared\",             this.OnEvent_wellPrepared,      this);\r\n        //收到其他玩家播放语音\r\n        app.ddz_NetManager().RegNetPack(\"SPlayer_Voice\",    this.OnPack_SPlayer_Voice,      this);\r\n        //下载完成\r\n        app[app.subGameName + \"Client\"].RegEvent(\"AMRFILEDOWNLOADFINISH\",    this.OnEvt_AmrFileDownLoadFinish, this);\r\n        //录音完成\r\n        app[app.subGameName + \"Client\"].RegEvent(\"RECORDAUDIOFINSH\",         this.OnEvt_RecordAudioFinsh,    this);\r\n    },\r\n\r\n    //销毁\r\n    OnDestory:function(){\r\n        this.setHeadInfo(false);\r\n        this.audioFileName = \"\";\r\n        this.recordFileName = \"\";\r\n\r\n        this.recordPos = null;\r\n        this.isRecording = false;\r\n\r\n        this.audioList = [];\r\n        this.stopRecord();\r\n        this.stopPlayAudio();\r\n    },\r\n\r\n    //开关背景音乐\r\n    setSound:function(flag){\r\n        let value = app.LocalDataManager().GetConfigProperty(\"SysSetting\",\"BackMusic\");\r\n        if(value){\r\n            if(flag){\r\n                app.ddz_SceneManager().RecoverySceneMusic();\r\n                // app.ddz_SoundManager().ResumeAllSound();\r\n            }else{\r\n                app.ddz_SoundManager().PauseAllSound();\r\n            }\r\n        }\r\n    },\r\n\r\n\r\n    //设置是否显示语音\r\n    setHeadInfo:function(flag, pos ){\r\n        app[app.subGameName + \"Client\"].OnEvent('Head_AudioNtf',{'bShow':flag,'pos':pos});\r\n        if(flag){\r\n            // let that = this;\r\n            // // cc.director.getScene().getChildByName(\"Canvas\").scheduleOnce(OnTimer, 100.0); \r\n            // setTimeout(function(){\r\n            //     app[app.subGameName + \"Client\"].OnEvent('Head_AudioNtf',{'bShow':false,'pos':pos});\r\n            // },100.0);\r\n        }\r\n    },\r\n\r\n    //判断是否还有语音播放\r\n    checkAudioList:function(){\r\n        this.setHeadInfo(false);\r\n        \r\n        if(this.audioList.length > 0){\r\n            let audioInfo = this.audioList.shift();\r\n            this.playAudioOrDownLoad(audioInfo);\r\n        }else{\r\n            this.setSound(true);\r\n\r\n            // this.setHeadInfo(false);\r\n        }\r\n    },\r\n\r\n    //设置是否是touchEnd\r\n    setTouchEnd:function(flag){\r\n        this.isVoiceTouchEnd = flag;\r\n    },\r\n\r\n    //开始录音\r\n    startRecord:function(){\r\n        let IsAudio = app.LocalDataManager().GetConfigProperty(\"SysSetting\", \"IsAudio\");\r\n        if(!IsAudio){\r\n            app.ddz_SysNotifyManager().ShowSysMsg('MSG_AUDIO_DONOT_AUDIO');\r\n            return;\r\n        }\r\n        if(this.isRecording){\r\n            app.ddz_SysNotifyManager().ShowSysMsg('MSG_LAST_RECORDING');\r\n            return;\r\n        }\r\n        this.isRecording = true;\r\n        \r\n        var that = this;\r\n        // cc.director.getScene().getChildByName(\"Canvas\").scheduleOnce(OnTimer, 20.0); \r\n\r\n        setTimeout(function(){\r\n            that.isRecording = false;\r\n        },20.0);\r\n        \r\n        this.isVoiceTouchEnd = false;\r\n\r\n        this.setSound(false);\r\n        this.pausePlayAudio();\r\n\r\n        this.audioFileName = this.getFileName();\r\n\r\n        let argList = [{\"Name\":\"fileName\",\"Value\":this.audioFileName}];\r\n        let value =   app.ddz_NativeManager().CallToNative(\"startRecord\", argList);  \r\n    },\r\n\r\n    //停止录音\r\n    stopRecord:function(){\r\n        app.ddz_FormManager().CloseForm(app.subGameName + \"_UIAudio\");\r\n        let value =   app.ddz_NativeManager().CallToNative(\"stopRecord\", []);\r\n    },\r\n\r\n    //发送文件到服务器\r\n    sendRecordFile:function(){\r\n\r\n        if(this.audioFileName == null || this.audioFileName == \"\") return;\r\n        \r\n        if(!cc.sys.isNative) return;\r\n\r\n        var data = jsb.fileUtils.getDataFromFile(this.audioFileName);\r\n\r\n        var url = \"http://voice.qp355.com:8080\";\r\n        //每次都实例化一个，否则会引起请求结束，实例被释放了\r\n        var httpRequest = null;\r\n        try {\r\n                httpRequest =  new ActiveXObject (\"Microsoft.XMLHTTP\");\r\n        }catch(e){\r\n            try {\r\n                httpRequest = new XMLHttpRequest();\r\n            }catch(e) {\r\n                \r\n            }\r\n        }\r\n        httpRequest.open(\"POST\", url, true);\r\n        httpRequest.setRequestHeader(\"Access-Control-Allow-Origin\", \"*\");\r\n        httpRequest.setRequestHeader('Content-Type', 'application/octet-stream');\r\n        httpRequest.setRequestHeader(\"Content-Type\", \"application/json\");\r\n        httpRequest.setRequestHeader(\"Content-Type\", \"multipart/form-data;\");\r\n\r\n\r\n        var that = this;\r\n        httpRequest.onerror = function(){\r\n            that.ErrLog(\"sendRecordFile httpRequest.error:%s\", url);\r\n            app.ddz_SysNotifyManager().ShowSysMsg('MSG_AUDIO_SEND_FAIL');\r\n        };\r\n        \r\n        httpRequest.onreadystatechange = function(){\r\n            that.SysLog(\"onreadystatechange httpRequest.status:%s, httpRequest.responseText:%s\",httpRequest.status, httpRequest.responseText);\r\n            //执行成功\r\n            if (httpRequest.status == 200){\r\n                \r\n                var receivePack = JSON.parse(httpRequest.responseText);\r\n                that.SysLog(\"sendRecordFile receivePack[status]:%s,receivePack[url]:%s\", receivePack[\"status\"],receivePack[\"url\"]);\r\n                if(receivePack[\"status\"] == 1){\r\n                    that.sendAudioURLToServer(receivePack[\"url\"]);\r\n                }else{\r\n                    that.SysLog(\"sendRecordFile receivePack[status]=2 msg:%s\", receivePack[\"msg\"]);\r\n                    app.ddz_SysNotifyManager().ShowSysMsg('MSG_AUDIO_SEND_FAIL');\r\n                }\r\n            }\r\n            else{\r\n                app.ddz_SysNotifyManager().ShowSysMsg('MSG_AUDIO_SEND_FAIL');\r\n                that.ErrLog(\"onreadystatechange(%s,%s)\", httpRequest.readyState, httpRequest.status);\r\n            }\r\n        };\r\n        httpRequest.send(data);\r\n    },\r\n\r\n    //下载文件\r\n    downLoadRecordFile:function(serverURL, LocalURL){\r\n        let downLoadMgr = app.ddz_DownLoadMgr();\r\n        downLoadMgr.DownFile(serverURL, LocalURL, \"deleteString\", \"AMRFILEDOWNLOADFINISH\");\r\n    },\r\n\r\n    //---------------发包接口------------------------\r\n    //将URL上传到服务器\r\n    sendAudioURLToServer:function(urls){\r\n        let RoomMgr =app.DDZRoomMgr();\r\n        let room =  RoomMgr.GetEnterRoom();\r\n        let roomID = room.GetRoomProperty(\"roomID\");\r\n\r\n        app.ddz_NetManager().SendPack(\"game.CPlayerVoice\", {\"roomID\":roomID,  \"url\":urls});\r\n\r\n        this.isRecording = false;\r\n\r\n    },\r\n\r\n    //----------------封包借口\r\n    //收到回话\r\n    OnPack_SPlayer_Voice:function(serverPack){\r\n        let IsAudio = app.LocalDataManager().GetConfigProperty(\"SysSetting\", \"IsAudio\");\r\n        if(!IsAudio){\r\n            app.ddz_SysNotifyManager().ShowSysMsg('MSG_AUDIO_DONOT_AUDIO');\r\n            return;\r\n        }\r\n\r\n        let urls    = serverPack[\"url\"];\r\n\r\n        let RoomMgr =app.DDZRoomMgr();\r\n        let room = RoomMgr.GetEnterRoom();\r\n\r\n        //不是自己房间\r\n        if(RoomMgr.GetEnterRoomID() != serverPack[\"roomID\"]) return;\r\n\r\n        this.audioList.push({\"pos\":serverPack[\"pos\"], \"url\":serverPack[\"url\"], \"fileName\": this.audioFileName});\r\n        if(this.audioFileName != \"\" && room.GetRoomPosMgr().GetClientPos() != serverPack[\"pos\"]){ //正在录音\r\n            return;\r\n        }\r\n        //录音完成\r\n        else if(this.audioFileName != \"\" && room.GetRoomPosMgr().GetClientPos() == serverPack[\"pos\"]){\r\n            if(this.recordFileName != \"\"){\r\n                this.resumePlayAudio();\r\n            }else{\r\n                this.checkAudioList();\r\n            }\r\n\r\n        }else if( this.recordFileName != \"\"){ //上一个播放没有完成\r\n            //this.resumePlayAudio();\r\n            return;\r\n        }\r\n        //没有录音\r\n        else{\r\n            this.checkAudioList();\r\n        }\r\n        this.audioFileName = \"\";\r\n    },\r\n\r\n    ///-------------------------\r\n\r\n    //下载或播放语音\r\n    playAudioOrDownLoad:function(audioInfo){\r\n        let IsAudio = app.LocalDataManager().GetConfigProperty(\"SysSetting\", \"IsAudio\");\r\n        if(!IsAudio){\r\n            app.ddz_SysNotifyManager().ShowSysMsg('MSG_AUDIO_DONOT_AUDIO');\r\n            return;\r\n        }\r\n       \r\n        //自己直接播放\r\n        let RoomMgr =app.DDZRoomMgr();\r\n        let room = RoomMgr.GetEnterRoom();\r\n        \r\n        if(room.GetRoomPosMgr().GetClientPos() == audioInfo[\"pos\"]){\r\n            if(this.recordFileName == \"\"){\r\n                this.recordFileName = audioInfo[\"fileName\"];\r\n                this.recordPos =  audioInfo[\"pos\"];\r\n                this.playAudio(this.recordFileName, audioInfo[\"pos\"]);\r\n            }else{\r\n                this.resumePlayAudio();\r\n            }\r\n        }else{\r\n            this.recordFileName = this.getFileName();\r\n            this.recordPos =  audioInfo[\"pos\"];\r\n            this.downLoadRecordFile(audioInfo[\"url\"], this.recordFileName);\r\n        }\r\n    },\r\n\r\n    //播放语音\r\n    playAudio:function(filename, pos){\r\n        if(filename == \"\"){\r\n            return ;\r\n        }\r\n        \r\n        this.setHeadInfo(false);\r\n\r\n        this.setSound(false);\r\n\r\n        let argList = [{\"Name\":\"fileName\",\"Value\":filename}];\r\n        let value =   app.ddz_NativeManager().CallToNative(\"playerRecord\", argList); \r\n       \r\n        this.setHeadInfo(true, pos);\r\n    },\r\n\r\n    //停止语音\r\n    stopPlayAudio:function(){\r\n        this.setHeadInfo(false);\r\n        let value =   app.ddz_NativeManager().CallToNative(\"stopPlayerRecord\", []); \r\n    },\r\n\r\n    //暂停播放\r\n    pausePlayAudio:function(){\r\n        if(this.recordFileName == \"\"){\r\n            return;\r\n        }\r\n        \r\n        app.ddz_NativeManager().CallToNative(\"pausePlayerRecord\", []); \r\n    },\r\n    \r\n    //继续播放\r\n    resumePlayAudio:function(){\r\n        app.ddz_NativeManager().CallToNative(\"resumePlayerRecord\", []); \r\n    },\r\n\r\n\r\n    ///------------------------------事件-----------------------\r\n    //语音播放完成\r\n    OnEvent_PlayAudioFinish:function(event){\r\n        app.ddz_FormManager().CloseForm(app.subGameName + \"_UIAudio\");\r\n\r\n        this.recordFileName = \"\";\r\n\r\n        this.setHeadInfo(false);\r\n\r\n        this.recordPos = null;\r\n\r\n        this.checkAudioList();\r\n    },\r\n    //录制语音失败\r\n    OnEvent_AudioError:function(event){\r\n\r\n        app.ddz_SysNotifyManager().ShowSysMsg('MSG_AUDIO_ERROR');\r\n\r\n        this.stopRecord();\r\n        \r\n        this.audioFileName = \"\";\r\n        this.isRecording = false;\r\n\r\n        app.ddz_FormManager().CloseForm(app.subGameName + \"_UIAudio\");\r\n        this.checkAudioList();\r\n    },\r\n    //录制停止语音失败\r\n    OnEvent_AudioStopError:function(event){\r\n\r\n        app.ddz_SysNotifyManager().ShowSysMsg('MSG_AUDIO_STOP_ERROR');\r\n\r\n        this.audioFileName = \"\";\r\n        this.isRecording = false;\r\n\r\n        app.ddz_FormManager().CloseForm(app.subGameName + \"_UIAudio\");\r\n        this.checkAudioList();\r\n    },\r\n    //播放语音失败\r\n    OnEvent_MedioRecordError:function(event){\r\n        this.setHeadInfo(false);\r\n        \r\n        app.ddz_SysNotifyManager().ShowSysMsg('MSG_PLAY_RECORD_ERROR');\r\n\r\n        this.recordFileName = \"\";\r\n        this.recordPos = null;\r\n        this.checkAudioList();\r\n    },\r\n    //准备录制\r\n    OnEvent_wellPrepared:function(event){\r\n        if(this.isVoiceTouchEnd){ \r\n            this.audioFileName = \"\";\r\n            this.isRecording = false;\r\n    \r\n            app.ddz_FormManager().CloseForm(app.subGameName + \"_UIAudio\");\r\n            this.checkAudioList();\r\n            return;\r\n        }\r\n        this.setSound(false);\r\n        app.ddz_FormManager().ShowForm(app.subGameName + \"_UIAudio\");\r\n    },\r\n\r\n    //文件下载完成\r\n    OnEvt_AmrFileDownLoadFinish:function(event){\r\n        this.playAudio(this.recordFileName, this.recordPos);\r\n    },\r\n\r\n    //录音完成\r\n    OnEvt_RecordAudioFinsh:function(event){\r\n        this.sendRecordFile();  \r\n    },\r\n\r\n    //获取文件名\r\n    getFileName:function(){\r\n        var timestamp = (new Date()).valueOf();\r\n        let storagePath = '/';\r\n        if(cc.sys.isNative){\r\n            storagePath = jsb ? (jsb.fileUtils ? jsb.fileUtils.getWritablePath() : '/') : '/';\r\n        }\r\n        let AccountID = app.ddz_HeroAccountManager().GetAccountProperty(\"AccountID\");\r\n        let fileName = storagePath + AccountID + timestamp + Math.random()%16 + \".amr\";\r\n        return fileName;\r\n    },\r\n});\r\n\r\n\r\nvar g_ddz_AudioManager = null;\r\n  /**\r\n  ...\r\n  */\r\nexports.GetModel = function(){\r\n    if(!g_ddz_AudioManager){\r\n        g_ddz_AudioManager = new ddz_AudioManager();\r\n    }\r\n    return g_ddz_AudioManager;\r\n}"]}