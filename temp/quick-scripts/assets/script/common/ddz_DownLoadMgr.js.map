{"version":3,"sources":["ddz_DownLoadMgr.js"],"names":["app","require","DownLoadstate","DwonLoadState_Finish","DwonLoadState_Error","DwonLoadState_Progress","ddz_DownLoadMgr","BaseClass","extend","extends","cc","Component","properties","Init","JS_Name","subGameName","serverUrl","loaclPath","fileName","downloadType","count","OnTimer","passSecond","ddz_SysNotifyManager","ShowSysMsg","DownFile","Director","getInstance","getScheduler","unschedule","OnConFirm","clickType","msgID","backArgList","ErrLog","localPath","argList","value","ddz_NativeManager","CallToNative","OnDownFileFinish","serverPack","OnEvent","OnDownFileError","isScheduled","schedule","OnDownFileProgress","OnDownLoadEvent","DownLoadMgr","GetDownLoadStateError","GetDownLoadStateFinish","GetDownLoadStateProgress","apply","g_ddz_DownLoadMgr","exports","GetModel"],"mappings":"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","file":"ddz_DownLoadMgr.js","sourceRoot":"../../../../../assets/script/common","sourcesContent":["/*\r\n    下载管理类\r\n */\r\nvar app = require(\"ddz_app\");\r\n\r\nvar DownLoadstate = function(){\r\n    //下载事件\r\n    this.DwonLoadState_Finish       = 0;//下载完成\r\n    this.DwonLoadState_Error        = 1;//下载失败\r\n    this.DwonLoadState_Progress     = 2;//下载进度\r\n};\r\n\r\nvar ddz_DownLoadMgr = app.BaseClass.extend({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n\r\n    },\r\n\r\n    Init:function(){\r\n        this.JS_Name = app.subGameName + \"_DownLoadMgr\";\r\n        \r\n        this.serverUrl = null;\r\n        this.loaclPath = null;\r\n        this.fileName = null;\r\n        this.downloadType  = null;\r\n        this.count = 0\r\n\r\n\r\n        //下载事件\r\n        //this.DwonLoadState_Finish       = 0;//下载完成\r\n        //this.DwonLoadState_Error        = 1;//下载失败\r\n        //this.DwonLoadState_Progress     = 2;//下载进度\r\n\r\n        //this.DownFile(\"http://voice.qp355.com:8080/mp3/20170705/1499260230432a2c41d49b5575fab91b8fd37f5e16.amr\", \"/data/user/0/com.ddmh5.p7/files/100191499260129329.amr\", \"deleteString\",  \"AMRFILEDOWNLOADFINISH\" );\r\n    },\r\n\r\n    //1秒回掉\r\n    OnTimer:function(passSecond){\r\n        app.ddz_SysNotifyManager().ShowSysMsg(\"MSG_DOWNLOAD_ERROR\");\r\n        this.count++;\r\n        // if(this.count > 3){\r\n        //     let msgID = \"Net_ReconnectConnectFail\";\r\n        //     let ConfirmManager = app.ddz_ConfirmManager();\r\n        //     ConfirmManager.SetWaitForConfirmForm(this.OnConFirm.bind(this), msgID, []);\r\n        //     ConfirmManager.ShowConfirm(app.ddz_ShareDefine().ConfirmOK, msgID, [])\r\n\r\n        //     cc.Director.getInstance().getScheduler().unschedule(this.OnTimer, this);\r\n        //     return;\r\n        // }\r\n        this.DownFile(this.serverUrl, this.loaclPath, this.fileName, this.downloadType);\r\n        cc.Director.getInstance().getScheduler().unschedule(this.OnTimer, this);\r\n    },\r\n\r\n    //确认框点击\r\n    OnConFirm:function(clickType, msgID, backArgList){\r\n        if(clickType != \"Sure\"){\r\n            return\r\n        }\r\n\r\n        //如果是尝试继续重连\r\n        if(msgID == \"Net_ReconnectConnectFail\"){\r\n            this.DownFile(this.serverUrl, this.loaclPath, this.fileName, this.downloadType);\r\n        }else{\r\n            this.ErrLog(\"OnConFirm:%s\", msgID);\r\n        }\r\n    },\r\n\r\n    //下载文件  filename 没有值是设置为deleteString\r\n    DownFile:function(serverUrl, localPath, fileName,  downloadType ){\r\n        if(serverUrl == null || localPath == null || downloadType == null){\r\n            this.ErrLog(\"DownFile serverUrl == null || localPath == null || downloadType == null\");\r\n            return;\r\n        }\r\n        this.serverUrl = serverUrl;\r\n        this.loaclPath = localPath;\r\n        this.fileName = fileName;\r\n        this.downloadType  = downloadType;\r\n        //this.count = 0\r\n        let argList = [{\"Name\":\"urls\",\"Value\":serverUrl},{\"Name\":\"fileName\",\"Value\":fileName},{\"Name\":\"savePath\",\"Value\":localPath},{\"Name\":\"downloadType\",\"Value\":downloadType}];\r\n        let value =   app.ddz_NativeManager().CallToNative(\"downLoadFile\", argList);   \r\n    },\r\n\r\n    //下载完成\r\n    OnDownFileFinish:function(serverPack){\r\n        app[app.subGameName + \"Client\"].OnEvent(serverPack[\"downloadType\"], serverPack);\r\n\r\n        this.serverUrl = null;\r\n        this.loaclPath = null;\r\n        this.fileName = null;\r\n        this.downloadType  = null;\r\n        this.count = 0\r\n    },\r\n\r\n    //下载失败\r\n    OnDownFileError:function(serverPack){\r\n        app[app.subGameName + \"Client\"].OnEvent(serverPack[\"downloadType\"], serverPack);\r\n\r\n        if(! cc.Director.getInstance().getScheduler().isScheduled(this.OnTimer, this)) {\r\n            cc.Director.getInstance().getScheduler().schedule(this.OnTimer, this, 3.0);\r\n        }\r\n\r\n        \r\n    },\r\n\r\n    //下载进度\r\n    OnDownFileProgress:function(serverPack){\r\n        //app[app.subGameName + \"Client\"].OnEvent(serverPack[\"downloadType\"], {\"progress\": serverPack[\"proess\"]});\r\n        app[app.subGameName + \"Client\"].OnEvent(serverPack[\"downloadType\"], serverPack);\r\n    },\r\n\r\n    //下载事件\r\n    OnDownLoadEvent:function(serverPack){\r\n        if(serverPack[\"state\"] == DownLoadMgr.DwonLoadState_Finish){\r\n            this.OnDownFileFinish(serverPack);\r\n        }else if(serverPack[\"state\"] == DownLoadMgr.DwonLoadState_Error){\r\n            this.OnDownFileError(serverPack);\r\n        }else if (serverPack[\"state\"] == DownLoadMgr.DwonLoadState_Progress){\r\n            this.OnDownFileProgress(serverPack);\r\n        }\r\n    },\r\n\r\n    //获取失败标识\r\n    GetDownLoadStateError:function(){\r\n        return DownLoadMgr.DwonLoadState_Error;\r\n    },\r\n    //获取成功标识\r\n    GetDownLoadStateFinish:function(){\r\n        return DownLoadMgr.DwonLoadState_Finish;\r\n    },\r\n    //获取进度标识\r\n    GetDownLoadStateProgress:function(){\r\n        return DownLoadMgr.DwonLoadState_Progress;\r\n    },\r\n});\r\n\r\n\r\nDownLoadstate.apply(ddz_DownLoadMgr, []);\r\n\r\nvar g_ddz_DownLoadMgr = null;\r\n  /**\r\n  ...\r\n  */\r\nexports.GetModel = function(){\r\n    if(!g_ddz_DownLoadMgr){\r\n        g_ddz_DownLoadMgr = new ddz_DownLoadMgr();\r\n    }\r\n    return g_ddz_DownLoadMgr;\r\n}"]}