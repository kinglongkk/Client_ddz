{"version":3,"sources":["ddz_SysNotifyManager.js"],"names":["app","require","ddz_SysNotifyManager","BaseClass","extend","Init","JS_Name","subGameName","SysDataManager","ddz_SysDataManager","NewSysMsg","GetTableDict","ComTool","ddz_ComTool","ShareDefine","ddz_ShareDefine","regExpDict","ddz_NetManager","RegNetPack","OnPack_ServerSysMsg","serverPack","msgID","key","argList","p","count","length","msgArgList","index","data","push","ShowSysMsg","OnEvent","GetSysMsgContentByMsgID","paramList","hasOwnProperty","ErrLog","msgInfo","msgContent","TranslateMsgContent","param","argIndex","regExpObj","regKeyString","StringAddNumSuffix","indexOf","RegExp","replace","msgPos","ddz_FormManager","ShowForm","console","log","ConfirmOK","ConfirmManager","ddz_ConfirmManager","SetWaitForConfirmForm","OnConFirm","bind","ShowConfirm","ConfirmYN","clickType","backArgList","g_ddz_SysNotifyManager","exports","GetModel"],"mappings":"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","file":"ddz_SysNotifyManager.js","sourceRoot":"../../../../../assets/script/common","sourcesContent":["/*\r\n *  ----------------------------------------------------------------------------------------------------\r\n *  @copyright: Copyright (c) 2004, 2010 Xiamen DDM Network Technology Co.,Ltd., All rights reserved.\r\n *  ----------------------------------------------------------------------------------------------------\r\n *  @package SysNotifyManager.js\r\n *  @todo: 系统通知模块\r\n *  \r\n *  @author hongdian\r\n *  @date 2014-10-30 16:04\r\n *  @version 1.0\r\n *  \r\n *  修改时间 修改人 修改内容\r\n *  -------------------------------------------------------------------------------\r\n *  \r\n */\r\nvar app = require(\"ddz_app\");\r\n\r\n/**\r\n * 类构造\r\n */\r\nvar ddz_SysNotifyManager = app.BaseClass.extend({\r\n\t\r\n\t/**\r\n\t * 初始化\r\n\t */\r\n\tInit:function(){\r\n\r\n\t\tthis.JS_Name = app.subGameName + \"_SysNotifyManager\";\r\n\t\t\r\n\t\tthis.SysDataManager = app.ddz_SysDataManager();\r\n\t\tthis.NewSysMsg = this.SysDataManager.GetTableDict(\"NewSysMsg\");\r\n\r\n\t\tthis.ComTool = app.ddz_ComTool();\r\n\t\tthis.ShareDefine = app.ddz_ShareDefine();\r\n\r\n\t\t//缓存的正则表达式字典\r\n\t\tthis.regExpDict = {};\r\n\r\n\t\tapp.ddz_NetManager().RegNetPack(\"S1010_SystemMessage\", this.OnPack_ServerSysMsg, this);\r\n\t\t\r\n\t},\r\n\r\n\r\n\t//-----------------------回调函数-----------------------------\r\n\t/**\r\n\t * 接收封包\r\n\t */\r\n\tOnPack_ServerSysMsg:function(serverPack){\r\n\t\t//系统提示码\r\n\t\tlet msgID = serverPack.key;\r\n\t\tlet argList = serverPack.p||[];\r\n\r\n\t\tlet count = argList.length;\r\n\t\tlet msgArgList = [];\r\n\t\tfor(let index=0; index<count; index++){\r\n\r\n\t\t\tlet data = argList[index];\r\n\r\n\t\t\tif(data[\"StringValue\"]){\r\n\t\t\t\tmsgArgList.push(data[\"StringValue\"]);\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\tmsgArgList.push(data[\"IntValue\"]);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.ShowSysMsg(msgID, msgArgList);\r\n\r\n\t\tapp[app.subGameName + \"Client\"].OnEvent(\"ServerSysMsg\", {\"MsgID\":msgID, \"MsgArgList\":msgArgList});\r\n\t},\r\n\r\n\t//-----------------------获取函数-----------------------------\r\n\r\n\t//获取系统提示文本\r\n\tGetSysMsgContentByMsgID:function(msgID, paramList){\r\n\r\n\t\tif(!paramList){\r\n\t\t\tparamList = [];\r\n\t\t}\r\n\t\t//如果查找不到系统提示码,则为纯文本弹框提示直接播放不解码\r\n\t\tif(!this.NewSysMsg.hasOwnProperty(msgID)){\r\n\t\t\tthis.ErrLog(\"GetSysMsgContentByMsgID(%s) NewSysMsg.txt not find\", msgID);\r\n\t\t\treturn \"\"\r\n\t\t}\r\n\t\tlet msgInfo = this.NewSysMsg[msgID];\r\n\t\tlet msgContent = msgInfo['Content'];\r\n\r\n\t\treturn this.TranslateMsgContent(msgContent, paramList);\r\n\r\n\t},\r\n\r\n\t/**\r\n\t * 替换消息文本\r\n\t * @param msgID 消息ID\r\n\t * @return 无返回值\r\n\t * @remarks \r\n\t */\r\n\tTranslateMsgContent:function(msgContent, paramList){\r\n\r\n\t\tlet count = paramList.length;\r\n\r\n\t\t// 替换文本\r\n\t\tfor(let index=0; index<=count; index++){\r\n\r\n\t\t\tlet param = paramList[index];\r\n\t\t\tlet argIndex = index + 1;\r\n\t\t\tlet regExpObj = null;\r\n\r\n\r\n\t\t\tlet regKeyString = this.ComTool.StringAddNumSuffix(\"S\", argIndex, 1);\r\n\t\t\tif(msgContent.indexOf(regKeyString) != -1){\r\n\r\n\t\t\t\tif(this.regExpDict.hasOwnProperty(regKeyString)){\r\n\t\t\t\t\tregExpObj = this.regExpDict[regKeyString];\r\n\t\t\t\t}\r\n\t\t\t\telse{\r\n\t\t\t\t\tregExpObj = new RegExp(\"{\" + regKeyString + \"}\", \"g\");\r\n\t\t\t\t\tthis.regExpDict[regKeyString] = regExpObj\r\n\t\t\t\t}\r\n\t\t\t\tmsgContent = msgContent.replace(regExpObj, param);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn msgContent\r\n\t},\r\n\t\r\n\t/**\r\n\t * 显示系统提示\r\n\t * @param msgID\r\n\t */\r\n\tShowSysMsg:function(msgID, msgArgList=[]){\r\n\t\tlet msgContent = \"\";\r\n\t\tlet msgPos = 0;\r\n\t\t//如果查找不到系统提示码,则为纯文本弹框提示直接播放不解码\r\n\t\tif(this.NewSysMsg.hasOwnProperty(msgID)){\r\n\t\t\tlet msgInfo = this.NewSysMsg[msgID];\r\n\t\t\tmsgPos = msgInfo[\"Pos\"];\r\n\r\n\t\t\tmsgContent = msgInfo['Content'];\r\n\t\t\tmsgContent = this.TranslateMsgContent(msgContent, msgArgList);\r\n\t\t}\r\n\t\telse{\r\n\t\t\tmsgPos = 4;\r\n\t\t\tmsgContent = msgID;\r\n\t\t}\r\n\r\n\r\n\t\t//出现位置 1系统广播(不允许主动调用这种类型,只能又聊天系统频道下发)\r\n\t\tif(msgPos == 1){\r\n\t\t\tthis.ErrLog(\"ShowSysMsg(%s) error\", msgID);\r\n\t\t}\r\n\t\t//只触发事件不显示提示,由事件自己决定(服务端下发客户端弹2次确认框等待点击)\r\n\t\telse if(msgPos == 2){\r\n\r\n\t\t}\r\n\t\t//浮动提示\r\n\t\telse if(msgPos == 3){\r\n\t\t\tapp.ddz_FormManager().ShowForm(app.subGameName + \"_UIMessage_Drift\", msgID, msgArgList, msgContent);\r\n\t\t}\r\n\t\t//\"确定\" 弹框提示\r\n\t\telse if(msgPos == 4){\r\n\t\t\tconsole.log(\"msgContent ==\" + msgContent);\r\n\t\t\tapp.ddz_FormManager().ShowForm(app.subGameName + \"_UIMessage\", \"OnSys\", this.ShareDefine.ConfirmOK, msgID, msgArgList, msgContent);\r\n\r\n\t\t}\r\n\t\t//\"是\",\"否\"\" 弹框提示\r\n\t\telse if(msgPos == 5){\r\n\t\t\tlet ConfirmManager = app.ddz_ConfirmManager();\r\n\t\t\tConfirmManager.SetWaitForConfirmForm(this.OnConFirm.bind(this), msgID, []);\r\n\t\t\tConfirmManager.ShowConfirm(this.ShareDefine.ConfirmYN, msgID, msgArgList)\r\n\t\t}\r\n\t\telse{\r\n\t\t\tthis.ErrLog(\"ShowSysMsg(%s) msgPos(%s) error\", msgID, msgPos);\r\n\t\t}\r\n\t},\r\n\r\n    OnConFirm:function(clickType, msgID, backArgList){\r\n    \tif(clickType == \"Sure\"){\r\n    \t\t// this.Log(\"打开客服QQ\");\r\n    \t}\r\n    },\r\n\r\n})\r\n\r\n\r\nvar g_ddz_SysNotifyManager = null;\r\n\r\n/**\r\n * 绑定模块外部方法\r\n */\r\nexports.GetModel = function(){\r\n\tif(!g_ddz_SysNotifyManager)\r\n\t\tg_ddz_SysNotifyManager = new ddz_SysNotifyManager();\r\n\treturn g_ddz_SysNotifyManager;\r\n\t\r\n}\r\n"]}