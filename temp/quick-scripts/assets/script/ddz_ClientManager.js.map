{"version":3,"sources":["ddz_ClientManager.js"],"names":["app","require","subGameName","ddz_ClientManager","cc","Class","extends","properties","globalEffect","Node","reConnectTip","onLoad","console","log","JS_Name","logSecond","isWriteLog","sys","isNative","game","addPersistRootNode","node","StartTimer","schedule","OnTimer","systemEvent","on","SystemEvent","EventType","KEY_DOWN","OnKeyDown","ShareDefineModel","GetModel","ComToolModel","ControlManagerModel","RegisterHideShowEvent","localStorage","setItem","testData","getItem","CanUse","removeItem","ErrLog","LocalDataManagerModel","LocalDataManager","NativeManagerModel","NativeManager","clientState","State_Prepare","nextTick","lastHearTime","LostHearTime","isFirstLogin","debugModel","lastReConnectTime","reConnectUseTime","bStartReConnect","reConnectLable","getChildByName","getComponent","Label","startUpInfo","clientConfig","gameType","InitLaunchParameter","isAllReadyRelogin","InitDebug","isDebug","IsDevelopment","debugPrefab","debugNode","instantiate","OnCreate","error","stack","para","CallToNative","href","window","location","index","indexOf","substr","paraList","length","split","count","paraInfo","paraDataList","OnPack_LuckDrawReceive","serverPack","OnEvent","OnPack_HeartBeat","Date","getTime","bBeatFlag","SendPack","SpeedTest","bind","isFaXinTiao","yanci","OnPack_BaseLogin","HeroAccountManager","accountID","GetAccountProperty","nickName","headImageUrl","sex","InitLoginData","NetManager","InitConnectAccountID","GetHeroID","OnPack_RoleTest","SetAccountProperty","OnPack_OnHeroLogin","heroID","State_Logined","State_LoginPackFail","ShowSysMsg","OnPack_PlayerInfo","OnEvent_InitPlayerFamily","event","SendGetCurRoomID","SetGameType","typeStr","OnEvent_LoginGetCurRoomID","roomID","allSwitchGameData","switchGameData","push","JSON","parse","isShowVideo","i","action","FormManager","ShowForm","fromName","LoadScene","practiceId","roomKey","that","toUpperCase","OnStartEnterGame","SendGetRoomInfo","OnEvent_ConnectSuccess","bIsReconnect","OnPack_GetGameStatus","isPlayingGame","SceneManager","sceneType","GetSceneType","ExitGame","OnEvent_ReloadHeroData","eventName","OnPack_Kickout","kickOutType","LogOutGame","OnPack_Online","onlineHour","OnNativeNotify","eventType","eventDataString","dataDict","OnNativeNotifyWXLogin","OnNativeNotifyWXShare","OnNativeNotifyWXPay","OnDownLoadEvent","OnGetLocationCallBack","update","dt","passSecond","State_WaitLogin","curTime","isConnectIng","Disconnect","StartReConnect","ReConnectByTipSureBtn","string","StopTimer","unschedule","OnEventHide","curRunGame","OnEventShow","scheduleOnce","OnInitClientData","clientPath","appVersion","State_InitSuccess","OnInitClientFinish","allTableDataDict","RefreshClientConfig","debug","CheckDebugSign","InitModel","InitTable","InitManager","dump","e","LoadLogin","ClientLoginProcess","SendRequestWeChatSDKIntSign","dbGameServerInfo","GetConfigProperty","dbAccountServerInfo","dbOrderServerInfo","dbResServerInfo","gameServerIP","gameServerPort","accountServerIP","accountServerPort","orderServerIP","orderServerPort","resServerIP","resServerPort","accountType","orderType","AccountSDKTypeNameDict","hasOwnProperty","SDKType_Company","OrderSDKTypeNameDict","OrderType_Company","ddmchannel","ddmmp","SDKType_WeChat","OrderType_Wechat","modelName","NeedCreateList","SysDataManager","allTableNameList","Object","keys","tableName","tableInfo","OnLoadTableEnd","startUrl","origin","SetH5ClientStartUrl","RegNetPack","OnEvent_SPlayerContinue","RegEvent","InitSDKParameter","argDict","emit","userName","shortPlayer","name","paymentRoomCardType","func","target","UnRegTargetEvent","off","targetOff","keyCode","KEY","back","msgID","ConfirmManager","SetWaitForConfirmForm","OnConFirm","ShowConfirm","Confirm","clickType","backArgList","end","IsClientLoginOK","SetClientState","code","SetConfigProperty","GetSceneComponent","WarnLog","OnTopEvent","ClearClientData","OnReload","debugSign","argKeyList","sort","keyCount","signString","keyName","join","sign","MD5","hex_md5","GetDebugModel","MultiPoint","serverIP","GetClientConfigProperty","AccessPoint","AccountActive","myCityID","CityPoints","CityPointsList","GetClientConfig","mt","key","InArray","property","GetStartUpProperty","GetGlobalEffectNode","effectName","effectNode","removeFromParent","PushGlobalEffectNode","addChild","GetIsFirstLogin","SetFirstLogin","active","CloseReConnectTip","RemoveClientManager","removePersistRootNode","loadFormDict","showFormDict","createingFormDict","formWndShowInfo","defaultFormNameList","ReleaseAllRes","EVENT_HIDE","EVENT_SHOW","baseForm","_eventFuncDict","destroy","isInGame","isOutRoom","roomMgr","clubId","unionId","stringify","curRunHall","self","StopAllSound","isReconnecting","gamePath","jsb","fileUtils","getWritablePath","UnRegisterHideShowEvent","module","exports"],"mappings":"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","file":"ddz_ClientManager.js","sourceRoot":"../../../../assets/script","sourcesContent":["/*\r\n    客户端初始化管理类(该组件节点不会被释放，只有切换小游戏才会释放)\r\n*/\r\n\r\nvar app = require(\"ddz_app\");\r\nrequire(app.subGameName + \"_NativeNotify\");\r\nvar ddz_ClientManager = cc.Class({\r\n\r\n    extends: require(app.subGameName + \"_BaseComponent\"),\r\n\r\n    properties: {\r\n    \tglobalEffect:cc.Node,\r\n\t    reConnectTip:cc.Node,\r\n    },\r\n    // 加载JS主入口\r\n    onLoad: function () {\r\n    \tconsole.log(app.subGameName + \" ----- ClientManager onLoad-----\");\r\n        this.JS_Name = app[\"subGameName\"] + \"_ClientManager\";\r\n\r\n\t    this.logSecond = 0;\r\n\t    //是否需要写log\r\n\t    this.isWriteLog = cc.sys.isNative;\r\n\r\n        //保证客户端管理器不被释放\r\n        cc.game.addPersistRootNode(this.node);\r\n\r\n        this.StartTimer();\r\n        \r\n        this.schedule(this.OnTimer, 0.1);\r\n\r\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.OnKeyDown, this);\r\n\r\n        //把Client存放到App上\r\n        app[app.subGameName + \"Client\"] = this;\r\n\r\n\t\t//枚举管理器\r\n\t    let ShareDefineModel = require(app.subGameName + \"_ShareDefine\").GetModel;\r\n\t    app[app.subGameName + \"_ShareDefine\"] = ShareDefineModel;\r\n        this[app.subGameName + \"_ShareDefine\"] = ShareDefineModel();\r\n\r\n\t    //工具模块\r\n\t    let ComToolModel = require(app.subGameName + \"_ComTool\").GetModel;\r\n\t    app[app.subGameName + \"_ComTool\"] = ComToolModel;\r\n\t    this[app.subGameName + \"_ComTool\"] = ComToolModel();\r\n\r\n\t    //加载控制器\r\n\t    let ControlManagerModel = require(app.subGameName + \"_ControlManager\").GetModel;\r\n\t    app[app.subGameName + \"_ControlManager\"] = ControlManagerModel;\r\n\t    this[app.subGameName + \"_ControlManager\"] = ControlManagerModel();\r\n\r\n\t\tthis.RegisterHideShowEvent();\r\n\t    //检测是否可以使用localStorage,有的浏览器没有\r\n\t    var localStorage = cc.sys.localStorage;\r\n\t    localStorage.setItem(\"testStorage\", \"1\");\r\n\t    var testData = localStorage.getItem(\"testStorage\");\r\n\t    if(testData){\r\n\t\t    cc.sys.localStorage.CanUse  = 1;\r\n\t\t    localStorage.removeItem(\"testStorage\");\r\n\t    }\r\n\t    else{\r\n\t\t    cc.sys.localStorage.CanUse  = 0;\r\n\t\t    this.ErrLog(\"cant use sys.localStorage\");\r\n\t    }\r\n\r\n\t    //本地数据管理器\r\n\t    let LocalDataManagerModel = require(\"LocalDataManager\").GetModel;\r\n\t    app[\"LocalDataManager\"] = LocalDataManagerModel;\r\n\t    this.LocalDataManager = LocalDataManagerModel();\r\n\r\n\t    //js调用native平台接口管理器(启动需要获取客户端app启动携带参数)\r\n\t    let NativeManagerModel = require(app.subGameName + \"_NativeManager\").GetModel;\r\n\t    app[app.subGameName + \"_NativeManager\"] = NativeManagerModel;\r\n\t    this.NativeManager = NativeManagerModel();\r\n\r\n        //客户端初始化\r\n        this.clientState = this[app.subGameName + \"_ShareDefine\"].State_Prepare;\r\n\r\n        //定时器下次执行时间\r\n        this.nextTick = 0;\r\n\r\n        //心跳\r\n        this.lastHearTime = 0;\r\n        this.LostHearTime = 0;\r\n\t    this.isFirstLogin = true;\r\n\t    this.debugModel = null;\r\n\t    //重连计时\r\n\t    this.lastReConnectTime = 0;\r\n\t    this.reConnectUseTime = 0;\r\n\t    this.bStartReConnect = false;\r\n\t    this.reConnectLable = this.reConnectTip.getChildByName('sp_info').getChildByName('lb_info').getComponent(cc.Label);\r\n\t    //启动携带参数\r\n\t    this.startUpInfo = {};\r\n\r\n\t    //客户端配置字典\r\n\t    this.clientConfig = {};\r\n\r\n\t    this.gameType = -1;\r\n\r\n        this.InitLaunchParameter();\r\n        \r\n        //this.loadapkpro = 0.0f;\r\n        //\r\n        this.isAllReadyRelogin = false;\r\n    },\r\n\r\n\t//debug初始化\r\n\tInitDebug:function(isDebug){\r\n\r\n\t\tif(isDebug){\r\n\t\t\t// this.LogManager.IsOpenLog(true);\r\n\t\t\tthis[app.subGameName + \"_ShareDefine\"].IsDevelopment = 1;\r\n\t\t\ttry{\r\n\t\t\t\tif(this.debugPrefab && !this.debugModel){\r\n\t\t\t\t\tlet debugNode = cc.instantiate(this.debugPrefab);\r\n\t\t\t\t\tthis.debugModel = debugNode.getComponent(\"DebugLayer\");\r\n\t\t\t\t\tthis.debugModel.OnCreate()\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tcatch (error){\r\n\t\t\t\tthis.ErrLog(\"create debug error:%s\", error.stack);\r\n\t\t\t\tthis.debugModel = null;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse{\r\n\t\t\t// this.LogManager.IsOpenLog(false);\r\n\t\t\tthis[app.subGameName + \"_ShareDefine\"].IsDevelopment = 0;\r\n\t\t}\r\n\r\n\t},\r\n\r\n    //启动参数\r\n    InitLaunchParameter:function(){\r\n\t    let para = \"\";\r\n\r\n\t    //如果是native版本获取应用启动携带参数\r\n        if(cc.sys.isNative){\r\n\t        para = app[app.subGameName + \"_NativeManager\"]().CallToNative(\"GetQuery\", [], \"String\");\r\n\t        if(!para){\r\n\t\t        para = \"\";\r\n\t        }\r\n        }\r\n        //如果是H5版本\r\n\t    else{\r\n\t        //浏览器信息\r\n\t        //let navigator = window.navigator;\r\n\t        //let userAgent = navigator.userAgent;\r\n\t        let href  = window.location.href;\r\n\t        let index = href.indexOf(\"?\");\r\n\t        if(index > -1){\r\n\t\t        //\"?ddmchannel=dangle&ddmgameid=p1&appId=50059&cpToken=6aacddfec66b4ba2a1728b235d2c5716\"\r\n\t\t        para = href.substr(index + 1);\r\n\t        }\r\n        }\r\n\r\n\t    let paraList = [];\r\n\t    if(para.length){\r\n\t\t    paraList = para.split(\"&\");\r\n\t    }\r\n        let count = paraList.length;\r\n\r\n        for(let index=0; index<count; index++){\r\n            let paraInfo = paraList[index];\r\n            let paraDataList = paraInfo.split(\"=\");\r\n            if(paraDataList.length != 2){\r\n                this.ErrLog(\"InitLaunchParameter paraInfo:%s error\", paraInfo);\r\n                continue\r\n            }\r\n            this.startUpInfo[paraDataList[0]] = paraDataList[1];\r\n        }\r\n    },\r\n\r\n    //-----------------封包函数-------------------------\r\n    OnPack_LuckDrawReceive:function(serverPack){\r\n    \tthis.OnEvent(\"OnChouJiangLingQu\", serverPack);\r\n    },\r\n    //心跳包\r\n    OnPack_HeartBeat: function(serverPack) {\r\n        this.lastHearTime = new Date().getTime();\r\n        this.LostHearTime = new Date().getTime();\r\n        if (serverPack.bBeatFlag) {\r\n        \tapp[app.subGameName + \"_NetManager\"]().SendPack(\"heartBeat.CHeartBeatHandler\", {\"strBeatMessage\":\"\",\"lBeatTime\":this.lastHearTime,\"bBeatFlag\":true},this.SpeedTest.bind(this),this.SpeedTest.bind(this));\r\n        }\r\n    },\r\n    //网速检测\r\n    SpeedTest:function(serverPack){\r\n    \tthis.isFaXinTiao=false;\r\n    \tlet yanci=new Date().getTime()-this.lastHearTime;\r\n    \tthis.OnEvent(\"EvtSpeedTest\", {\"yanci\":yanci});\r\n    },\r\n\t//1:账号登录成功\r\n\tOnPack_BaseLogin:function(serverPack){\r\n\t\tconsole.log(\"账号登录成功\");\r\n\t\tlet HeroAccountManager = app[app.subGameName + \"_HeroAccountManager\"]();\r\n\t\tlet accountID = HeroAccountManager.GetAccountProperty(\"AccountID\");\r\n\t\tlet nickName = HeroAccountManager.GetAccountProperty(\"NickName\");\r\n\t\tlet headImageUrl = HeroAccountManager.GetAccountProperty(\"HeadImageUrl\");\r\n\t\tlet sex = HeroAccountManager.GetAccountProperty(\"Sex\");\r\n\r\n\t\tapp[app.subGameName + \"_ServerTimeManager\"]().InitLoginData(serverPack);\r\n\r\n\t\tlet NetManager = app[app.subGameName + \"_NetManager\"]();\r\n\r\n\t\t//连接已经建立,初始化连接的玩家账号ID\r\n\t\tNetManager.InitConnectAccountID(accountID);\r\n\r\n\t\t//如果客户端已经有玩家数据了,为重连回包,不需要发送登录封包,只需要同步一次玩家属性,因为有可能变化了属性\r\n\t\tif(app[app.subGameName + \"_HeroManager\"]().GetHeroID()){\r\n\t\t\tconsole.log(\"玩家数据已经存在\");\r\n\t\t\tNetManager.SendPack(\"base.C1005PlayerInfo\", {});\r\n\t\t}\r\n\t\telse{\r\n\t\t\tif(serverPack[\"isNeedCreateRole\"]){\r\n\t\t\t\tconsole.log(\"创建新角色\");\r\n\t\t\t\tNetManager.SendPack(\"base.C1001CreateRole\", {\"nickName\":nickName, \"sex\":sex, \"headImageUrl\":headImageUrl, \"accountID\":accountID});\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\tconsole.log(\"登录已有账号\");\r\n\t\t\t\tNetManager.SendPack(\"base.C1006RoleLogin\", {\"accountID\":accountID});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t},\r\n\t//服务端随机下发一个游客账号，直接登录就可以\r\n\tOnPack_RoleTest:function(serverPack){\r\n\t\tconsole.log(\"发送重新登录请求...\");\r\n\t\tapp[app.subGameName + \"_HeroAccountManager\"]().SetAccountProperty(\"reloginSign\", serverPack[\"sign\"]);\r\n\t\tapp[app.subGameName + \"_NetManager\"]().SendPack(\"base.C1006RoleLogin\", {\"accountID\":serverPack[\"accountID\"]});\r\n\t},\r\n\r\n    //2:玩家登陆初始化\r\n    OnPack_OnHeroLogin:function(serverPack){\r\n\r\n        try{\r\n        \tif (this.isAllReadyRelogin) {\r\n\t\t\t\tconsole.log(\"已经初始化玩家数据，重复初始化导致报错...\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.isAllReadyRelogin = true;\r\n        \tconsole.log(\"初始化玩家数据...\");\r\n\t        let heroID = serverPack[\"pid\"];\r\n\t        this.gameType = serverPack[\"currentGameType\"];\r\n\r\n            app[app.subGameName + \"_HeroManager\"]().InitLoginData(heroID, serverPack);\r\n            app[app.subGameName + \"_ServerTimeManager\"]().InitLoginData(serverPack);\r\n            app[app.subGameName + \"_HeroAccountManager\"]().SetAccountProperty(\"AccountID\", serverPack[\"accountID\"]);\r\n            this.clientState = this[app.subGameName + \"_ShareDefine\"].State_Logined;\r\n        }\r\n        catch(error){\r\n            this.ErrLog(\"OnPack_OnHeroLogin(%s):%s\", serverPack, error.stack);\r\n            this.clientState = this[app.subGameName + \"_ShareDefine\"].State_LoginPackFail;\r\n            app[app.subGameName + \"_SysNotifyManager\"]().ShowSysMsg(\"Code_Login_PackFail\");\r\n        }\r\n    },\r\n\r\n\tOnPack_PlayerInfo:function(serverPack){\r\n\t\ttry{\r\n\t\t\tlet heroID = serverPack[\"pid\"];\r\n\t\t\tapp[app.subGameName + \"_HeroManager\"]().InitLoginData(heroID, serverPack);\r\n\t\t}\r\n\t\tcatch(error){\r\n\t\t\tthis.ErrLog(\"OnPack_PlayerInfo(%s):%s\", serverPack, error.stack);\r\n\t\t}\r\n\t},\r\n\r\n\t//3:请求玩家工会数据\r\n\tOnEvent_InitPlayerFamily:function(event){\r\n\t\t//请求玩家进入的房间ID\r\n\t\tapp[app.subGameName + \"_GameManager\"]().SendGetCurRoomID();\r\n\t},\r\n\tSetGameType:function(typeStr){\r\n\t\tif(app.subGameName == typeStr)\r\n\t\t\tthis.gameType = 40;\r\n\t\telse\r\n\t\t\tthis.gameType = -1;\r\n\t},\r\n\t//4:登录获取玩家当前参与的房间ID\r\n\tOnEvent_LoginGetCurRoomID:function(event){\r\n\t\tlet serverPack = event;\r\n\t\tlet roomID = serverPack.roomID;\r\n\t\tconsole.log(\"登录获取玩家当前参与的房间ID:\" + roomID);\r\n\t\t//返回大厅检测下是否有需要处理的数据\r\n        let allSwitchGameData = [];\r\n        let switchGameData = cc.sys.localStorage.getItem(\"switchGameData\");\r\n        if (switchGameData != \"\") {\r\n            allSwitchGameData.push(JSON.parse(switchGameData));\r\n        }\r\n        let isShowVideo = false;\r\n        for (let i = 0; i < allSwitchGameData.length; i++) {\r\n        \tif (!allSwitchGameData[i]) continue;\r\n            console.log(\"allSwitchGameData[i].action\", serverPack);\r\n            let action = allSwitchGameData[i].action;\r\n            switch(action){\r\n                case 'showForm':\r\n                    this.FormManager.ShowForm(allSwitchGameData[i].fromName);\r\n                    break;\r\n                case 'showVideo':\r\n                \tisShowVideo = true;\r\n                    app[app.subGameName + \"_SceneManager\"]().LoadScene(app.subGameName + \"VideoScene\");\r\n                    break;\r\n                default:\r\n                    console.log('未知动作: ' + action);\r\n                    break;\r\n            }\r\n        }\r\n        if (isShowVideo) {\r\n        \t//正在播放回放\r\n        \treturn;\r\n        }\r\n\r\n\t\tif('practiceId' in serverPack)\r\n\t\t\tapp[app.subGameName + \"_ShareDefine\"]().practiceId = serverPack.practiceId;\r\n\t\tif(roomID == 0){\r\n\t\t\t//如果启动参数传递房间号，则尝试进入房间\r\n\t\t\tif(this.startUpInfo['room_id']){\r\n\t\t\t\tlet roomKey=this.startUpInfo['room_id'];\r\n\t\t\t\tlet that = this;\r\n\t\t\t\tapp[app.subGameName + \"_NetManager\"]().SendPack(app.subGameName + \".C\" + app.subGameName.toUpperCase() + \"EnterRoom\", {\"roomKey\":roomKey,\"posID\":-1}, function(){}, function(event){\r\n                \tthat.OnStartEnterGame(\"enterMain\");\r\n            \t});\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.OnStartEnterGame(\"enterMain\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet that = this;\r\n\t\t//进入万载麻将房间\r\n\t\tapp[app.subGameName.toUpperCase() + \"RoomMgr\"]().SendGetRoomInfo(roomID, function(){\r\n\t\t\tthat.OnStartEnterGame(\"enterRoom\");\r\n\t\t});\r\n\t},\r\n\tOnEvent_ConnectSuccess:function(event){\r\n\t\tlet serverPack = event;\r\n\t\tlet bIsReconnect = serverPack['IsReconnecting'];\r\n\t\tif(bIsReconnect){\r\n\t\t\tapp[app.subGameName + \"_NetManager\"]().SendPack(\"game.CGetGameStatus\", {});\r\n\t\t}\r\n\t},\r\n\t//断线重连状态同步\r\n\tOnPack_GetGameStatus:function(serverPack){\r\n\t\tlet isPlayingGame = serverPack['isPlayingGame'];\r\n\t\tthis.gameType = serverPack['gameType'];\r\n\t\tlet roomID=serverPack['roomID'];\r\n\t\tif(isPlayingGame){//游戏中\r\n\t\t\tlet event = {};\r\n\t\t\tevent = {};\r\n\t\t\tevent.roomID = roomID;\r\n\t\t\tthis.OnEvent_LoginGetCurRoomID(event);\r\n\t\t}\r\n\t\telse{//跳转大厅\r\n\t\t\tlet SceneManager = app[app.subGameName + \"_SceneManager\"]();\r\n        \tlet sceneType = SceneManager.GetSceneType();\r\n\t        //如果已经在登录场景则不切换\r\n\t        if((app.subGameName+'MainScene') != sceneType)\r\n\t\t\t\tthis.ExitGame();\r\n\t\t}\r\n\t},\r\n\tOnEvent_ReloadHeroData:function(event){\r\n\t\tif (cc.sys.isNative) {\r\n\t\t\tapp[app.subGameName + \"_NetManager\"]().SendPack(\"game.C1101GetRoomID\", {});\r\n\t\t}else{\r\n\t\t\tthis.ExitGame();\r\n\t\t}\r\n\t},\r\n\t//开始进入游戏\r\n\tOnStartEnterGame:function(eventName){\r\n\t\tthis.clientState = this[app.subGameName + \"_ShareDefine\"].State_Logined;\r\n\r\n\t\tif(eventName == \"enterMain\"){\r\n\t\t\t//进入主场景\r\n\t\t\tconsole.log(\"进入主场景\");\r\n\t\t\tthis.ExitGame();\r\n\t\t}\r\n\r\n\t\tthis.OnEvent(\"PlayerLoginOK\", {});\r\n\t},\r\n\r\n\t//被ti\r\n\tOnPack_Kickout:function(serverPack){\r\n\t\tlet kickOutType = serverPack[\"type\"];\r\n\r\n\t\tif(kickOutType == 2){\r\n\t\t\tthis.LogOutGame(-1);\r\n\t\t}\r\n\t\telse{\r\n\t\t\tthis.ErrLog(\"OnPack_Kickout kickOutType:%s not find\", kickOutType);\r\n\t\t}\r\n\t},\r\n\r\n    //提醒玩家在线时长\r\n    OnPack_Online:function(serverPack){\r\n         app[app.subGameName + \"_SysNotifyManager\"]().ShowSysMsg(\"MSG_TIME_ONLINE\",[serverPack.onlineHour]);\r\n    },\r\n\r\n\t//-----------------回调函数-------------------------\r\n\r\n\r\n\t//native平台回调\r\n\tOnNativeNotify:function(eventType, eventDataString){\r\n        try {\r\n            let dataDict = JSON.parse(eventDataString);\r\n            if (eventType == \"wechat\") { //微信登录\r\n\t            app[app.subGameName + \"_WeChatAppManager\"]().OnNativeNotifyWXLogin(dataDict);\r\n            }else if (eventType == \"wechatShare\") {  //微信分享\r\n                app[app.subGameName + \"_WeChatAppManager\"]().OnNativeNotifyWXShare(dataDict);\r\n            }else if (eventType == \"wechatPay\") { //微信支付\r\n                app[app.subGameName + \"_WeChatAppManager\"]().OnNativeNotifyWXPay(dataDict);\r\n            }else if (eventType == \"onBatteryLevel\") { //电量回掉\r\n                this.OnEvent(\"EvtBatteryLevel\",{\"Level\": dataDict[\"Level\"], \"status\":dataDict[\"status\"]});\r\n            }else if (eventType == \"apkProess\") { //下载apk进度\r\n                this.OnEvent(\"LoadApkProess\", {\"progress\": dataDict[\"proess\"]});\r\n            }else if (eventType == \"download\") { //下载\r\n            \tapp[app.subGameName + \"_DownLoadMgr\"]().OnDownLoadEvent(dataDict);\r\n            }else if (eventType == \"palyAudioFinsh\") { //播放完成\r\n            \tthis.OnEvent(\"palyAudioFinsh\", {});\r\n            }else if (eventType == \"AudioError\") {//录音失败\r\n            \tthis.OnEvent(\"AudioError\", {});\r\n\t\t\t}else if (eventType == \"AudioStopError\") {//录音失败\r\n            \tthis.OnEvent(\"AudioStopError\", {});\r\n            }else if (eventType == \"MedioRecordError\") {//播放失败\r\n            \tthis.OnEvent(\"MedioRecordError\", {});\r\n            }else if (eventType == \"wellPrepared\") {//准备录音\r\n            \tthis.OnEvent(\"wellPrepared\", {});\r\n            }else if (eventType == \"RecordAudioFinsh\") { //录音完成\r\n            \tthis.OnEvent(\"RECORDAUDIOFINSH\", {});\r\n            }else if (eventType == \"GETLOCATION\") { //获取定位\r\n            \tapp[app.subGameName + \"_LocationOnStartMgr\"]().OnGetLocationCallBack(dataDict);\r\n            }else if (eventType == \"copyText\") { //获取定位\r\n            \tthis.OnEvent(\"OnCopyTextNtf\", dataDict);\r\n            }else if (eventType == \"DDShare\") {\r\n            \tthis.OnEvent(\"OnDDShare\", dataDict);\r\n            }else if (eventType == \"MWShare\") {\r\n            \tthis.OnEvent(\"OnMWShare\", dataDict);\r\n            }else{\r\n\t            this.ErrLog(\"OnNativeNotify not find eventType:%s\", eventType);\r\n            }\r\n        }\r\n        catch(error) {\r\n            if(eventType=='wechatShare'){\r\n        \t\t//还是给分享成功回调\r\n            \tapp[app.subGameName + \"_WeChatAppManager\"]().OnNativeNotifyWXShare({\"ErrCode\":0});\r\n        \t}else{\r\n            \tthis.ErrLog(\"OnNativeNotify(%s,%s) error(%s), error.stack:%s\", eventType, eventDataString, error, error.stack);\r\n        \t}\r\n        }\r\n\t},\r\n\r\n\r\n    // 每帧回掉\r\n    update: function (dt) {\t\r\n\r\n\t\t//if(this.clientState < this[app.subGameName + \"_ShareDefine\"].State_WaitLogin){\r\n\t\t//\treturn\r\n\t\t//}\r\n\t\t//\r\n\t\t//let nowTick = new Date().getTime();\r\n\t\t//\r\n\t\t//if(nowTick >= this.nextTick){\r\n\t\t//\tthis.nextTick = nowTick + 1000;\r\n\t\t//}\r\n    },\r\n\r\n    //100毫秒回掉\r\n    OnTimer:function(passSecond){\r\n\t\ttry {\r\n\t\t    if(this.isWriteLog){\r\n\t\t\t    this.logSecond += passSecond;\r\n\t\t\t    //500毫秒输出一次log\r\n\t\t\t    if(this.logSecond >= 0.5){\r\n\t\t\t\t    // this.LogManager.OutPutLog();\r\n\t\t\t\t    this.logSecond = 0\r\n\t\t\t    }\r\n\t\t    }\r\n            if (this.clientState < this[app.subGameName + \"_ShareDefine\"].State_WaitLogin) {\r\n                return\r\n            }\r\n\r\n            app[app.subGameName + \"_SceneManager\"]().OnTimer(passSecond);\r\n\r\n            //完整登录才能调用\r\n            if (this.clientState == this[app.subGameName + \"_ShareDefine\"].State_Logined){\r\n            \tlet curTime = new Date().getTime();\r\n\r\n            \tif(this.lastHearTime && curTime > this.lastHearTime + 23000){\r\n            \t\tthis.ErrLog('NetWork Disconnect By Heart');\r\n            \t\tthis.lastHearTime = 0;\r\n            \t\tif(app[app.subGameName + \"_NetWork\"]().isConnectIng)//ios的可能websoket不会主动断开\r\n            \t\t\tapp[app.subGameName + \"_NetManager\"]().Disconnect();\r\n\r\n            \t\tif(!this.bStartReConnect){\r\n            \t\t\tthis.StartReConnect();\r\n            \t\t\tapp[app.subGameName + \"_NetWork\"]().ReConnectByTipSureBtn();\r\n            \t\t}\r\n            \t}\r\n            \tif(this.bStartReConnect){\r\n            \t\tif(this.lastReConnectTime && curTime > this.lastReConnectTime + 1000){\r\n\t            \t\tthis.lastReConnectTime = curTime;\r\n\t            \t\tthis.reConnectUseTime++;\r\n\t            \t\tthis.reConnectLable.string = '连接失败,重新加载中(' + this.reConnectUseTime + '秒)'+'...';\r\n\t            \t}\r\n            \t}\r\n            }\r\n        }\r\n        catch(error){\r\n            this.ErrLog(\"OnTimer:%s\", error.stack);\r\n        }\r\n    },\r\n\r\n\tStartTimer:function(){\r\n    \tthis.schedule(this.OnTimer, 1);\r\n    },\r\n    StopTimer:function(){\r\n    \tthis.unschedule(this.OnTimer);\r\n    },\r\n\r\n    OnEventHide:function(){\r\n\t\tconsole.log(\"================= client OnEventHide\");\r\n    \tlet curRunGame = cc.sys.localStorage.getItem(\"curRunGame\");\r\n    \tif (curRunGame != app.subGameName) {\r\n    \t\tconsole.log(\"当前游戏在 \" + curRunGame + \",无需监听OnEventHide事件\");\r\n    \t\treturn;\r\n    \t}\r\n    \tthis.StopTimer();\r\n        if(this.clientState < this[app.subGameName + \"_ShareDefine\"].State_WaitLogin){\r\n            return\r\n        }\r\n\r\n        try{\r\n            app[app.subGameName + \"_SceneManager\"]().OnEventHide();\r\n        }\r\n        catch(error){\r\n\t\t    this.ErrLog(\"OnEventHide error:%s\", error.stack);\r\n        }\r\n    },\r\n\r\n    OnEventShow:function(){\r\n\t\tconsole.log(\"================= client OnEventShow\");\r\n    \tlet curRunGame = cc.sys.localStorage.getItem(\"curRunGame\");\r\n    \tif (curRunGame != app.subGameName) {\r\n    \t\tconsole.log(\"当前游戏在 \" + curRunGame + \",无需监听OnEventShow事件\");\r\n    \t\treturn;\r\n    \t}\r\n    \tthis.StopTimer();\r\n        if(this.clientState < this[app.subGameName + \"_ShareDefine\"].State_WaitLogin){\r\n            return\r\n        }\r\n\t    try{\r\n\t    \tlet curTime = new Date().getTime();\r\n\t    \tconsole.log(\"LostHearTime == \" + this.LostHearTime + \",curTime == \" + curTime);\r\n\t        if(this.LostHearTime && curTime > this.LostHearTime + 55000){\r\n\t        \tthis.lastHearTime = 0;\r\n\t        \t// console.log(\"后台切回来大厅 3\");\r\n\t        \tif(app[app.subGameName+\"_NetWork\"]().isConnectIng){//ios的可能websoket不会主动断开\r\n\t        \t\tconsole.log(\"后台切回来，先断开连接\");\r\n\t        \t\tapp[app.subGameName+\"_NetManager\"]().Disconnect();\r\n\t        \t}\r\n\t        \tif(!this.bStartReConnect){\r\n\t        \t\tconsole.log(\"后台切回来，发起断线重连\");\r\n\t        \t\tthis.StartReConnect();\r\n\t        \t\tapp[app.subGameName+\"_NetWork\"].ReConnectByTipSureBtn();\r\n\t        \t}\r\n\t        }\r\n\t\t    app[app.subGameName + \"_SceneManager\"]().OnEventShow(this.bStartReConnect);\r\n\t\t    this.scheduleOnce(function(){\r\n\t    \t\tthis.StartTimer();\r\n\t    \t},2);\r\n\t    }\r\n\t    catch(error){\r\n\t\t    this.ErrLog(\"OnEventShow error:%s\", error.stack);\r\n\t    }\r\n    },\r\n\r\n\t//初始化客户端访问路径和app版本号\r\n\tOnInitClientData:function(clientPath, appVersion){\r\n\t\tthis.clientState = this[app.subGameName + \"_ShareDefine\"].State_InitSuccess;\r\n\t},\r\n\r\n    //客户端初始化成功回调\r\n    OnInitClientFinish:function(allTableDataDict, clientConfig){\r\n\t\ttry{\r\n\t\t\tthis.clientConfig = clientConfig;\r\n\r\n\t\t\tconsole.log(\"ClietManage clientConfig:\",this.clientConfig);\r\n\t\t\tthis.RefreshClientConfig();\r\n\r\n\t\t\tif(this.debugModel){\r\n\t\t\t\tthis.debugModel.OnInitClientFinish();\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\tlet debug = this.clientConfig[\"debug\"];\r\n\r\n\t\t\t\t//如果服务器下发debug\r\n\t\t\t\tif(debug && this.CheckDebugSign(debug)){\r\n\t\t\t\t\tthis.InitDebug(true);\r\n\t\t\t\t\tthis.debugModel.OnInitClientFinish();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif(this.clientState != this[app.subGameName + \"_ShareDefine\"].State_InitSuccess){\r\n\t\t\t\tconsole.log(\"OnInitClientFinish 初始化异常\");\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\r\n\t\t\tif(!this.InitModel()){\r\n\t\t\t\tconsole.log(\"OnInitClientFinish InitModel fail\");\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\r\n\t\t\tif(!this.InitTable(allTableDataDict)){\r\n\t\t\t\tconsole.log(\"OnInitClientFinish InitTable fail\");\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\r\n\t\t\t//初始化客户端所有管理器\r\n\t\t\tif(!this.InitManager()){\r\n\t\t\t\tconsole.log(\"OnInitClientFinish InitManager fail\");\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\r\n\t\t\t//强制CG一次,否则内存一直会占用不释放\r\n\t\t\t// cc.sys.garbageCollect();\r\n\r\n\t\t\t//输出运行环境信息\r\n\t\t\tcc.sys.dump();\r\n\r\n        }\r\n\t\tcatch (e) {\r\n\t\t\tthis.ErrLog(\"InitUpdateFinish:%s\", e.stack);\r\n\t\t}\r\n    },\r\n\t\r\n\tLoadLogin:function(){\r\n\t\tthis.ClientLoginProcess();\r\n        app[app.subGameName + \"_WeChatManager\"]().SendRequestWeChatSDKIntSign();\r\n\t},\r\n\r\n\t//刷新客户端启动配置字典\r\n\tRefreshClientConfig:function(){\r\n\t\tconsole.log(\"ClientManageer this.clientConfig:\",this.clientConfig);\r\n\t\tlet dbGameServerInfo = this.LocalDataManager.GetConfigProperty(\"DebugInfo\", \"GameServerInfo\");\r\n\t\tlet dbAccountServerInfo = this.LocalDataManager.GetConfigProperty(\"DebugInfo\", \"AccountServerInfo\");\r\n\t\tlet dbOrderServerInfo = this.LocalDataManager.GetConfigProperty(\"DebugInfo\", \"OrderServerInfo\");\r\n\t\tlet dbResServerInfo = this.LocalDataManager.GetConfigProperty(\"DebugInfo\", \"ResServerInfo\");\r\n\r\n\t\tif(dbGameServerInfo){\r\n\t\t\tlet gameServerIP = dbGameServerInfo[\"GameServerIP\"];\r\n\t\t\tlet gameServerPort = dbGameServerInfo[\"GameServerPort\"];\r\n\r\n\t\t\tif(gameServerIP && gameServerPort){\r\n\t\t\t\tthis.clientConfig[\"GameServerIP\"] = gameServerIP;\r\n\t\t\t\tthis.clientConfig[\"GameServerPort\"] = gameServerPort;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif(dbAccountServerInfo){\r\n\t\t\tlet accountServerIP = dbAccountServerInfo[\"AccountServerIP\"];\r\n\t\t\tlet accountServerPort = dbAccountServerInfo[\"AccountServerPort\"];\r\n\r\n\t\t\tif(accountServerIP && accountServerPort){\r\n\t\t\t\tthis.clientConfig[\"AccountServerIP\"] = accountServerIP;\r\n\t\t\t\tthis.clientConfig[\"AccountServerPort\"] = accountServerPort;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif(dbOrderServerInfo){\r\n\t\t\tlet orderServerIP = dbOrderServerInfo[\"OrderServerIP\"];\r\n\t\t\tlet orderServerPort = dbOrderServerInfo[\"OrderServerPort\"];\r\n\r\n\t\t\tif(orderServerIP && orderServerPort){\r\n\t\t\t\tthis.clientConfig[\"OrderServerIP\"] = orderServerIP;\r\n\t\t\t\tthis.clientConfig[\"OrderServerPort\"] = orderServerPort;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif(dbResServerInfo){\r\n\t\t\tlet resServerIP = dbResServerInfo[\"ResServerIP\"];\r\n\t\t\tlet resServerPort = dbResServerInfo[\"ResServerPort\"];\r\n\r\n\t\t\tif(resServerIP && resServerPort){\r\n\t\t\t\tthis.clientConfig[\"ResServerIP\"] = resServerIP;\r\n\t\t\t\tthis.clientConfig[\"ResServerPort\"] = resServerPort;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//如果是H5连接启动,使用的账号和支付方式，需要重置一次\r\n\t\t//H5使用的账号授权SDK和支付SDK 又配置的连接携带的参数决定,不是由配置决定\r\n\t\t//公众号标示也有启动参数决定,不是由配置决定\r\n\t\tconsole.log(\"RefreshClientConfig cc.sys.isNative\",cc.sys.isNative);\r\n\t\tif(cc.sys.isNative){\r\n\t\t\t//判断使用SDK授权,支付SDK,枚举是否存在\r\n\t\t\tlet accountType = this.clientConfig[\"AccountType\"];\r\n\t\t\tlet orderType = this.clientConfig[\"OrderType\"];\r\n\t\t\tif(!this[app.subGameName + \"_ShareDefine\"].AccountSDKTypeNameDict.hasOwnProperty(accountType)){\r\n\t\t\t\tconsole.log(\"AccountSDKTypeNameDict not find :%s\", accountType);\r\n\t\t\t\tthis.clientConfig[\"AccountType\"] = this[app.subGameName + \"_ShareDefine\"].SDKType_Company;\r\n\t\t\t}\r\n\r\n\t\t\tif(!this[app.subGameName + \"_ShareDefine\"].OrderSDKTypeNameDict.hasOwnProperty(orderType)){\r\n\t\t\t\tconsole.log(\"OrderSDKTypeNameDict not find :%s\", orderType);\r\n\t\t\t\tthis.clientConfig[\"OrderType\"] = this[app.subGameName + \"_ShareDefine\"].OrderType_Company;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse{\r\n\r\n\t\t\tlet ddmchannel = this.startUpInfo[\"ddmchannel\"];\r\n\t\t\tlet ddmmp = this.startUpInfo[\"ddmmp\"];\r\n\r\n\t\t\tthis.clientConfig[\"Channel\"] = ddmchannel;\r\n\r\n\t\t\tif(ddmchannel == \"website\"){\r\n\t\t\t\tthis.clientConfig[\"AccountType\"] = this[app.subGameName + \"_ShareDefine\"].SDKType_Company;\r\n\t\t\t\tthis.clientConfig[\"OrderType\"] = this[app.subGameName + \"_ShareDefine\"].OrderType_Company;\r\n\t\t\t\tthis.clientConfig[\"MPID\"] = \"\";\r\n\t\t\t}\r\n\t\t\telse if(ddmchannel == \"wechat\"){\r\n\t\t\t\tthis.clientConfig[\"AccountType\"] = this[app.subGameName + \"_ShareDefine\"].SDKType_WeChat;\r\n\t\t\t\tthis.clientConfig[\"OrderType\"] = this[app.subGameName + \"_ShareDefine\"].OrderType_Wechat;\r\n\t\t\t\tthis.clientConfig[\"MPID\"] = ddmmp;\r\n\t\t\t}\r\n\t\t\t//可能是本机调试启动\r\n\t\t\telse if(!this.startUpInfo.hasOwnProperty(\"ddmchannel\")){\r\n\t\t\t\tconsole.log(\"webdebug ddmchannel:%s \", ddmchannel);\r\n\t\t\t\tthis.clientConfig[\"AccountType\"] = this[app.subGameName + \"_ShareDefine\"].SDKType_Company;\r\n\t\t\t\tthis.clientConfig[\"OrderType\"] = this[app.subGameName + \"_ShareDefine\"].OrderType_Company;\r\n\t\t\t\tthis.clientConfig[\"MPID\"] = \"\";\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\tthis.ErrLog(\"ddmchannel:%s error\", ddmchannel);\r\n\t\t\t\tthis.clientConfig[\"AccountType\"] = this[app.subGameName + \"_ShareDefine\"].SDKType_Company;\r\n\t\t\t\tthis.clientConfig[\"OrderType\"] = this[app.subGameName + \"_ShareDefine\"].OrderType_Company;\r\n\t\t\t\tthis.clientConfig[\"MPID\"] = \"\";\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t},\r\n\r\n\t//初始化模块\r\n\tInitModel:function(){\r\n\t\tlet modelName = \"\";\r\n\t\ttry{\r\n\t\t\tlet NeedCreateList = app.NeedCreateList;\r\n\t\t\tlet count = NeedCreateList.length;\r\n\t\t\tfor(let index=0; index<count; index++){\r\n\t\t\t\tmodelName = NeedCreateList[index];\r\n\t\t\t\t//设置所有单例引用接口到app\r\n\t\t\t\tapp[modelName] = require(modelName).GetModel;\r\n\t\t\t}\r\n\t\t}\r\n\t\tcatch(error){\r\n\t\t\tthis.ErrLog(\"OnLoad require(%s) error:%s\", modelName, error.stack);\r\n\t\t\treturn false\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t},\r\n\r\n\t//初始化表数据\r\n\tInitTable:function(allTableDataDict){\r\n\r\n\t\tlet SysDataManager = app[app.subGameName + \"_SysDataManager\"]();\r\n\r\n\t\tlet allTableNameList = Object.keys(allTableDataDict);\r\n\t\tlet count = allTableNameList.length;\r\n\t\tfor(let index=0; index<count; index++){\r\n\t\t\tlet tableName = allTableNameList[index];\r\n\t\t\tlet tableInfo = allTableDataDict[tableName];\r\n\t\t\tSysDataManager.OnLoadTableEnd(tableName, tableInfo[\"KeyNameList\"], tableInfo[\"Data\"]);\r\n\t\t}\r\n\r\n\t\treturn true\r\n\t},\r\n\r\n\t//初始化管理器\r\n\tInitManager:function(){\r\n\r\n\t\t//实例化所有单例管理器\r\n\t\tlet NeedCreateList = app.NeedCreateList;\r\n\t\tlet count = NeedCreateList.length;\r\n\r\n\t\tlet modelName = \"\";\r\n\t\ttry{\r\n\t\t\tfor(let index=0; index<count; index++){\r\n\t\t\t\tconsole.log(app.subGameName + \" InitManager\",modelName)\r\n\t\t\t\tmodelName = NeedCreateList[index];\r\n\t\t\t\trequire(modelName).GetModel()\r\n\t\t\t}\r\n\t\t}\r\n\t\tcatch(error){\r\n\t\t\tthis.ErrLog(\"InitManager(%s) error:%s\", modelName, error.stack);\r\n\t\t\treturn false\r\n\t\t}\r\n\t\t//追加调试全局入口\r\n\t\tif(window){\r\n\t\t\twindow[\"app\"] = app;\r\n\t\t}\r\n\r\n\t\tlet NetManager = app[app.subGameName + \"_NetManager\"]();\r\n\t\tlet startUrl = \"\";\r\n\t\t//初始化资源服务器地址\r\n\t\tif(window.location){\r\n\t\t\tstartUrl = window.location.origin;\r\n\t\t}\r\n\t\tNetManager.SetH5ClientStartUrl(startUrl);\r\n\r\n\t\t//封包注册\r\n\t\t//封包事件注册\r\n\t\t\r\n        //心跳\r\n\t\tNetManager.RegNetPack(\"SPlayerHeartBeat\", this.OnPack_HeartBeat, this);\r\n\t\tNetManager.RegNetPack(\"base.C1111RoleReLogin\", this.OnPack_RoleTest, this);\r\n\t\tNetManager.RegNetPack(\"base.C1004Login\", this.OnPack_BaseLogin, this);\r\n\t\tNetManager.RegNetPack(\"base.C1006RoleLogin\", this.OnPack_OnHeroLogin, this);\r\n\t\tNetManager.RegNetPack(\"base.C1001CreateRole\", this.OnPack_OnHeroLogin, this);\r\n\t\tNetManager.RegNetPack(\"base.C1005PlayerInfo\", this.OnPack_PlayerInfo, this);\r\n\t\tNetManager.RegNetPack(\"kickout\", this.OnPack_Kickout, this);  \r\n        NetManager.RegNetPack(\"SPlayer_OnlineTime\", this.OnPack_Online, this);\r\n        //断线重连状态\r\n        NetManager.RegNetPack(\"game.CGetGameStatus\", this.OnPack_GetGameStatus, this);\r\n        //玩家点击继续\r\n\t\tNetManager.RegNetPack(\"SPlayer_Continue\", this.OnEvent_SPlayerContinue, this);\r\n\t\t//抽奖奖品领取通知\r\n\t\tNetManager.RegNetPack(\"SPlayer_LuckDrawReceive\",this.OnPack_LuckDrawReceive,this);\r\n\r\n\t\tthis.RegEvent(\"InitPlayerFamily\", this.OnEvent_InitPlayerFamily, this);\r\n\t\tthis.RegEvent(\"LoginGetCurRoomID\", this.OnEvent_LoginGetCurRoomID, this);\r\n\t\t//链接服务器成功并且重新初始化玩家数据\r\n\t\tapp[app.subGameName + \"Client\"].RegEvent(\"ReloadHeroData\", this.OnEvent_ReloadHeroData, this);\r\n\t\t//断线重连成功通知\r\n\t\tapp[app.subGameName + \"Client\"].RegEvent(app.subGameName + \"_ConnectSuccess\", this.OnEvent_ConnectSuccess, this);\r\n\t\t//初始化管理器完成调用一次sdk初始化接口(h5游戏客户端需要初始化携带的sdk参数:token)\r\n\t\tconsole.log(\"InitManager this.startUpInfo:\",this.startUpInfo);\r\n\t\tapp[app.subGameName + \"_SDKManager\"]().InitSDKParameter(this.startUpInfo);\r\n\r\n\t\treturn true;\r\n\r\n\t},\r\n\r\n\t//---------------------客户端事件分发接口-----------------------------\r\n    //客户端封包事件\r\n    OnEvent:function(eventName, argDict){\r\n        // if(argDict){\r\n    \t   // console.log(\"客户端事件分发 OnEvent:\" + eventName + \",\" + argDict);\r\n        // }\r\n        // else{\r\n        //     console.log(\"客户端事件分发 OnEvent:\" + eventName);\r\n        // }\r\n        if (!this.node) {\r\n        \tconsole.log(\"当前节点已经被释放，无法分发事件\");\r\n        \treturn;\r\n        }\r\n        try{\r\n        \tlet curRunGame = cc.sys.localStorage.getItem(\"curRunGame\");\r\n        \tif (curRunGame != app.subGameName) {\r\n        \t\tconsole.log(\"当前游戏在 \" + curRunGame + \",无需分发事件\");\r\n        \t\treturn\r\n        \t}\r\n            this.node.emit(eventName, argDict);\r\n        }\r\n        catch(error){\r\n            this.ErrLog(\"子游戏事件分发 OnEvent:%s\", error.stack);\r\n        }\r\n    },\r\n    OnEvent_SPlayerContinue:function(serverPack){\r\n    \tlet roomKey=serverPack.roomKey;\r\n    \tlet userName=serverPack.shortPlayer.name;\r\n    \tlet paymentRoomCardType=serverPack.paymentRoomCardType;\r\n    \tapp[app.subGameName + \"_FormManager\"]().ShowForm('UIJoinMessage',roomKey,userName,paymentRoomCardType);\r\n\t},\r\n\t\r\n    //注册封包事件\r\n    RegEvent:function(eventName, func, target){\r\n        if(!func || !target){\r\n            this.ErrLog(\"eventName:%s error\", eventName);\r\n            return\r\n        }\r\n        this.node.on(eventName, func, target);\r\n    },\r\n\r\n    //取消注册封包事件\r\n    UnRegTargetEvent:function(target, eventName=\"\", func=\"\"){\r\n    \tif (!this.node) {\r\n    \t\t//节点已经被销毁了\r\n    \t\treturn;\r\n    \t}\r\n    \t//如果有制定注销事件\r\n    \tif(eventName && func){\r\n    \t\tthis.node.off(eventName, func, target);\r\n    \t}\r\n    \telse{\r\n    \t\tthis.node.targetOff(target);\r\n    \t}\r\n    },\r\n\r\n    //键盘按下\r\n    OnKeyDown:function(event){\r\n        let keyCode = event.keyCode;\r\n        switch(keyCode){\r\n        \tcase cc.KEY.back:\r\n        \t{\r\n        \t\tlet msgID = \"MSG_EXIT_GAME\";\r\n\t\t        let ConfirmManager = app[app.subGameName + \"_ConfirmManager\"]();\r\n\t\t        ConfirmManager.SetWaitForConfirmForm(this.OnConFirm.bind(this), msgID, []);\r\n\t        \tConfirmManager.ShowConfirm(this[app.subGameName + \"_ShareDefine\"].Confirm, msgID, []);\r\n        \t\tbreak;\r\n        \t}\r\n        }\r\n        this.OnEvent(\"OnKeyDown\", {\"KeyCode\":keyCode});\r\n    },\r\n    OnConFirm:function(clickType, msgID, backArgList){\r\n        if('Sure' == clickType){\r\n\t    \tif('MSG_EXIT_GAME' == msgID)\r\n\t\t        cc.game.end();\r\n\t    }\r\n    },\r\n    //----------------逻辑函数----------------------\r\n\t//客户端是否登录封包完成\r\n\tIsClientLoginOK:function(){\r\n\t\treturn this.clientState == this[app.subGameName + \"_ShareDefine\"].State_Logined;\r\n\t},\r\n\r\n    SetClientState:function(clientState){\r\n        this.clientState = clientState;\r\n    },\r\n\r\n\t//退出游戏到登录界面\r\n\tLogOutGame:function(code = 0){\r\n\t\tconsole.log('LogOutGame');\r\n\t\tif(-1 == code){\r\n\t\t\t\r\n\t\t}else if(-2 == code){\r\n\t\t\tapp[app.subGameName + \"_SysNotifyManager\"]().ShowSysMsg(\"Kick_ByServer\");\r\n\t\t}\r\n\t\t\r\n\t\tapp.LocalDataManager().SetConfigProperty(\"Account\", \"AccessTokenInfo\", {});\r\n\t\tthis.ClientLoginProcess();\r\n\t},\r\n\r\n\t/**\r\n\t * 退到客户端登录场景,客户端初始化s\r\n\t */\r\n\tClientLoginProcess:function(){\r\n\r\n        let SceneManager = app[app.subGameName + \"_SceneManager\"]();\r\n\r\n        let sceneType = SceneManager.GetSceneType();\r\n\r\n        //如果已经在登录场景则不切换\r\n        if(sceneType == \"loginScene\"){\r\n        \tif(!SceneManager.GetSceneComponent()){\r\n\t            this.WarnLog(\"ClientLoginProcess not sceneName\");\r\n\t            return\r\n\t        }\r\n            SceneManager.GetSceneComponent().OnTopEvent(\"Close\");\r\n        }\r\n\t\t//如果不在登录场景，则切换到登录场景，\r\n        else{\r\n\t\t\tif (!cc.sys.isNative){\r\n\t\t\t\tthis.ClearClientData();\r\n            \tSceneManager.LoadScene(app.subGameName + \"LoginScene\");\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\tthis.ExitGame();\r\n\t\t\t}\r\n        }\r\n\r\n\t},\r\n\r\n    //清理管理器数据\r\n    ClearClientData:function(){\r\n    \tapp.LocalDataManager().OnReload();\r\n    \t//----客户端基础管理器---\r\n    \tapp[app.subGameName + \"_NetManager\"]().OnReload();\r\n\t\tapp[app.subGameName + \"_SceneManager\"]().OnReload();\r\n\t    app[app.subGameName + \"_SDKManager\"]().OnReload();\r\n\r\n\t    //----数据管理器-------\r\n        app[app.subGameName + \"_HeroManager\"]().OnReload();\r\n\r\n\t    app[app.subGameName + \"_GameManager\"]().OnReload();\r\n\r\n\r\n\t\tthis.clientState = this[app.subGameName + \"_ShareDefine\"].State_WaitLogin;\r\n    },\r\n\r\n\r\n\t//检测Debug签名\r\n\tCheckDebugSign:function(debugSign){\r\n\t\t//生成签名\r\n\t\tlet argDict = {\r\n\t\t\t\"gameID\":\"p7\",\r\n\t\t\t\"gameType\":\"h5\",\r\n\t\t\t\"nonceStr\":\"18320c805fb57d88805d3918cdd1b2a3\",\r\n\t\t};\r\n\t\tlet argKeyList = Object.keys(argDict);\r\n\t\targKeyList.sort();\r\n\t\tlet keyCount = argKeyList.length;\r\n\t\tlet signString = \"\";\r\n\t\tfor(let index=0; index<keyCount; index++){\r\n\t\t\tlet keyName = argKeyList[index];\r\n\t\t\tsignString += [keyName,\"=\", argDict[keyName],\"&\"].join(\"\");\r\n\t\t}\r\n\t\tsignString += \"ddmh5.com\";\r\n\t\tlet sign = app.MD5.hex_md5(signString);\r\n\t\tif(sign == debugSign){\r\n\t\t\treturn true\r\n\t\t}\r\n\t\treturn false\r\n\t},\r\n\r\n    //--------------全局缓存---------------\r\n\r\n\t//获取全局缓存的bebug节点\r\n\tGetDebugModel:function(){\r\n\t\treturn this.debugModel;\r\n\t},\r\n\tMultiPoint:function(serverIP){\r\n        if(serverIP==\"\"){\r\n            return \"\";\r\n        }\r\n        if(app[app.subGameName + \"Client\"].GetClientConfigProperty(\"IsGaoFang\")==0){\r\n            //不接入高防\r\n            return serverIP;\r\n        }\r\n        let AccessPoint=app.LocalDataManager().GetConfigProperty(\"Account\", \"AccessPoint\");\r\n        if(AccessPoint>0){\r\n            if(AccessPoint==1){\r\n                return 'line1.'+serverIP;\r\n            }else if(AccessPoint==2){\r\n                return 'line2.'+serverIP;\r\n            }else if(AccessPoint==3){\r\n                return 'line3.'+serverIP;\r\n            }\r\n        }\r\n\r\n        let AccountActive = app.LocalDataManager().GetConfigProperty(\"Account\", \"AccountActive\");\r\n        //如果该城市有独立节点，则调用本城市自己的节点\r\n        let myCityID = cc.sys.localStorage.getItem(\"myCityID\");\r\n        if(myCityID){\r\n            let CityPoints=app[app.subGameName + \"Client\"].GetClientConfigProperty(\"CityPoints\");\r\n            if(CityPoints){\r\n                let CityPointsList=CityPoints.split(',');\r\n                if(CityPointsList.indexOf(myCityID)>-1){\r\n                    //用户选择的城市有配置独立的节点\r\n                    if(AccountActive>10){\r\n                        return 'h'+myCityID+'.'+serverIP; //活跃用户\r\n                    }else{\r\n                        return 'c'+myCityID+'.'+serverIP; //普通用户\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        if(AccountActive>100){\r\n            serverIP='a100.'+serverIP;\r\n        }else if(AccountActive>50){\r\n            serverIP='i50.'+serverIP;\r\n        }else if(AccountActive>10){\r\n            serverIP='x10.'+serverIP;\r\n        }\r\n\r\n\r\n        return serverIP;\r\n    },\r\n\t//获取客户端启动配置\r\n\tGetClientConfig:function(){\r\n\t\tlet clientConfig=[];\r\n\t\tlet mt=[\"GateServerIP\",\"GameServerIP\",\"AccountServerIP\",\"OrderServerIP\",\"ResServerIP\"];\r\n\t\tfor(var key in this.clientConfig){\r\n\t\t\tif(mt.InArray(key)){\r\n\t\t\t\tclientConfig[key]=this.MultiPoint(this.clientConfig[key]);\r\n\t\t\t}else{\r\n\t\t\t\tclientConfig[key]=this.clientConfig[key];\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn clientConfig;\r\n\t},\r\n\r\n\t//获取客户端启动配置属性值\r\n\tGetClientConfigProperty:function(property){\r\n\t\tlet mt=[\"GateServerIP\",\"GameServerIP\",\"AccountServerIP\",\"OrderServerIP\",\"ResServerIP\"];\r\n\t\tif(this.clientConfig.hasOwnProperty(property)){\r\n\t\t\tif(mt.InArray(property)){\r\n\t\t\t\treturn this.MultiPoint(this.clientConfig[property]);\r\n\t\t\t}else{\r\n\t\t\t\treturn this.clientConfig[property];\r\n\t\t\t}\r\n\t\t}\r\n\t\telse{\r\n\t\t\tthis.ErrLog(\"GetClientConfigProperty not find :%s\", property);\r\n\t\t\treturn 0\r\n\t\t}\r\n\t},\r\n\r\n\t//获取启动属性值\r\n\tGetStartUpProperty:function(property){\r\n\t\tif(!this.startUpInfo.hasOwnProperty(property)){\r\n\t\t\treturn\r\n\t\t}\r\n\t\treturn this.startUpInfo[property];\r\n\t},\r\n\r\n    GetGlobalEffectNode:function(effectName){\r\n        let effectNode = this.node.getChildByName('globalEffect').getChildByName(effectName);\r\n        if(!effectNode){\r\n            this.ErrLog(\"GetGlobalEffectNode(%s) not find\", effectName);\r\n            return\r\n        }\r\n        effectNode.removeFromParent(false);\r\n        return effectNode\r\n    },\r\n   \r\n    PushGlobalEffectNode:function(effectNode){\r\n        effectNode.removeFromParent(false);\r\n        this.node.getChildByName('globalEffect').addChild(effectNode);\r\n    },\r\n\r\n\tGetIsFirstLogin:function(){\r\n\t\treturn this.isFirstLogin\r\n\t},\r\n\r\n\tSetFirstLogin:function(){\r\n\t\tthis.isFirstLogin = false;\r\n\t},\r\n\r\n\tStartReConnect:function(){\r\n    \tif(this.bStartReConnect)\r\n    \t\treturn;\r\n    \tthis.bStartReConnect = true;\r\n    \tthis.reConnectUseTime = 0;\r\n    \tthis.reConnectLable.string = '连接失败,重新加载中(1秒)...';\r\n    \tthis.lastReConnectTime = new Date().getTime();\r\n    \tthis.reConnectTip.active = true;\r\n    },\r\n    CloseReConnectTip:function(){\r\n    \tthis.bStartReConnect = false;\r\n    \tthis.lastReConnectTime = 0;\r\n    \tthis.reConnectUseTime = 0;\r\n    \tthis.reConnectLable.string = '';\r\n    \tthis.reConnectTip.active = false;\r\n    },\r\n\r\n\t//取消常驻节点，以便重新加载游戏\r\n\tRemoveClientManager:function(){\r\n\t\tcc.game.removePersistRootNode(this.node);\r\n\t\t//清理已经加载的界面\r\n        app[app.subGameName + \"_FormManager\"]().loadFormDict = {};\r\n        app[app.subGameName + \"_FormManager\"]().showFormDict = {};\r\n        app[app.subGameName + \"_FormManager\"]().createingFormDict = {};\r\n        app[app.subGameName + \"_FormManager\"]().formWndShowInfo = {};\r\n        app[app.subGameName + \"_FormManager\"]().defaultFormNameList = [];\r\n        //释放已经加载的资源\r\n        this[app.subGameName + \"_ControlManager\"].ReleaseAllRes();\r\n        //清除注册事件\r\n        this.UnRegTargetEvent(this);\r\n        cc.game.off(cc.game.EVENT_HIDE);\r\n        cc.game.off(cc.game.EVENT_SHOW);\r\n        // app[app.subGameName + \"_NetManager\"]().UnAllRegNetPack();\r\n        let baseForm = require(app.subGameName + \"_BaseForm\");\r\n\t\tbaseForm._eventFuncDict = {};\r\n\t\tthis.destroy();\r\n\t},\r\n\r\n\tisInGame:function(){\r\n\t\tlet curRunGame = cc.sys.localStorage.getItem(\"curRunGame\");\r\n        if (curRunGame!= app.subGameName) {\r\n        \treturn false;\r\n        }\r\n        return true;\r\n\t},\r\n\tExitGame:function(switchGameData = null,isOutRoom='1'){\r\n        if (!cc.sys.isNative){\r\n            app[app.subGameName + \"_SceneManager\"]().LoadScene(app.subGameName + \"MainScene\");\r\n            return;\r\n        }\r\n        //联盟/亲友圈房间返回联盟/亲友圈房间列表\r\n        let roomMgr =app[app.subGameName.toUpperCase()+\"RoomMgr\"]();\r\n        if (roomMgr) {\r\n        \tif (roomMgr.clubId > 0 || roomMgr.unionId > 0) {\r\n        \t\tswitchGameData = {action:\"openClub\"};\r\n        \t}\r\n        }\r\n        if (switchGameData != null) {\r\n        \t// let testData = {action:\"showForm\", fromName:\"UIStore\"};\r\n        \tcc.sys.localStorage.setItem(\"isOutRoom\",isOutRoom);\r\n        \tcc.sys.localStorage.setItem(\"switchGameData\", JSON.stringify(switchGameData));\r\n        }\r\n        let curRunHall = cc.sys.localStorage.getItem(\"curRunHall\");\r\n\t\tlet self = this;\r\n\t\tapp[app.subGameName + \"_NetManager\"]().SendPack(\"base.C1110UUID\", { \"gameName\": \"hall\" }, function (event) {\r\n\t\t\tapp.LocalDataManager().SetConfigProperty(\"Account\", \"uuid\", event);\r\n\t\t\t//停止场景音乐\r\n\t\t\tapp[app.subGameName + \"_SoundManager\"]().StopAllSound();\r\n\t\t\t//如果是游戏切换需要释放内存，重新加载\r\n\t\t\tself.RemoveClientManager();\r\n\t\t\t//提前设置大厅的标识符，防止游戏内重连导致继续发送游戏\r\n\t\t\tcc.sys.localStorage.setItem(\"curRunGame\", \"hall\");\r\n\t\t\t//主动断开socket连接，服务端会将玩家踢出\r\n\t\t\tif (app[app.subGameName + \"_NetWork\"]().isConnectIng) {\r\n\t\t\t\tconsole.log(\"获取uuid成功，断开连接\");\r\n\t\t\t\tapp[app.subGameName + \"_NetManager\"]().Disconnect(true);\r\n\t\t\t\tapp[app.subGameName + \"_NetWork\"]().isReconnecting = false;\r\n\r\n\t\t\t}\r\n\t\t\tlet gamePath = (jsb.fileUtils ? jsb.fileUtils.getWritablePath() : '/') + \"ALLGame/\" + app.subGameName;\r\n\t\t\twindow.require(gamePath + \"/src/hall.js\");\r\n\t\t}, function (error) {\r\n\t\t\tconsole.log(\"获取uuid失败\");\r\n\t\t});\r\n    },\r\n\t\r\n\tRegisterHideShowEvent: function () {\r\n\t\tthis.UnRegisterHideShowEvent();\r\n\t\tconsole.log(\"====RegisterHideShowEvent\");\r\n\t\tcc.game.on(cc.game.EVENT_HIDE, this.OnEventHide, this);\r\n\t\tcc.game.on(cc.game.EVENT_SHOW, this.OnEventShow, this);\r\n\t},\r\n\r\n\tUnRegisterHideShowEvent: function () {\r\n\t\tconsole.log(\"====UnRegisterHideShowEvent\");\r\n\t\tcc.game.off(cc.game.EVENT_HIDE, this.OnEventHide, this);\r\n\t\tcc.game.off(cc.game.EVENT_SHOW, this.OnEventShow, this);\r\n\t},\r\n\r\n\r\n});\r\n\r\nmodule.exports = ddz_ClientManager;"]}