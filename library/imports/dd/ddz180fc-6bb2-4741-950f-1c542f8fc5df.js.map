{"version":3,"sources":["../../../../../assets/script/common/assets/script/common/ddz_HeroAccountManager.js"],"names":["app","require","ddz_HeroAccountManager","BaseClass","extend","Init","JS_Name","NetManager","subGameName","LocalDataManager","ShareDefine","SysNotifyManager","SysDataManager","RegHttpNetPack","OnHttpPack_AccountLogin","OnHttpPack_RegAccountResult","OnHttpPack_ChangeAccountPswResult","RegEvent","Event_CodeError","Event_ConnectFail","Event_ConnectHttpFail","Event_ConnectSuccess","PswReg","AccountReg","AccountFirstStrReg","OnReload","localAccountDict","logInAccountList","InitLocalAccount","lastChangeTime","IsDoLogining","dataInfo","event","codeInfo","KickOut_AccountAuthorizationFail","accountType","GetClientConfigProperty","SDKType_WeChat","gameLoadUrl","window","location","href","SetConfigProperty","IsFormShow","UpdateAccessPoint","now","Date","getTime","clientConfig","GetClientConfig","CheckServerUrl","join","console","log","HttpRequest","serverUrl","argString","requestType","sendPack","url","dataStr","JSON","stringify","timeOut","isError","httpRequest","XMLHttpRequest","timeout","open","setRequestHeader","that","onerror","ChangeAccessPoint","InitServerAddress","ontimeout","onreadystatechange","status","readyState","send","cc","sys","isNative","AccessPoint","GetConfigProperty","accountDict","accountList","charAccount","InArray","ErrLog","AddNewAccountList","account","token","Remove","push","SavePlayerAccount","DeleteLocalAccount","DeleteAllLocalAccount","GetAccountToken","hasOwnProperty","GetLocalAccountList","GetAccountProperty","property","SetAccountProperty","value","GetAccountInfo","CheckCanUseAccount","test","CheckCanUsePassWord","psw","CheckAccountFirstStr","ErrorCloseGame","game","off","EVENT_HIDE","EVENT_SHOW","LoadScene","switchGameData","roomMgr","toUpperCase","clubId","unionId","action","localStorage","setItem","StopAllSound","isConnectIng","Disconnect","RemoveClientManager","gamePath","jsb","fileUtils","getWritablePath","isReconnecting","accountID","uuid","SendPack","serverID","ClientVersion","GetHeroID","SendReConnect","version","reloginSign","signString","toString","sign","MD5","hex_md5","serverPack","result","Result","ShowSysMsg","Psw","sdkToken","accessTokenInfo","SDKType_WeChatApp","SDKType_Company","InitConnectServer","AccountLogin","isToken","isDoLogin","GetHttpSendPack","CharAccount","CharAccountPsw","IsToken","SendHttpPack","OneKeyRegAccount","SendRegAccount","accountPsw","SendChangeAccountPsw","oldPsw","newPsw","AccountID","OldPsw","NewPsw","LoginAccountBySDK","sdkType","mpID","sdkAccountID","director","getScene","_sgNode","scheduleOnce","SDKType","Token","UserData","SDKAccountID","state","OnEvent","g_ddz_HeroAccountManager","exports","GetModel"],"mappings":"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","file":"ddz_HeroAccountManager.js","sourceRoot":"../../../../../assets/script/common","sourcesContent":["/*\r\n    玩家账号数据管理器\r\n*/\r\nvar app = require(\"ddz_app\");\r\n\r\nvar ddz_HeroAccountManager = app.BaseClass.extend({\r\n\r\n    Init:function(){\r\n    \tthis.JS_Name = app[\"subGameName\"] + \"_HeroAccountManager\";\r\n\r\n    \tthis.NetManager = app[app.subGameName + \"_NetManager\"]();\r\n        this.LocalDataManager = app.LocalDataManager();\r\n        this.ShareDefine = app[app.subGameName + \"_ShareDefine\"]();\r\n\t    this.SysNotifyManager = app[app.subGameName + \"_SysNotifyManager\"]();\r\n\t    this.SysDataManager = app[app.subGameName + \"_SysDataManager\"]();\r\n\r\n        this.NetManager.RegHttpNetPack(0x0000, this.OnHttpPack_AccountLogin, this);\r\n        this.NetManager.RegHttpNetPack(0x0005, this.OnHttpPack_RegAccountResult, this);\r\n        this.NetManager.RegHttpNetPack(0x0006, this.OnHttpPack_ChangeAccountPswResult, this);\r\n\r\n\t    app[app.subGameName + \"Client\"].RegEvent(\"CodeError\", this.Event_CodeError, this);\r\n\t    app[app.subGameName + \"Client\"].RegEvent(\"ConnectFail\", this.Event_ConnectFail, this);\r\n\t    app[app.subGameName + \"Client\"].RegEvent(\"ConnectHttpFail\", this.Event_ConnectHttpFail, this);\r\n\t    app[app.subGameName + \"Client\"].RegEvent(app.subGameName + \"_ConnectSuccess\", this.Event_ConnectSuccess, this);\r\n\r\n\t    //密码正则表达式(长度5~11之间,只能包含字符,数字和下划线)\r\n\t    this.PswReg = /^(\\w){5,11}$/;\r\n\t    //账号正则表达式(字符开头,长度5~16之间,只能包含字符,数字和下划线)\r\n\t    this.AccountReg = /^[a-zA-Z]\\w{4,15}$/;\r\n\r\n\t    //账号首字符正则表达式(首字符字母)\r\n\t    this.AccountFirstStrReg = /^[a-zA-z]/;\r\n\r\n    \tthis.OnReload();\r\n\r\n        //本地缓存账号密码字典 {account:psw}\r\n        this.localAccountDict = {};\r\n        //登陆账号顺序列表 晚登陆的在后面\r\n        this.logInAccountList = [];\r\n\r\n        this.InitLocalAccount();\r\n        this.lastChangeTime=0;\r\n\t\t\r\n    },\r\n\r\n    //切换账号\r\n    OnReload:function(){\r\n    \tthis.IsDoLogining(false);\r\n    \tthis.dataInfo = {};\r\n    },\r\n\r\n\tEvent_CodeError:function(event){\r\n\t\tlet codeInfo = event;\r\n\t\t//如果是授权失败,过期了,重新授权\r\n\t\tif(codeInfo[\"Code\"] == this.ShareDefine.KickOut_AccountAuthorizationFail){\r\n\t\t\tlet accountType = app[app.subGameName + \"Client\"].GetClientConfigProperty(\"AccountType\");\r\n            if(accountType==this.ShareDefine.SDKType_WeChat){\r\n                //微信浏览器登录情况\r\n                let gameLoadUrl = app[app.subGameName + \"Client\"].GetClientConfigProperty(\"GameLoadUrl\");\r\n                window.location.href=gameLoadUrl;\r\n            }\r\n\t\t\tthis.LocalDataManager.SetConfigProperty(\"Account\", \"AccessTokenInfo\", {});\r\n\t\t\tif(app[app.subGameName + \"_FormManager\"]().IsFormShow(\"UILogin01\") == false){\r\n\t\t\t\tapp[app.subGameName + \"_FormManager\"]().IsFormShow(\"UILogin01\");\r\n\t\t\t}\r\n\t\t}\r\n\t\t//密码错误等异常,需要清除登录标示\r\n\t\tthis.IsDoLogining(false);\r\n\r\n\t},\r\n\t//连接服务器失败\r\n\tEvent_ConnectFail:function(event){\r\n\t\tthis.IsDoLogining(false);\r\n\t\tthis.UpdateAccessPoint();\r\n\t},\r\n\r\n\tEvent_ConnectHttpFail:function(event){\r\n\t\tthis.IsDoLogining(false);\r\n\t\tthis.UpdateAccessPoint();\r\n\t},\r\n    UpdateAccessPoint:function(){\r\n        let now= new Date().getTime();\r\n        if(now-this.lastChangeTime<5000){\r\n            return;\r\n        }\r\n        this.lastChangeTime = now;\r\n        let clientConfig = app[app.subGameName + \"Client\"].GetClientConfig();\r\n        let CheckServerUrl = ['http://', clientConfig[\"AccountServerIP\"], \":\",\"88\", \"/checklive.php\"].join(\"\");\r\n        console.log(\"Check CheckServerUrl:\"+CheckServerUrl);\r\n        this.HttpRequest(CheckServerUrl, \"\", \"GET\", {});\r\n        //this.ChangeAccessPoint();\r\n        //app[app.subGameName + \"_NetManager\"]().InitServerAddress();\r\n    },\r\n\r\n    HttpRequest: function (serverUrl, argString, requestType, sendPack) {\r\n        var url = [serverUrl, argString].join(\"\");\r\n        var dataStr = JSON.stringify(sendPack);\r\n        let timeOut = false;\r\n        let isError=false;\r\n        // 每次都实例化一个，否则会引起请求结束，实例被释放了\r\n        var httpRequest = new XMLHttpRequest();\r\n        httpRequest.timeout = 1500;\r\n        httpRequest.open(requestType, url, true);\r\n        // 服务器json解码\r\n        httpRequest.setRequestHeader(\"Content-Type\", \"application/json\");\r\n        var that = this;\r\n        httpRequest.onerror = function () {\r\n            console.log(\"Check CheckServerUrl Error\");\r\n            if (timeOut == true){\r\n                console.log(\"Check CheckServerUrl Error timeOut return\");\r\n                return;\r\n            }\r\n            isError=true;\r\n            that.ChangeAccessPoint();\r\n            app[app.subGameName + \"_NetManager\"]().InitServerAddress();\r\n        };\r\n        httpRequest.ontimeout = function () {\r\n            console.log(\"Check CheckServerUrl timeOut\");\r\n            if (isError == true){\r\n                console.log(\"Check CheckServerUrl timeOut Error return\");\r\n                return;\r\n            }\r\n            timeOut = true;\r\n            that.ChangeAccessPoint();\r\n            app[app.subGameName + \"_NetManager\"]().InitServerAddress();\r\n        };\r\n        httpRequest.onreadystatechange = function () {\r\n            if (timeOut == true || isError==true) {\r\n                console.log(\"Check CheckServerUrl timeOut2\");\r\n                return;\r\n            }\r\n            console.log(\"Check CheckServerUrl success:\"+httpRequest.status);\r\n            if (httpRequest.status == 200) {\r\n                if (httpRequest.readyState == 4) {\r\n                    console.log(\"Check CheckServerUrl success4\");\r\n                }\r\n            }\r\n        };\r\n        httpRequest.send(dataStr);\r\n    },\r\n    ChangeAccessPoint:function(){\r\n        if(!cc.sys.isNative){\r\n            return;  //浏览器不用切换节点\r\n        }\r\n        let AccessPoint=app.LocalDataManager().GetConfigProperty(\"Account\", \"AccessPoint\");\r\n        if(AccessPoint==0){\r\n            app.LocalDataManager().SetConfigProperty(\"Account\", \"AccessPoint\",1);\r\n        }else if(AccessPoint==1){\r\n            app.LocalDataManager().SetConfigProperty(\"Account\", \"AccessPoint\",2);\r\n        }else if(AccessPoint==2){\r\n            app.LocalDataManager().SetConfigProperty(\"Account\", \"AccessPoint\",3);\r\n        }else if(AccessPoint==3){\r\n            app.LocalDataManager().SetConfigProperty(\"Account\", \"AccessPoint\",0);\r\n        }\r\n    },\r\n    //---------------------本地账号逻辑-----------------\r\n\r\n    //解析本地缓存账号记录\r\n    InitLocalAccount:function(){\r\n        let accountDict = this.LocalDataManager.GetConfigProperty(\"Account\", \"AccountDict\");\r\n        let accountList = this.LocalDataManager.GetConfigProperty(\"Account\", \"AccountList\");\r\n\r\n        this.logInAccountList = accountList;\r\n\r\n        for(var charAccount in accountDict){\r\n            if(this.logInAccountList.InArray(charAccount, true)){\r\n                this.localAccountDict[charAccount] = accountDict[charAccount];\r\n            }\r\n            else{\r\n                this.ErrLog(\"InitLocalAccount logInAccountList not find :%s\", charAccount);\r\n            }\r\n        }\r\n    },\r\n\r\n    /**\r\n     * 增加本地缓存账号\r\n     * @param account\r\n     * @param psw\r\n     */\r\n    AddNewAccountList:function(account, token){\r\n\r\n        if (this.logInAccountList.InArray(account)){\r\n            this.logInAccountList.Remove(account);\r\n            this.logInAccountList.push(account);\r\n        }\r\n        else{\r\n            this.logInAccountList.push(account);\r\n        }\r\n\r\n        this.localAccountDict[account] = token;\r\n\r\n        this.SavePlayerAccount();\r\n    },\r\n\r\n    /**\r\n     * 删除本地账号\r\n     * @param account\r\n     */\r\n    DeleteLocalAccount:function(account){\r\n\r\n        if(this.logInAccountList.InArray(account)){\r\n            this.logInAccountList.Remove(account);\r\n\r\n        }\r\n        delete this.localAccountDict[account];\r\n\r\n        this.SavePlayerAccount();\r\n\r\n    },\r\n\r\n    /**\r\n     * 清除本地所有账号\r\n     * @param account\r\n     */\r\n    DeleteAllLocalAccount:function(){\r\n        this.localAccountDict = {};\r\n        this.logInAccountList = [];\r\n        this.SavePlayerAccount();\r\n    },\r\n\r\n    /**\r\n     * 保存账号数据\r\n     */\r\n    SavePlayerAccount:function(){\r\n        this.LocalDataManager.SetConfigProperty(\"Account\", \"AccountDict\", this.localAccountDict);\r\n        this.LocalDataManager.SetConfigProperty(\"Account\", \"AccountList\", this.logInAccountList);\r\n    },\r\n\r\n    /**\r\n     * 获取账号密码\r\n     * @param account\r\n     */\r\n    GetAccountToken:function(account){\r\n        if (!this.localAccountDict.hasOwnProperty(account)){\r\n            // this.Log(\"GetAccountToken not find:%s\", account);\r\n            return \"\"\r\n        }\r\n        return this.localAccountDict[account]\r\n    },\r\n\r\n    /**\r\n     * 获取缓存账号列表\r\n     */\r\n    GetLocalAccountList:function(){\r\n        return this.logInAccountList\r\n    },\r\n\r\n    GetAccountProperty:function(property){\r\n        if(!this.dataInfo.hasOwnProperty(property)){\r\n            this.ErrLog(\"GetAccountProperty not find:%s\", property);\r\n            return\r\n        }\r\n        return this.dataInfo[property];\r\n    },\r\n\r\n    SetAccountProperty:function(property, value){\r\n        this.dataInfo[property] = value;\r\n    },\r\n\r\n\t//获取账号属性\r\n\tGetAccountInfo:function(){\r\n\t\treturn this.dataInfo;\r\n\t},\r\n\r\n\t/**\r\n\t * 检测账号是否合法\r\n\t */\r\n\tCheckCanUseAccount:function(account){\r\n\t\treturn this.AccountReg.test(account)\r\n\t},\r\n\r\n\t/**\r\n\t * 检测密码合法\r\n\t * @param psw\r\n\t */\r\n\tCheckCanUsePassWord:function(psw){\r\n\t\treturn this.PswReg.test(psw)\r\n\t},\r\n\r\n\tCheckAccountFirstStr:function(account){\r\n\t\treturn this.AccountFirstStrReg.test(account);\r\n\t},\r\n\r\n    //---------------------事件回掉函数-----------------\r\n    ErrorCloseGame:function(){\r\n        console.log(\"异常关闭游戏：\"+app.subGameName);    \r\n        cc.game.off(cc.game.EVENT_HIDE);\r\n        cc.game.off(cc.game.EVENT_SHOW);\r\n        if (!cc.sys.isNative){\r\n            app[app.subGameName + \"_SceneManager\"]().LoadScene(app.subGameName + \"MainScene\");\r\n            return;\r\n        }\r\n        let switchGameData = null;\r\n        let roomMgr =app[app.subGameName.toUpperCase()+\"RoomMgr\"]();\r\n        if (roomMgr) {\r\n            if (roomMgr.clubId > 0 || roomMgr.unionId > 0) {\r\n                switchGameData = {action:\"openClub\"};\r\n            }\r\n        }\r\n        if (switchGameData != null) {\r\n            cc.sys.localStorage.setItem(\"switchGameData\", JSON.stringify(switchGameData));\r\n        }\r\n        app[app.subGameName + \"_SoundManager\"]().StopAllSound();\r\n        //主动断开socket连接，服务端会将玩家踢出\r\n        if(app[app.subGameName + \"_NetWork\"]().isConnectIng){\r\n           app[app.subGameName + \"_NetManager\"]().Disconnect(true);\r\n        }\r\n        app[app.subGameName + \"Client\"].RemoveClientManager();\r\n        let gamePath = (jsb.fileUtils ? jsb.fileUtils.getWritablePath() : '/') + \"ALLGame/\"+app.subGameName;\r\n        console.log(\"ExitGame gamePath:\"+gamePath);\r\n        window.require(gamePath + \"/src/hall.js\");\r\n\r\n    },\r\n    //连接服务器成功\r\n\tEvent_ConnectSuccess:function(event){\r\n        console.log(app.subGameName + \" 连接服务器成功\");\r\n        app[app.subGameName + \"_NetWork\"]().isReconnecting=false;\r\n        app[app.subGameName + \"_NetWork\"]().isConnectIng=true;\r\n        if(!this.dataInfo[\"AccountID\"]){\r\n\t\t\tconsole.log(\"Event_ConnectSuccess not dataInfo\");\r\n            \r\n            this.IsDoLogining(false);\r\n            //本地开发项目跳过登录，请求一个游客账号\r\n            if (!cc.sys.isNative) {\r\n                // this.NetManager.SendPack(\"base.C1111RoleReLogin\", {\"accountID\":0, \"uuid\":0, \"gameName\":app.subGameName});\r\n                //this.OneKeyRegAccount();\r\n            }else{\r\n                let accountID = this.LocalDataManager.GetConfigProperty(\"Account\", \"AccountID\");\r\n                let uuid = this.LocalDataManager.GetConfigProperty(\"Account\", \"uuid\");\r\n                this.NetManager.SendPack(\"base.C1111RoleReLogin\", {\"accountID\":accountID, \"uuid\":uuid, \"gameName\":app.subGameName});\r\n                this.dataInfo[\"AccountID\"] = accountID;\r\n            }\r\n\t\t\treturn;\r\n\t\t}\r\n        //网页测试用游客登录\r\n        if (!cc.sys.isNative) {\r\n            let serverID = app[app.subGameName + \"Client\"].GetClientConfigProperty(\"ServerID\");\r\n            let sendPack = {\r\n                \"accountID\":this.dataInfo[\"AccountID\"],\r\n                \"openid\":this.dataInfo[\"Openid\"],\r\n                \"unionid\":this.dataInfo[\"Unionid\"],\r\n                \"token\":this.dataInfo[\"Token\"],\r\n                \"nickName\":this.dataInfo[\"NickName\"],\r\n                \"sex\":this.dataInfo[\"Sex\"],\r\n                \"headImageUrl\":this.dataInfo[\"HeadImageUrl\"],\r\n                \"serverID\":serverID,\r\n                \"version\":this.ShareDefine.ClientVersion,\r\n            };\r\n\r\n            //如果是重连\r\n            if(app[app.subGameName + \"_HeroManager\"]().GetHeroID()){\r\n                this.NetManager.SendReConnect(\"base.C1004Login\", sendPack);\r\n            }\r\n            else{\r\n                //登录过程完成\r\n                this.IsDoLogining(false);\r\n                //发送登陆token到connector\r\n                console.log(\"登录过程完成:\",JSON.stringify(sendPack));\r\n                this.NetManager.SendPack(\"base.C1004Login\", sendPack);\r\n            }\r\n        }else{\r\n            //如果是重连\r\n            if(app[app.subGameName + \"_HeroManager\"]().GetHeroID()){\r\n                let accountID = this.dataInfo[\"AccountID\"];\r\n                let version = \"1.0.1\";\r\n                let reloginSign = this.dataInfo[\"reloginSign\"];\r\n                if (typeof(accountID) == \"undefined\") {\r\n                    console.log(\"本地内存还没获取到accountID\");\r\n                    this.ErrorCloseGame();\r\n                    return;\r\n                }\r\n                if (typeof(reloginSign) == \"undefined\") {\r\n                    console.log(\"本地内存还没获取到reloginSign\");\r\n                    this.ErrorCloseGame();\r\n                    return;\r\n                }\r\n                let signString = \"accountID=\" + accountID.toString() + \"&version=\" + version + \"&\" + reloginSign.toString();\r\n                let sign = app.MD5.hex_md5(signString);\r\n                this.NetManager.SendReConnect(\"base.C1008Login\", {\"accountID\":accountID, \"version\":version, \"sign\":sign});\r\n            }\r\n        }\r\n\t\t\r\n    },\r\n\r\n\t//注册账号结果\r\n\tOnHttpPack_RegAccountResult:function(serverPack){\r\n\t\tlet result = serverPack.Result;\r\n\t\tif(result == 1){\r\n\t\t\tthis.SysNotifyManager.ShowSysMsg(\"Account_RegAccountFind\");\r\n\t\t}\r\n\t\tthis.IsDoLogining(false);\r\n\t},\r\n\r\n\t//修改密码结果\r\n\tOnHttpPack_ChangeAccountPswResult:function(serverPack){\r\n\t\tthis.dataInfo[\"CharAccountPsw\"] = serverPack.Psw;\r\n\r\n\t\tthis.SysNotifyManager.ShowSysMsg(\"Account_ChangeAccountPswSuccess\");\r\n\t},\r\n\r\n\r\n\t//账号服务器登录账号回复\r\n\tOnHttpPack_AccountLogin:function(serverPack){\r\n\t\tthis.dataInfo = serverPack;\r\n\r\n\t\t//每次登陆都覆盖缓存的sdkToken(客户端只记录一个玩家登陆token)\r\n\t\tlet sdkToken = this.dataInfo[\"SDKToken\"];\r\n\t\tlet accountType = this.dataInfo[\"AccountType\"];\r\n\t\tlet accountID = this.dataInfo[\"AccountID\"];\r\n\r\n\t\tlet accessTokenInfo = {};\r\n\t\t//如果是微信APP,sdk授权登录\r\n\t\tif(sdkToken && accountType == this.ShareDefine.SDKType_WeChatApp){\r\n\t\t\taccessTokenInfo = {\r\n\t\t\t\t\"SDKToken\":sdkToken,\r\n\t\t\t\t\"AccountType\":accountType,\r\n\t\t\t\t\"AccountID\":accountID,\r\n\t\t\t};\r\n\t\t}\r\n\t\tthis.ErrLog(\"OnHttpPack_AccountLogin sdkToken:%s, accessTokenInfo:%s\", sdkToken, JSON.stringify(accessTokenInfo));\r\n\t\tthis.LocalDataManager.SetConfigProperty(\"Account\", \"AccessTokenInfo\", accessTokenInfo);\r\n\r\n\r\n\t\t//如果是公司内部账号,需要保存账号记录\r\n\t\tif(accountType == this.ShareDefine.SDKType_Company){\r\n\t\t\tthis.AddNewAccountList(this.dataInfo[\"CharAccount\"], this.dataInfo[\"Token\"])\r\n\t\t}\r\n\r\n        this.NetManager.InitConnectServer();\r\n\r\n    },\r\n\r\n    //----------------------操作函数--------------------\r\n\r\n    //账号密码连接\r\n    AccountLogin:function(charAccount, psw, isToken){\r\n\r\n    \tif(this.isDoLogin){\r\n    \t\tthis.ErrLog(\"AccountLogin(%s,%s) is doing login\", charAccount, psw);\r\n    \t\treturn\r\n    \t}\r\n    \tthis.IsDoLogining(true);\r\n\r\n\t    let sendPack = this.NetManager.GetHttpSendPack(0xFF03);\r\n\t    sendPack.CharAccount = charAccount;\r\n\t    sendPack.CharAccountPsw = psw;\r\n\t    sendPack.IsToken = isToken;\r\n\t    this.NetManager.SendHttpPack(sendPack);\r\n    },\r\n\r\n    //一键注册账号密码\r\n    OneKeyRegAccount:function(){\r\n\r\n    \tif(this.isDoLogin){\r\n    \t\tthis.ErrLog(\"OneKeyRegAccount is doing login\");\r\n    \t\treturn\r\n    \t}\r\n        this.IsDoLogining(true);\r\n\r\n        let sendPack = this.NetManager.GetHttpSendPack(0xFF00);\r\n    \tthis.NetManager.SendHttpPack(sendPack);\r\n\r\n    },\r\n\r\n\tSendRegAccount:function(charAccount, accountPsw){\r\n\t\tif(this.isDoLogin){\r\n\t\t\tthis.ErrLog(\"SendRegAccount is doing login\");\r\n\t\t\treturn\r\n\t\t}\r\n\t\tthis.IsDoLogining(true);\r\n\r\n\t\tlet sendPack = this.NetManager.GetHttpSendPack(0xFF07);\r\n\t\tsendPack.CharAccount = charAccount;\r\n\t\tsendPack.Psw = accountPsw;\r\n\t\tthis.NetManager.SendHttpPack(sendPack);\r\n\t},\r\n\r\n\tSendChangeAccountPsw:function(accountID, oldPsw, newPsw){\r\n\t\tlet sendPack = this.NetManager.GetHttpSendPack(0xFF08);\r\n\t\tsendPack.AccountID = accountID;\r\n\t\tsendPack.OldPsw = oldPsw;\r\n\t\tsendPack.NewPsw = newPsw;\r\n\t\tthis.NetManager.SendHttpPack(sendPack);\r\n\t},\r\n\r\n\t//sdk授权登录\r\n\t//sdkType:sdk类型\r\n\t//token:授权code\r\n\t//mpID:使用到的对应第3方标示(公众号)\r\n    LoginAccountBySDK:function(sdkType, token, mpID, sdkAccountID){\r\n        if(this.isDoLogin){\r\n\t\t\tthis.ErrLog(\"LoginAccountBySDK is doing (%s,%s) login\", sdkType, token);\r\n\t\t\tthis.IsDoLogining(false);\r\n\t\t\tlet that = this;\r\n\t\t\tcc.director.getScene()._sgNode.scheduleOnce(function(){\r\n//\t\t\t\t\tthat.SysLog(\"LoginAccountBySDK 0123456\");\r\n\t\t\t\t\tthat.IsDoLogining(false);\r\n\t\t\t\t}, 0.5);\r\n            return\r\n        }\r\n        this.IsDoLogining(true);\r\n\r\n\t    if(!sdkAccountID){\r\n\t\t    sdkAccountID = 0;\r\n\t    }\r\n        let sendPack = this.NetManager.GetHttpSendPack(0xFF02);\r\n        sendPack.SDKType = sdkType;\r\n        sendPack.Token = token;\r\n        sendPack.UserData = mpID;\r\n        sendPack.SDKAccountID = sdkAccountID;\r\n        this.NetManager.SendHttpPack(sendPack);\r\n    },\r\n\r\n    //设置是否是在登录\r\n    IsDoLogining:function(state)\r\n    {\r\n        this.isDoLogin = state;\r\n        if (state) {\r\n            app[app.subGameName + \"Client\"].OnEvent(\"ChangeBtnState\", {\"state\":1});\r\n        } else {\r\n            app[app.subGameName + \"Client\"].OnEvent(\"ChangeBtnState\", {\"state\":0});\r\n        }\r\n    },\r\n});\r\n\r\nvar g_ddz_HeroAccountManager = null;\r\n\r\n/**\r\n * 绑定模块外部方法\r\n */\r\nexports.GetModel = function(){\r\n    if(!g_ddz_HeroAccountManager){\r\n        g_ddz_HeroAccountManager = new ddz_HeroAccountManager();\r\n    }\r\n    return g_ddz_HeroAccountManager;\r\n}"]}