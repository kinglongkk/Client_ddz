{"version":3,"sources":["../../../../../assets/script/scene/assets/script/scene/ddz_BaseScene.js"],"names":["app","require","cc","Class","extends","Component","properties","BackgroundLayer","Prefab","SceneEffectLayer","UILayer","TopLayer","onLoad","SceneManager","ddz_SceneManager","LocalDataManager","sceneType","GetSceneType","JS_Name","SoundManager","ddz_SoundManager","SysDataManager","ddz_SysDataManager","ShareDefine","ddz_ShareDefine","SceneInfo","GetTableDict","LayerLv_Background","LayerLv_SceneEffect","LayerLv_UI","LayerLv_Top","LayerLv_Debug","node","on","OnTouchStart","OnTouchMove","OnTouchEnd","OnTouchCancel","InitLayer","OnCreate","BackgroundLayerComponent","SceneEffectLayerNodeComponent","TopLayerNodeComponent","UILayerNode","backgroundLayerNode","instantiate","addChild","getComponent","subGameName","sceneEffectLayerNode","ErrLog","topLayerNode","debugModel","GetDebugModel","event","update","dt","nowTick","Date","now","OnUpdate","error","stack","OnBaseTimer","passSecond","OnTimer","OnBeforeExitScene","removeChild","OnSwithSceneEnd","OnShowDefaultForm","OnEventHide","OnEventShow","OnTopEvent","eventType","OnShakeScene","rightDeltaPos","v2","leftDeltaPos","action","sequence","moveBy","runAction","cloneAction","clone","AddSceneEffect","effectName","effectRes","repeatCount","userData","DeleteSceneEffect","modelComponent","OnReload"],"mappings":";;;;;;AAAA;;;AAGA,IAAIA,MAAMC,QAAQ,SAAR,CAAV;;AAEAC,GAAGC,KAAH,CAAS;AACLC,UAASF,GAAGG,SADP;;AAGLC,aAAY;AACXC,mBAAgBL,GAAGM,MADR;AAEXC,oBAAiBP,GAAGM,MAFT;AAGXE,WAAQR,GAAGM,MAHA;AAIXG,YAAST,GAAGM;AAJD,EAHP;;AAUL;AACA;AACAI,SAAQ,kBAAY;;AAEnB,MAAIC,eAAeb,IAAIc,gBAAJ,EAAnB;AACG,OAAKC,gBAAL,GAAwBf,IAAIe,gBAAJ,EAAxB;AACH;AACG,MAAIC,YAAYH,aAAaI,YAAb,EAAhB;AACA,OAAKD,SAAL,GAAiBA,SAAjB;AACA,OAAKE,OAAL,GAAeF,SAAf;;AAEH,OAAKG,YAAL,GAAoBnB,IAAIoB,gBAAJ,EAApB;AACA,OAAKC,cAAL,GAAsBrB,IAAIsB,kBAAJ,EAAtB;AACA,OAAKC,WAAL,GAAmBvB,IAAIwB,eAAJ,EAAnB;;AAEA,OAAKC,SAAL,GAAiB,KAAKJ,cAAL,CAAoBK,YAApB,CAAiC,WAAjC,CAAjB;;AAEA,OAAKC,kBAAL,GAA0B,CAA1B;AACA,OAAKC,mBAAL,GAA2B,CAA3B;AACA,OAAKC,UAAL,GAAkB,CAAlB;AACA,OAAKC,WAAL,GAAmB,CAAnB;AACA,OAAKC,aAAL,GAAqB,CAArB;;AAEG,OAAKC,IAAL,CAAUC,EAAV,CAAa,YAAb,EAA2B,KAAKC,YAAhC,EAA8C,IAA9C;AACA,OAAKF,IAAL,CAAUC,EAAV,CAAa,WAAb,EAA0B,KAAKE,WAA/B,EAA4C,IAA5C;AACA,OAAKH,IAAL,CAAUC,EAAV,CAAa,UAAb,EAAyB,KAAKG,UAA9B,EAA0C,IAA1C;AACA,OAAKJ,IAAL,CAAUC,EAAV,CAAa,aAAb,EAA4B,KAAKI,aAAjC,EAAgD,IAAhD;;AAEH;AACA,OAAKC,SAAL;;AAEG,OAAKC,QAAL;AACH,EA1CI;;AA4CR;AACAD,YAAU,qBAAU;;AAEnB,OAAKE,wBAAL,GAAgC,IAAhC;AACA,OAAKC,6BAAL,GAAqC,IAArC;AACA,OAAKC,qBAAL,GAA6B,IAA7B;;AAEA,OAAKC,WAAL,GAAmB,IAAnB;;AAEA;AACA;AACA,MAAG,KAAKpC,eAAR,EAAwB;AACvB,OAAIqC,sBAAsB1C,GAAG2C,WAAH,CAAe,KAAKtC,eAApB,CAA1B;AACA,QAAKyB,IAAL,CAAUc,QAAV,CAAmBF,mBAAnB,EAAwC,KAAKjB,kBAA7C;AACA,QAAKa,wBAAL,GAAgCI,oBAAoBG,YAApB,CAAiC/C,IAAIgD,WAAJ,GAAkB,kBAAnD,CAAhC;AACA,QAAKR,wBAAL,CAA8BD,QAA9B,CAAuC,KAAKvB,SAA5C;AACA;;AAED;AACA,MAAG,KAAKP,gBAAR,EAAyB;AACxB,OAAIwC,uBAAuB/C,GAAG2C,WAAH,CAAe,KAAKpC,gBAApB,CAA3B;AACA,QAAKuB,IAAL,CAAUc,QAAV,CAAmBG,oBAAnB,EAAyC,KAAKrB,mBAA9C;AACA,QAAKa,6BAAL,GAAqCQ,qBAAqBF,YAArB,CAAkC/C,IAAIgD,WAAJ,GAAkB,mBAApD,CAArC;AACA,QAAKP,6BAAL,CAAmCF,QAAnC,CAA4C,KAAKvB,SAAjD;AACA;;AAED;;AAEA;AACA,MAAG,KAAKN,OAAR,EAAgB;AACf,QAAKiC,WAAL,GAAmBzC,GAAG2C,WAAH,CAAe,KAAKnC,OAApB,CAAnB;AACA,QAAKsB,IAAL,CAAUc,QAAV,CAAmB,KAAKH,WAAxB,EAAqC,KAAKd,UAA1C;AACA,QAAKc,WAAL,CAAiBI,YAAjB,CAA8B/C,IAAIgD,WAAJ,GAAkB,UAAhD,EAA4DT,QAA5D,CAAqE,KAAKvB,SAA1E;AACA,GAJD,MAKI;AACH,QAAKkC,MAAL,CAAY,4BAAZ;AACA;;AAED;AACA,MAAG,KAAKvC,QAAR,EAAiB;AAChB,OAAIwC,eAAejD,GAAG2C,WAAH,CAAe,KAAKlC,QAApB,CAAnB;AACA,QAAKqB,IAAL,CAAUc,QAAV,CAAmBK,YAAnB,EAAiC,KAAKrB,WAAtC;AACA,QAAKY,qBAAL,GAA6BS,aAAaJ,YAAb,CAA0B/C,IAAIgD,WAAJ,GAAkB,WAA5C,CAA7B;AACA,QAAKN,qBAAL,CAA2BH,QAA3B,CAAoC,KAAKvB,SAAzC;AACA,GALD,MAMI;AACH,QAAKkC,MAAL,CAAY,6BAAZ;AACA;;AAED,OAAKE,UAAL,GAAkB,IAAlB;AACA,MAAIA,aAAapD,IAAIA,IAAIgD,WAAJ,GAAkB,QAAtB,EAAgCK,aAAhC,EAAjB;AACA,MAAGD,UAAH,EAAc;AACb,QAAKpB,IAAL,CAAUc,QAAV,CAAmBM,WAAWpB,IAA9B,EAAoC,KAAKF,WAAzC;AACA,QAAKsB,UAAL,GAAkBA,UAAlB;AACA;AAED,EApGO;;AAsGL;AACAlB,eAAa,sBAASoB,KAAT,EAAe,CAC3B,CAxGI;;AA0GLnB,cAAY,qBAASmB,KAAT,EAAe,CAC1B,CA3GI;;AA6GLlB,aAAW,oBAASkB,KAAT,EAAe,CACzB,CA9GI;;AAgHLjB,gBAAc,uBAASiB,KAAT,EAAe,CAC5B,CAjHI;;AAmHL;AACAC,SAAQ,gBAAUC,EAAV,EAAc;AAClB,MAAI;AACH,OAAIC,UAAUC,KAAKC,GAAL,EAAd;;AAEA,OAAG,KAAKP,UAAR,EAAmB;AAClB,SAAKA,UAAL,CAAgBQ,QAAhB,CAAyBJ,EAAzB;AACA;;AAED,QAAKd,qBAAL,CAA2BkB,QAA3B,CAAoCH,OAApC;;AAEG,QAAKG,QAAL,CAAcJ,EAAd;AACH,GAVD,CAWA,OAAMK,KAAN,EAAY;AACd,QAAKX,MAAL,CAAY,WAAZ,EAAyBW,MAAMC,KAA/B;AACG;AAEJ,EApII;;AAsIL;AACAC,cAAY,qBAASC,UAAT,EAAoB;AAC5B,OAAKC,OAAL,CAAaD,UAAb;AACH,EAzII;;AA2IL;AACAE,oBAAkB,6BAAU;;AAE3B,MAAG,KAAKzB,6BAAR,EAAsC;AACrC,QAAKA,6BAAL,CAAmCyB,iBAAnC;AACA;;AAED;AACA,MAAG,KAAKd,UAAR,EAAmB;AACrB,QAAKpB,IAAL,CAAUmC,WAAV,CAAsB,KAAKf,UAAL,CAAgBpB,IAAtC;AACG,QAAKoB,UAAL,GAAkB,IAAlB;AACA;;AAED,OAAKV,qBAAL,CAA2BwB,iBAA3B;AACA,EAzJI;;AA2JL;AACAE,kBAAgB,2BAAU,CACzB,CA7JI;;AA+JR;AACAC,oBAAkB,6BAAU,CAE3B,CAlKO;;AAoKL;AACAC,cAAY,uBAAU,CACrB,CAtKI;;AAwKL;AACAC,cAAY,uBAAU,CACrB,CA1KI;;AA4KR;AACA;AACAC,aAAW,oBAASC,SAAT,EAAmB;AAC7B,OAAK/B,qBAAL,CAA2B8B,UAA3B,CAAsCC,SAAtC;AACA,EAhLO;;AAkLL;;AAEH;AACAC,eAAa,wBAAU;AACtB,MAAIC,gBAAgBzE,GAAG0E,EAAH,CAAM,CAAN,EAAQ,CAAR,CAApB;AACA,MAAIC,eAAe3E,GAAG0E,EAAH,CAAM,CAAC,CAAP,EAAS,CAAT,CAAnB;;AAEA,MAAIE,SAAS5E,GAAG6E,QAAH,CACN7E,GAAG8E,MAAH,CAAU,KAAV,EAAgB9E,GAAG0E,EAAH,CAAM,CAAN,EAAQ,CAAR,CAAhB,CADM,EAEN1E,GAAG8E,MAAH,CAAU,KAAV,EAAgBH,YAAhB,CAFM,EAGN3E,GAAG8E,MAAH,CAAU,KAAV,EAAgBL,aAAhB,CAHM,EAINzE,GAAG8E,MAAH,CAAU,KAAV,EAAgB9E,GAAG0E,EAAH,CAAM,CAAC,CAAP,EAAS,CAAT,CAAhB,CAJM,CAAb;;AAOA,OAAKjC,WAAL,CAAiBsC,SAAjB,CAA2BH,MAA3B;;AAEA,MAAG,KAAKtC,wBAAR,EAAiC;AAChC,OAAI0C,cAAcJ,OAAOK,KAAP,EAAlB;AACA,QAAK3C,wBAAL,CAA8BR,IAA9B,CAAmCiD,SAAnC,CAA6CC,WAA7C;AACA;AACD,EAtMO;;AAwML;;AAEA;AACAE,iBAAe,wBAASC,UAAT,EAAqBC,SAArB,EAA0D;AAAA,MAA1BC,WAA0B,uEAAd,CAAc;AAAA,MAAXC,QAAW,uEAAF,CAAE;;AACxE,SAAO,KAAK/C,6BAAL,CAAmC2C,cAAnC,CAAkDC,UAAlD,EAA8DC,SAA9D,EAAyEC,WAAzE,EAAsFC,QAAtF,CAAP;AACA,EA7MI;;AA+MLC,oBAAkB,2BAASC,cAAT,EAAwB;AACzC,OAAKjD,6BAAL,CAAmCgD,iBAAnC,CAAqDC,cAArD;AACA,EAjNI;;AAmNL;AACAnD,WAAS,oBAAU,CAElB,CAtNI;;AAwNL;AACAqB,WAAS,kBAASJ,EAAT,EAAY,CAEpB,CA3NI;;AA6NLS,UAAQ,iBAASD,UAAT,EAAoB,CAE3B,CA/NI;AAgOL;AACA2B,WAAS,oBAAU,CAElB;AAnOI,CAAT","file":"ddz_BaseScene.js","sourceRoot":"../../../../../assets/script/scene","sourcesContent":["/*\r\n    场景基类接口\r\n*/\r\nvar app = require(\"ddz_app\");\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n\t    BackgroundLayer:cc.Prefab,\r\n\t    SceneEffectLayer:cc.Prefab,\r\n\t    UILayer:cc.Prefab,\r\n\t    TopLayer:cc.Prefab,\r\n    },\r\n\r\n    //--------------回掉函数----------------\r\n    // 加载创建\r\n    onLoad: function () {\r\n\r\n\t    let SceneManager = app.ddz_SceneManager();\r\n        this.LocalDataManager = app.LocalDataManager();\r\n\t    //获取当前的地图ID\r\n        let sceneType = SceneManager.GetSceneType();\r\n        this.sceneType = sceneType;\r\n        this.JS_Name = sceneType;\r\n\r\n\t    this.SoundManager = app.ddz_SoundManager();\r\n\t    this.SysDataManager = app.ddz_SysDataManager();\r\n\t    this.ShareDefine = app.ddz_ShareDefine();\r\n\r\n\t    this.SceneInfo = this.SysDataManager.GetTableDict(\"SceneInfo\");\r\n\r\n\t    this.LayerLv_Background = 0;\r\n\t    this.LayerLv_SceneEffect = 4;\r\n\t    this.LayerLv_UI = 5;\r\n\t    this.LayerLv_Top = 7;\r\n\t    this.LayerLv_Debug = 8;\r\n\r\n        this.node.on(\"touchstart\", this.OnTouchStart, this);\r\n        this.node.on(\"touchmove\", this.OnTouchMove, this);\r\n        this.node.on(\"touchend\", this.OnTouchEnd, this);\r\n        this.node.on(\"touchcancel\", this.OnTouchCancel, this);\r\n\r\n\t    //--------------创建场景层--------------\r\n\t    this.InitLayer();\r\n\r\n        this.OnCreate();\r\n    },\r\n\r\n\t//初始化场景层相关\r\n\tInitLayer:function(){\r\n\r\n\t\tthis.BackgroundLayerComponent = null;\r\n\t\tthis.SceneEffectLayerNodeComponent = null;\r\n\t\tthis.TopLayerNodeComponent = null;\r\n\r\n\t\tthis.UILayerNode = null;\r\n\r\n\t\t//-----------可选层---------------\r\n\t\t//需要显示场景背景是创建的层\r\n\t\tif(this.BackgroundLayer){\r\n\t\t\tlet backgroundLayerNode = cc.instantiate(this.BackgroundLayer);\r\n\t\t\tthis.node.addChild(backgroundLayerNode, this.LayerLv_Background);\r\n\t\t\tthis.BackgroundLayerComponent = backgroundLayerNode.getComponent(app.subGameName + \"_BackgroundLayer\");\r\n\t\t\tthis.BackgroundLayerComponent.OnCreate(this.sceneType);\r\n\t\t}\r\n\r\n\t\t//需要播放场景特效是创建的层\r\n\t\tif(this.SceneEffectLayer){\r\n\t\t\tlet sceneEffectLayerNode = cc.instantiate(this.SceneEffectLayer);\r\n\t\t\tthis.node.addChild(sceneEffectLayerNode, this.LayerLv_SceneEffect);\r\n\t\t\tthis.SceneEffectLayerNodeComponent = sceneEffectLayerNode.getComponent(app.subGameName + \"_SceneEffectLayer\");\r\n\t\t\tthis.SceneEffectLayerNodeComponent.OnCreate(this.sceneType);\r\n\t\t}\r\n\r\n\t\t//----------以下是必须存在的层-----------------\r\n\r\n\t\t//场景UI层\r\n\t\tif(this.UILayer){\r\n\t\t\tthis.UILayerNode = cc.instantiate(this.UILayer);\r\n\t\t\tthis.node.addChild(this.UILayerNode, this.LayerLv_UI);\r\n\t\t\tthis.UILayerNode.getComponent(app.subGameName + \"_UILayer\").OnCreate(this.sceneType);\r\n\t\t}\r\n\t\telse{\r\n\t\t\tthis.ErrLog(\"InitLayer not find UILayer\");\r\n\t\t}\r\n\r\n\t\t//置顶模态层\r\n\t\tif(this.TopLayer){\r\n\t\t\tlet topLayerNode = cc.instantiate(this.TopLayer);\r\n\t\t\tthis.node.addChild(topLayerNode, this.LayerLv_Top);\r\n\t\t\tthis.TopLayerNodeComponent = topLayerNode.getComponent(app.subGameName + \"_TopLayer\");\r\n\t\t\tthis.TopLayerNodeComponent.OnCreate(this.sceneType);\r\n\t\t}\r\n\t\telse{\r\n\t\t\tthis.ErrLog(\"InitLayer not find TopLayer\");\r\n\t\t}\r\n\r\n\t\tthis.debugModel = null;\r\n\t\tlet debugModel = app[app.subGameName + \"Client\"].GetDebugModel();\r\n\t\tif(debugModel){\r\n\t\t\tthis.node.addChild(debugModel.node, this.LayerLv_Top);\r\n\t\t\tthis.debugModel = debugModel;\r\n\t\t}\r\n\r\n\t},\r\n\r\n    //-------------点击事件--------------\r\n    OnTouchStart:function(event){\r\n    },\r\n\r\n    OnTouchMove:function(event){\r\n    },\r\n\r\n    OnTouchEnd:function(event){\r\n    },\r\n\r\n    OnTouchCancel:function(event){\r\n    },\r\n\r\n    //每帧回掉\r\n    update: function (dt) {\r\n        try {\r\n\t        let nowTick = Date.now();\r\n\r\n\t        if(this.debugModel){\r\n\t\t        this.debugModel.OnUpdate(dt);\r\n\t        }\r\n\r\n\t        this.TopLayerNodeComponent.OnUpdate(nowTick);\r\n\r\n            this.OnUpdate(dt);\r\n        }\r\n        catch(error){\r\n\t\t    this.ErrLog(\"update：%s\", error.stack);\r\n        }\r\n\r\n    },\r\n\r\n    //100毫秒毁掉\r\n    OnBaseTimer:function(passSecond){\r\n        this.OnTimer(passSecond)\r\n    },\r\n\r\n    //场景准备退出前\r\n    OnBeforeExitScene:function(){\r\n\r\n\t    if(this.SceneEffectLayerNodeComponent){\r\n\t\t    this.SceneEffectLayerNodeComponent.OnBeforeExitScene();\r\n\t    }\r\n\r\n\t    //退出场景移除debug\r\n\t    if(this.debugModel){\r\n\t\t\tthis.node.removeChild(this.debugModel.node);\r\n\t\t    this.debugModel = null;\r\n\t    }\r\n\r\n\t    this.TopLayerNodeComponent.OnBeforeExitScene();\r\n    },\r\n\r\n    //进入场景\r\n    OnSwithSceneEnd:function(){\r\n    },\r\n\r\n\t//显示动态设置的默认界面\r\n\tOnShowDefaultForm:function(){\r\n\r\n\t},\r\n\r\n    //应用切入后台\r\n    OnEventHide:function(){\r\n    },\r\n\r\n    //应用显示\r\n    OnEventShow:function(){\r\n    },\r\n\r\n\t//-----------置顶模态层--------------\r\n\t//显示顶层特效\r\n\tOnTopEvent:function(eventType){\r\n\t\tthis.TopLayerNodeComponent.OnTopEvent(eventType);\r\n\t},\r\n\r\n    //--------------操作函数------------------\r\n\r\n\t//场景震动\r\n\tOnShakeScene:function(){\r\n\t\tlet rightDeltaPos = cc.v2(6,0);\r\n\t\tlet leftDeltaPos = cc.v2(-6,0);\r\n\r\n\t\tlet action = cc.sequence(\r\n\t\t\t\t\t\t\t\t\tcc.moveBy(0.025,cc.v2(3,0)),\r\n\t\t\t\t\t\t\t\t\tcc.moveBy(0.025,leftDeltaPos),\r\n\t\t\t\t\t\t\t\t\tcc.moveBy(0.025,rightDeltaPos),\r\n\t\t\t\t\t\t\t\t\tcc.moveBy(0.025,cc.v2(-3,0))\r\n\t\t\t\t\t\t\t\t);\r\n\r\n\t\tthis.UILayerNode.runAction(action);\r\n\r\n\t\tif(this.BackgroundLayerComponent){\r\n\t\t\tlet cloneAction = action.clone();\r\n\t\t\tthis.BackgroundLayerComponent.node.runAction(cloneAction);\r\n\t\t}\r\n\t},\r\n\r\n    //---------------特效相关---------------------\r\n\r\n    //创建场景特效\r\n    AddSceneEffect:function(effectName, effectRes, repeatCount=0, userData=0){\r\n\t    return this.SceneEffectLayerNodeComponent.AddSceneEffect(effectName, effectRes, repeatCount, userData);\r\n    },\r\n\r\n    DeleteSceneEffect:function(modelComponent){\r\n\t    this.SceneEffectLayerNodeComponent.DeleteSceneEffect(modelComponent);\r\n    },\r\n\r\n    //--------------子类重载-----------------\r\n    OnCreate:function(){\r\n\r\n    },\r\n\r\n    //每帧回掉\r\n    OnUpdate:function(dt){\r\n        \r\n    },\r\n\r\n    OnTimer:function(passSecond){\r\n\r\n    },\r\n    //切换账号\r\n    OnReload:function(){\r\n\r\n    },\r\n});\r\n"]}