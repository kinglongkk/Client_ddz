{"version":3,"sources":["../../../../../assets/script/common/assets/script/common/ddz_HeroManager.js"],"names":["app","require","ddz_HeroManager","BaseClass","extend","Init","JS_Name","subGameName","SysDataManager","ddz_SysDataManager","NetManager","ddz_NetManager","ShareDefine","ddz_ShareDefine","ComTool","ddz_ComTool","RegNetPack","OnPack_HeroProperty","OnReload","dataInfo","heroID","InitLoginData","heroInfo","cc","sys","isNative","LocalDataManager","SetConfigProperty","OnEvent","serverPack","count","length","index","property","SetHeroProperty","value","hasOwnProperty","ErrLog","argDict","GetHeroID","GetHeroInfo","GetHeroProperty","g_ddz_HeroManager","exports","GetModel"],"mappings":"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","file":"ddz_HeroManager.js","sourceRoot":"../../../../../assets/script/common","sourcesContent":["/*\r\n    玩家个人数据管理器\r\n*/\r\nvar app = require(\"ddz_app\");\r\n\r\nvar ddz_HeroManager = app.BaseClass.extend({\r\n\r\n    Init:function(){\r\n    \tthis.JS_Name = app.subGameName + \"_HeroManager\";\r\n\r\n        let SysDataManager = app.ddz_SysDataManager();\r\n        this.NetManager = app.ddz_NetManager();\r\n        this.ShareDefine = app.ddz_ShareDefine();\r\n        this.ComTool = app.ddz_ComTool();\r\n\r\n        this.NetManager.RegNetPack(\"playerchanged\", this.OnPack_HeroProperty, this);\r\n\r\n        this.OnReload();\r\n\r\n    \t// this.Log(\"Init\");\r\n    },\r\n\r\n    //切换账号\r\n    OnReload:function(){\r\n        this.dataInfo = {};\r\n        this.heroID = 0;\r\n    },\r\n\r\n\r\n    //登陆初始化数据\r\n    InitLoginData:function(heroID, heroInfo){\r\n        this.dataInfo = heroInfo;\r\n        this.heroID = heroID;\r\n        //记录用户活跃度\r\n        if(!cc.sys.isNative){\r\n            heroInfo['vipExp']=0;\r\n        }\r\n        app.LocalDataManager().SetConfigProperty(\"Account\", \"AccountActive\",heroInfo['vipExp']);\r\n        app[app.subGameName + \"Client\"].OnEvent(\"ReloadHeroData\",{});\r\n    },\r\n\r\n    //-------------------封包函数--------------------------\r\n    //属性变化\r\n    OnPack_HeroProperty:function(serverPack){\r\n\r\n\t    let count = serverPack.length;\r\n\t    for(let index=0; index<count; index++){\r\n\t\t    let dataInfo = serverPack[index];\r\n\t\t    let property = dataInfo[\"name\"];\r\n\t\t    this.SetHeroProperty(property, dataInfo[\"value\"]);\r\n\t    }\r\n    },\r\n\r\n    //----------------设置接口---------------------------\r\n    //设置英雄属性\r\n    SetHeroProperty:function(property, value){\r\n        if(!this.dataInfo.hasOwnProperty(property)){\r\n            this.ErrLog(\"SetHeroProperty(%s,%s) error\", property, value);\r\n            return false\r\n        }\r\n        this.dataInfo[property] = value;\r\n\r\n        let argDict = {\r\n            \"Property\":property,\r\n            \"Value\":value,\r\n        };\r\n        app[app.subGameName + \"Client\"].OnEvent(\"HeroProperty\", argDict);\r\n\r\n        return true\r\n    },\r\n\r\n    //----------------获取接口-----------------------------\r\n\r\n    //获取英雄ID\r\n    GetHeroID:function(){\r\n        return this.heroID;\r\n    },\r\n\r\n    GetHeroInfo:function(){\r\n        return this.dataInfo\r\n    },\r\n\r\n    //获取英雄属性值\r\n    GetHeroProperty:function(property){\r\n        if(!this.dataInfo.hasOwnProperty(property)){\r\n            this.ErrLog(\"GetHeroProperty(%s) error\", property);\r\n            return \r\n        }\r\n        return this.dataInfo[property];\r\n    },\r\n\r\n    //随机角色名\r\n    // GetRandHeroName:function(){\r\n    //     let familyKeyList = Object.keys(this.FamilyName);\r\n    //     let nameKeyList = Object.keys(this.Name);\r\n\r\n    //     let familyName = this.FamilyName[this.ComTool.ListChoice(familyKeyList)][\"FamilyName\"];\r\n    //     let name = this.Name[this.ComTool.ListChoice(nameKeyList)][\"Name\"];\r\n\r\n    //     return [familyName, name].join(\"\");\r\n    // },\r\n\r\n    //-------------发包接口------------------------\r\n});\r\n\r\n\r\nvar g_ddz_HeroManager = null;\r\n\r\n/**\r\n * 绑定模块外部方法\r\n */\r\nexports.GetModel = function(){\r\n    if(!g_ddz_HeroManager){\r\n        g_ddz_HeroManager = new ddz_HeroManager();\r\n    }\r\n    return g_ddz_HeroManager;\r\n}"]}