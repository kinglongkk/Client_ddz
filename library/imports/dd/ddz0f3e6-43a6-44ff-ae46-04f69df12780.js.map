{"version":3,"sources":["../../../../../assets/script/common/assets/script/common/ddz_GameManager.js"],"names":["app","require","ddz_GameManager","BaseClass","extend","Init","JS_Name","subGameName","NetManager","ddz_NetManager","ShareDefine","ddz_ShareDefine","RegNetPack","toUpperCase","OnPack_EnterRoom","OnPack_AutoStart","OnPack_PlayerAddress","OnPack_PosContinueGame","OnPack_DissolveRoom","OnPack_StartVoteDissolve","OnPack_ChangePlayerNum","OnPack_ChangePlayerNumAgree","OnPack_ChangeRoomNum","OnPack_PosReadyChg","OnPack_PosLeave","OnPack_PosUpdate","OnPack_LostConnect","OnPack_PosDealVote","OnPack_EveryGameRecord","OnPack_LoginGetCurRoomID","OnPack_XiPai","OnPack_Gitf","OnPack_MqResponseBo","OnPack_ContinueRoomInfo","bIsAutoPlayIng","bGetRoomIDByUI","xiPaiList","OnReload","serverPack","ShowForm","event","code","result","data","clientConfig","GameServerIP","gameTypeUrl","gameServerIP","GameServerPort","gameServerPort","isReconnecting","SendGetRoomInfo","roomID","CloseForm","Disconnect","UpdateAccessPoint","Connect","SetGetRoomIDByUI","bGet","SendChat","type","quickID","content","SendPack","OnEvent","SetPlayGame","gameType","custom","NowRoom","DDZRoom","pos","OnPosContinueGame","ownnerForce","createPos","endSec","dissolveInfo","OnStartVoteDissolve","playerNum","OnStartChangePlaeryDissolve","isReady","GetRoomPosMgr","OnPosReadyChg","room","ownerID","selfPos","GetClientPos","OnPosLeave","UpdateOwnerID","posInfo","OnPosUpdate","Log","isLostConnect","isShowLeave","pid","RoomPosMgr","roomPosMgrInfo","GetRoomAllPlayerInfo","roomPosMgrInfoKeyList","Object","keys","count","length","i","posID","player","SetPlayerOfflineState","agreeDissolve","OnPosDealVote","ChangePlayerNumAgree","SetGameType","DDZRoomMgr","nowroom","SetGameRecord","playerAll","playerAllList","playerInfo","push","name","ddz_HeroManager","GetHeroProperty","cType","ddz_FormManager","GetXiPaiList","RemoveOneXiPaiPlayer","splice","SendEnterRoom","roomKey","IsFristPlay","RoomMgr","state","GetEnterRoom","GetRoomProperty","IsAutoPlayIng","SetAutoPlayIng","bValue","isAuto","heroID","isCoinRoom","ddz_SceneManager","GetSceneType","CancelAutoPlay","key","sendPack","trusteeship","SendAutoStart","SendGetCurRoomID","SendContinueGame","SendDissolveRoom","SendDissolveRoomAgree","SendDissolveRoomRefuse","SendChangePlayerAgree","SendChangePlayerRefuse","SendExitRoom","SendReady","posIndex","SendUnReady","SendKickPosIndex","SendXiPai","g_ddz_GameManager","exports","GetModel"],"mappings":"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","file":"ddz_GameManager.js","sourceRoot":"../../../../../assets/script/common","sourcesContent":["/*\r\n GameManager 游戏管理\r\n */\r\nvar app = require(\"ddz_app\");\r\n\r\nvar ddz_GameManager = app.BaseClass.extend({\r\n\r\n\tInit:function(){\r\n\t\tthis.JS_Name = app.subGameName + \"_GameManager\";\r\n\r\n\t\tthis.NetManager = app.ddz_NetManager();\r\n\t\tthis.ShareDefine = app.ddz_ShareDefine();\r\n\r\n\r\n\t\tthis.NetManager.RegNetPack(app.subGameName + \".C\" + app.subGameName.toUpperCase() + \"EnterRoom\", this.OnPack_EnterRoom, this);\r\n\t\tthis.NetManager.RegNetPack(\"S\" + app.subGameName.toUpperCase() + \"_Trusteeship\", this.OnPack_AutoStart, this);\r\n\t\tthis.NetManager.RegNetPack(\"S\" + app.subGameName.toUpperCase() + \"_Address\", this.OnPack_PlayerAddress, this);\r\n\t\t//2017.8.8  消息抽出来走公共\r\n\t\t//继续游戏\r\n\t\tthis.NetManager.RegNetPack(\"S\" + app.subGameName.toUpperCase() + \"_PosContinueGame\", this.OnPack_PosContinueGame, this); \r\n\t\t//解散房间\r\n\t\tthis.NetManager.RegNetPack(\"S\" + app.subGameName.toUpperCase() + \"_Dissolve\", this.OnPack_DissolveRoom, this); \r\n\t\t//解散投票\r\n\t\tthis.NetManager.RegNetPack(\"S\" + app.subGameName.toUpperCase() + \"_StartVoteDissolve\", this.OnPack_StartVoteDissolve, this);\r\n\r\n\r\n\t\t//修改人数投票\r\n\t\tthis.NetManager.RegNetPack(\"S\" + app.subGameName.toUpperCase() + \"_ChangePlayerNum\", this.OnPack_ChangePlayerNum, this);\r\n\t\t//修改人数投票同意\r\n\t\tthis.NetManager.RegNetPack(\"S\" + app.subGameName.toUpperCase() + \"_ChangePlayerNumAgree\", this.OnPack_ChangePlayerNumAgree, this); \r\n\t\t//房间修改人数\r\n\t\tthis.NetManager.RegNetPack(\"S\" + app.subGameName.toUpperCase() + \"_ChangeRoomNum\", this.OnPack_ChangeRoomNum, this); \r\n\r\n\t\t//玩家准备\r\n\t\tthis.NetManager.RegNetPack(\"S\" + app.subGameName.toUpperCase() + \"_PosReadyChg\", this.OnPack_PosReadyChg, this);\r\n\t\t//玩家离开\r\n\t\tthis.NetManager.RegNetPack(\"S\" + app.subGameName.toUpperCase() + \"_PosLeave\", this.OnPack_PosLeave, this); \r\n\t\t//玩家位置更新\r\n\t\tthis.NetManager.RegNetPack(\"S\" + app.subGameName.toUpperCase() + \"_PosUpdate\", this.OnPack_PosUpdate, this);  \r\n\t\t//玩家掉线\r\n\t\tthis.NetManager.RegNetPack(\"S\" + app.subGameName.toUpperCase() + \"_LostConnect\", this.OnPack_LostConnect, this);\r\n\r\n\t\tthis.NetManager.RegNetPack(\"S\" + app.subGameName.toUpperCase() + \"_PosDealVote\", this.OnPack_PosDealVote, this); \r\n\t\t//所有对局记录\r\n\t\tthis.NetManager.RegNetPack(\"game.CPlayerSetRoomRecord\", this.OnPack_EveryGameRecord, this);\r\n\r\n\t\tthis.NetManager.RegNetPack(\"game.C1101GetRoomID\", this.OnPack_LoginGetCurRoomID, this);\r\n\t\t//洗牌\r\n\t\tthis.NetManager.RegNetPack(\"S\" + app.subGameName.toUpperCase() + \"_XiPai\",this.OnPack_XiPai,this);\r\n\t\t//赠送礼物\r\n\t\tthis.NetManager.RegNetPack(\"S\" + app.subGameName.toUpperCase() + \"_SendGift\",this.OnPack_Gitf,this);\r\n\r\n\t\tthis.NetManager.RegNetPack(\"MqResponseBo\",this.OnPack_MqResponseBo,this);\r\n\r\n\t\tthis.NetManager.RegNetPack(\"SRoom_ContinueRoomInfo\",this.OnPack_ContinueRoomInfo,this);\r\n\t\t\r\n\t\tthis.bIsAutoPlayIng = false;\r\n\r\n\t\tthis.bGetRoomIDByUI = false;\r\n\t\tthis.xiPaiList = [];\r\n\t\tthis.OnReload();\r\n\t},\r\n\tOnPack_ContinueRoomInfo:function(serverPack){\r\n\t\tapp[app.subGameName + \"_FormManager\"]().ShowForm(app.subGameName + '_UIMessageJoin',serverPack);\r\n\t},\r\n\r\n\t\r\n\tOnPack_MqResponseBo:function(event){\r\n\t\tlet code=event.result.code;\r\n\t\tif(code==0){\r\n\t\t\tlet serverPack=event.result.data;\r\n            app[app.subGameName + \"Client\"].clientConfig.GameServerIP=serverPack.gameTypeUrl.gameServerIP;\r\n            app[app.subGameName + \"Client\"].clientConfig.GameServerPort=serverPack.gameTypeUrl.gameServerPort;\r\n            app[app.subGameName+\"_NetWork\"]().isReconnecting=true;  //标记为正在重新连接，让发送消息堆积多发送队列\r\n            app[app.subGameName.toUpperCase()+\"RoomMgr\"]().SendGetRoomInfo(serverPack.roomID); //加入获取消息到队列\r\n            //关闭游戏的UI\r\n            app[app.subGameName + \"_FormManager\"]().CloseForm(\"game/\" + app.subGameName.toUpperCase() + \"/UI\" + app.subGameName.toUpperCase() + \"_Play\");\r\n            \r\n            app[app.subGameName + \"_FormManager\"]().CloseForm(\"game/\" + app.subGameName.toUpperCase() + \"/UI\" + app.subGameName.toUpperCase() + \"_Record\");\r\n            //关闭游戏的UI\r\n            app[app.subGameName+\"_NetWork\"]().Disconnect(true);\t\t\t//断开连接\r\n            app[app.subGameName+\"_NetWork\"]().UpdateAccessPoint();   //更新连接节点\r\n            app[app.subGameName+\"_NetWork\"]().Connect();\t\t\t//发起重新连接服务器\r\n    \t}\r\n\t},\r\n\tSetGetRoomIDByUI:function(bGet){\r\n\t\tthis.bGetRoomIDByUI = bGet;\r\n\t},\r\n\t//发送聊天封包\r\n\tSendChat:function (type, quickID, roomID, content) {\r\n\t\tthis.NetManager.SendPack(app.subGameName + \".C\" + app.subGameName.toUpperCase() + \"Chat\", {\"type\":type, \"quickID\":quickID, \"targetID\":roomID, \"content\":content});\r\n\t},\r\n\t//切换账号\r\n\tOnReload:function(){\r\n\t},\r\n\r\n\t//------------封包函数------------------\r\n\tOnPack_PlayerAddress:function(serverPack){\r\n\t\tapp[app.subGameName + \"Client\"].OnEvent(\"EVT_PlayerAddress\", serverPack);\r\n\t},\r\n\r\n\tSetPlayGame:function(serverPack){\r\n\t\tlet gameType = serverPack['gameType'];\r\n\t\tlet custom = serverPack['custom'];\r\n\t},\r\n\tNowRoom:function(){\r\n\t\treturn app.DDZRoom();\r\n\t},\r\n\t//位置继续游戏\r\n\tOnPack_PosContinueGame:function(serverPack){\r\n\t\tlet roomID = serverPack[\"roomID\"];\r\n\t\tlet pos = serverPack[\"pos\"];\r\n\t\tthis.NowRoom().OnPosContinueGame(pos);\r\n\t\tapp[app.subGameName + \"Client\"].OnEvent(app.subGameName.toUpperCase()+\"_PosContinueGame\", serverPack);\r\n\t\t//公共头像触发\r\n\t\tapp[app.subGameName + \"Client\"].OnEvent(\"PosContine\", serverPack);\r\n\t},\r\n\t//解散房间\r\n\tOnPack_DissolveRoom:function(serverPack){\r\n\t\tlet roomID = serverPack[\"roomID\"];\r\n\t\tlet ownnerForce = serverPack[\"ownnerForce\"];\r\n\t\tapp[app.subGameName + \"Client\"].OnEvent(app.subGameName.toUpperCase()+\"_DissolveRoom\", serverPack);\r\n\t},\r\n\t//接收到解散请求\r\n\tOnPack_StartVoteDissolve:function(serverPack){\r\n\t\tlet roomID = serverPack[\"roomID\"];\r\n\t\tlet createPos = serverPack[\"createPos\"];\r\n\t\tlet endSec = serverPack[\"endSec\"];\r\n\t\tlet dissolveInfo = this.NowRoom().OnStartVoteDissolve(createPos, endSec);\r\n\t\tapp[app.subGameName + \"Client\"].OnEvent(app.subGameName.toUpperCase()+\"_StartVoteDissolve\", dissolveInfo);\r\n\t},\r\n\t//接收人数修改请求\r\n\tOnPack_ChangePlayerNum:function(serverPack){\r\n\t\tlet roomID = serverPack[\"roomID\"];\r\n\t\tlet createPos = serverPack[\"createPos\"];\r\n\t\tlet endSec = serverPack[\"endSec\"];\r\n\t\tlet playerNum=serverPack.playerNum;\r\n\t\tlet dissolveInfo = this.NowRoom().OnStartChangePlaeryDissolve(createPos,playerNum,endSec);\r\n\t\tapp[app.subGameName + \"Client\"].OnEvent(app.subGameName.toUpperCase()+\"_ChangePlayerNum\", dissolveInfo);\r\n\t},\r\n\r\n\r\n\t//位置是否准备\r\n\tOnPack_PosReadyChg:function(serverPack){\r\n\t\tlet roomID = serverPack[\"roomID\"];\r\n\t\tlet pos = serverPack[\"pos\"];\r\n\t\tlet isReady = serverPack[\"isReady\"];\r\n\t\tif(this.NowRoom().GetRoomPosMgr().OnPosReadyChg(pos, isReady)){\r\n\t\t\tapp[app.subGameName + \"Client\"].OnEvent(app.subGameName.toUpperCase()+\"_PosReadyChg\", serverPack);\r\n\t\t}\r\n\t\telse{\r\n\t\t\t// this.Log(\"OnPack_PosReadyChg:\", serverPack);\r\n\t\t}\r\n\t},\r\n\t//位置离开房间\r\n\tOnPack_PosLeave:function(serverPack){\r\n\t\tlet roomID = serverPack[\"roomID\"];\r\n\t\tlet pos = serverPack[\"pos\"];\r\n\t\tlet room = this.NowRoom();\r\n\t\tlet ownerID=serverPack[\"ownerID\"];\r\n\t\tlet selfPos = -1;\r\n\t\tif(room){\r\n\t\t\tselfPos = room.GetRoomPosMgr().GetClientPos();\r\n\t\t\troom.OnPosLeave(pos);\r\n\t\t\tif(ownerID>0){\r\n\t\t\t\troom.UpdateOwnerID(ownerID);\r\n\t\t\t}\r\n\t\t}\r\n\t\tapp[app.subGameName + \"Client\"].OnEvent(app.subGameName.toUpperCase()+\"_PosLeave\", serverPack);\r\n\t\tif(pos == selfPos && !serverPack[\"beKick\"]){\r\n            app[app.subGameName + \"Client\"].OnEvent('ExitRoomSuccess', serverPack);\r\n    \t}\r\n\t},\r\n\t//更新座位信息\r\n\tOnPack_PosUpdate:function(serverPack){\r\n\t\tlet roomID = serverPack[\"roomID\"];\r\n\t\tlet pos = serverPack[\"pos\"];\r\n\t\tlet posInfo = serverPack[\"posInfo\"];\r\n\t\tthis.SetPlayGame(serverPack);\r\n\t\tif(this.NowRoom().GetRoomPosMgr().OnPosUpdate(pos, posInfo)){\r\n\t\t\tapp[app.subGameName + \"Client\"].OnEvent(app.subGameName.toUpperCase()+\"_PosUpdate\", serverPack);\r\n\t\t}\r\n\t\telse{\r\n\t\t\tthis.Log(\"OnPack_PosUpdate:\", serverPack);\r\n\t\t}\r\n\r\n\t},\r\n\t//有玩家掉线\r\n    OnPack_LostConnect:function (serverPack) {\r\n\t\tlet isLostConnect = serverPack[\"isLostConnect\"];\r\n\t\tlet isShowLeave = serverPack[\"isShowLeave\"];\r\n\t\tlet pid = serverPack[\"pid\"];\r\n\t\tlet RoomPosMgr = this.NowRoom().GetRoomPosMgr();\r\n\t\tlet roomPosMgrInfo = RoomPosMgr.GetRoomAllPlayerInfo();\r\n\t\tlet roomPosMgrInfoKeyList = Object.keys(roomPosMgrInfo);\r\n\t\tlet count = roomPosMgrInfoKeyList.length;\r\n\t\tfor(let i = 0; i < count; i++){\r\n\t\t\tlet posID = roomPosMgrInfoKeyList[i];\r\n\t\t\tlet player = roomPosMgrInfo[posID];\r\n\t\t\tif(pid == player[\"pid\"]){\r\n                RoomPosMgr.SetPlayerOfflineState(posID, isLostConnect, isShowLeave);\r\n\t\t\t\tbreak\r\n\t\t\t}\r\n\t\t}\r\n        app[app.subGameName + \"Client\"].OnEvent(\"PlayerOffline\", serverPack);\r\n    },\r\n    //位置更新解散\r\n\tOnPack_PosDealVote:function(serverPack){\r\n\t\tlet roomID = serverPack[\"roomID\"];\r\n\t\tlet pos = serverPack[\"pos\"];\r\n\t\tlet agreeDissolve = serverPack[\"agreeDissolve\"];\r\n\t\tlet dissolveInfo = this.NowRoom().OnPosDealVote(pos, agreeDissolve);\r\n\t\tapp[app.subGameName + \"Client\"].OnEvent(\"PosDealVote\", dissolveInfo);\r\n\t},\r\n\r\n\r\n\t //位置更新解散\r\n\tOnPack_ChangePlayerNumAgree:function(serverPack){\r\n\t\tlet roomID = serverPack[\"roomID\"];\r\n\t\tlet pos = serverPack[\"pos\"];\r\n\t\tlet agreeDissolve = serverPack[\"agreeChange\"];\r\n\t\tlet dissolveInfo = this.NowRoom().ChangePlayerNumAgree(pos, agreeDissolve);\r\n\t\tapp[app.subGameName + \"Client\"].OnEvent(\"PosChangePlayerDealVote\", dissolveInfo);\r\n\t},\r\n\r\n\tOnPack_ChangeRoomNum:function(serverPack){\r\n\t\tthis.OnPack_EnterRoom(serverPack);\r\n\t},\r\n\r\n\t//房间key查找完成\r\n\tOnPack_EnterRoom:function(serverPack){\r\n\t\tlet roomID = serverPack.roomID;\r\n\t    app[app.subGameName + \"Client\"].SetGameType('ddz');\r\n\t\tapp.DDZRoomMgr().SendGetRoomInfo(roomID);\r\n\t},\r\n\t//获取所有对局记录\r\n    OnPack_EveryGameRecord:function(serverPack){\r\n    \tlet nowroom=this.NowRoom();\r\n    \tif(nowroom){\r\n    \t\tnowroom.SetGameRecord(true);\r\n    \t}\r\n        app[app.subGameName + \"Client\"].OnEvent(\"GameRecord\", serverPack);\r\n    },\r\n    OnPack_LoginGetCurRoomID:function(serverPack){\r\n    \tif(!this.bGetRoomIDByUI)\r\n    \t\tapp[app.subGameName + \"Client\"].OnEvent(\"LoginGetCurRoomID\", serverPack);\r\n    \telse\r\n    \t\tapp[app.subGameName + \"Client\"].OnEvent(\"GetCurRoomID\", serverPack);\r\n\r\n    \tthis.bGetRoomIDByUI = false;\r\n    },\r\n    //洗牌\r\n    OnPack_XiPai:function(serverPack){\r\n\t\tlet nowroom=this.NowRoom();\r\n\t\tlet playerAll = nowroom.GetRoomPosMgr().GetRoomAllPlayerInfo();\r\n\t\tlet playerAllList= Object.keys(playerAll);\r\n        var playerInfo = null;\r\n        for(var i=0;i<playerAllList.length;i++){\r\n\t\t\tplayerInfo = playerAll[playerAllList[i]];\r\n\t\t\tif(playerInfo.pid == serverPack.pid){\r\n\t\t\t\tthis.xiPaiList.push(playerInfo.name);\r\n\t\t\t\t// app.ddz_SysNotifyManager().ShowSysMsg('SSS_XIPAI_SUCCESS',[playerInfo.name]);\r\n\t\t\t\tif(app.ddz_HeroManager().GetHeroProperty(\"pid\") == serverPack.pid){\r\n\t\t\t\t\tapp[app.subGameName + \"Client\"].OnEvent(\"Event_XiPai\", serverPack);\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tlet cType = serverPack.cType;\r\n\t\tif('PK' == cType){\t\r\n\t\t\tapp.ddz_FormManager().ShowForm('UIXiPai');\r\n\t\t}\r\n\t\telse{\r\n\t\t\tapp.ddz_FormManager().ShowForm('game/base/ui/majiang/UIMJXiPai');\r\n\t\t}\r\n\t},\r\n\tOnPack_Gitf:function(serverPack){\r\n\t\tapp[app.subGameName + \"Client\"].OnEvent(\"GameGift\", serverPack);\r\n\t},\r\n\t//--------------获取接口------------------------\r\n\tGetXiPaiList:function(){\r\n\t\treturn this.xiPaiList;\r\n\t},\r\n\tRemoveOneXiPaiPlayer:function(){\r\n\t\tif(0==this.xiPaiList.length)\r\n\t\t\treturn;\r\n\t\tthis.xiPaiList.splice(0,1);\r\n\t},\r\n\t//---------------发包接口------------------------\r\n\t//进入房间\r\n\tSendEnterRoom:function(roomKey){\r\n\t\tthis.NetManager.SendPack(app.subGameName + \".C\" + app.subGameName.toUpperCase() + \"EnterRoom\", {\"roomKey\":roomKey,\"posID\":-1});\r\n\t},\r\n\tIsFristPlay:function(){\r\n\t\tlet RoomMgr = app.DDZRoomMgr();\r\n\t\tlet state = RoomMgr.GetEnterRoom().GetRoomProperty(\"state\");\r\n\t\treturn state != 0 ? true : false;\r\n\t},\r\n\t\r\n\tIsAutoPlayIng:function(){\r\n\t\treturn this.bIsAutoPlayIng;\r\n\t},\r\n\tSetAutoPlayIng:function(bValue){\r\n\t\tthis.bIsAutoPlayIng = bValue;\r\n\t},\r\n\tOnPack_AutoStart:function(serverPack){\r\n\t\tapp[app.subGameName + \"Client\"].OnEvent('SPlayer_Trusteeship', serverPack);\r\n        let roomID = serverPack[\"roomID\"];\r\n        let pos = serverPack[\"pos\"];\r\n        let isAuto = serverPack[\"trusteeship\"];\r\n        let pid = serverPack[\"pid\"];\r\n        let heroID = app.ddz_HeroManager().GetHeroProperty(\"pid\");\r\n\r\n        let RoomMgr = app.DDZRoomMgr();\r\n        let RoomPosMgr = RoomMgr.GetEnterRoom().GetRoomPosMgr();\r\n        if(pos == RoomPosMgr.GetClientPos() && heroID == pid){\r\n            if(!isAuto){\r\n                this.bIsAutoPlayIng = false;\r\n                app.ddz_FormManager().CloseForm(app.subGameName + \"_UIAutoPlay\");\r\n            }\r\n            else{\r\n            \tif(this.ShareDefine.isCoinRoom && app.ddz_SceneManager().GetSceneType() == \"ddzMainScene\"){\r\n                \tapp.ddz_FormManager().CloseForm(app.subGameName + \"_UIAutoPlay\");\r\n                \tthis.bIsAutoPlayIng = false;\r\n            \t}\r\n            \telse{\r\n            \t\tthis.bIsAutoPlayIng = true;\r\n            \t\tapp.ddz_FormManager().ShowForm(app.subGameName + \"_UIAutoPlay\");\r\n            \t}\r\n            }\r\n        }\r\n    },\r\n\tCancelAutoPlay:function(){\r\n\t\tthis.bIsAutoPlayIng = false;\r\n        let RoomMgr = app.DDZRoomMgr();\r\n        let room = RoomMgr.GetEnterRoom();\r\n        let roomID = room.GetRoomProperty(\"roomID\");\r\n        let key = room.GetRoomProperty(\"key\");\r\n        let heroID = app.ddz_HeroManager().GetHeroProperty(\"pid\");\r\n        let sendPack = {\r\n            roomID: roomID,\r\n            trusteeship :false,\r\n            key:key,\r\n            pid:heroID\r\n        }\r\n        app.ddz_NetManager().SendPack(app.subGameName + \".C\" + app.subGameName.toUpperCase() + \"Trusteeship\", sendPack);\r\n\t},\r\n\tSendAutoStart:function(){\r\n\t\tthis.bIsAutoPlayIng = true;\r\n        let RoomMgr = app.DDZRoomMgr();\r\n        let room = RoomMgr.GetEnterRoom();\r\n        let roomID = room.GetRoomProperty(\"roomID\");\r\n        let key = room.GetRoomProperty(\"key\");\r\n        let heroID = app.ddz_HeroManager().GetHeroProperty(\"pid\");\r\n        let sendPack = {\r\n            roomID: roomID,\r\n            trusteeship :true,\r\n            key:key,\r\n            pid:heroID\r\n        }\r\n        app.ddz_NetManager().SendPack(app.subGameName + \".C\" + app.subGameName.toUpperCase() + \"Trusteeship\", sendPack);\r\n    },\r\n\r\n    //游戏公用消息\r\n    //登录获取当前进入的房间ID\r\n\tSendGetCurRoomID:function(){\r\n\t\tthis.NetManager.SendPack(\"game.C1101GetRoomID\", {});\r\n\t},\r\n    //发送继续游戏\r\n\tSendContinueGame:function(roomID){\r\n\t\tthis.NetManager.SendPack(app.subGameName + \".C\" + app.subGameName.toUpperCase() + \"ContinueGame\", {\"roomID\":roomID});\r\n\t},\r\n\t//解散房间\r\n\tSendDissolveRoom:function(roomID){\r\n\t\tthis.NetManager.SendPack(app.subGameName + \".C\" + app.subGameName.toUpperCase() + \"DissolveRoom\", {\"roomID\":roomID});\r\n\t},\r\n\t//发送同意解散房间\r\n\tSendDissolveRoomAgree:function(roomID){\r\n\t\tthis.NetManager.SendPack(app.subGameName + \".C\" + app.subGameName.toUpperCase() + \"DissolveRoomAgree\", {\"roomID\":roomID});\r\n\t},\r\n\r\n\t//发送拒绝解散房间\r\n\tSendDissolveRoomRefuse:function(roomID){\r\n\t\tthis.NetManager.SendPack(app.subGameName + \".C\" + app.subGameName.toUpperCase() + \"DissolveRoomRefuse\", {\"roomID\":roomID});\r\n\t},\r\n\r\n\r\n\t//发送同意修改人数\r\n\tSendChangePlayerAgree:function(roomID){\r\n\t\tthis.NetManager.SendPack(app.subGameName + \".C\" + app.subGameName.toUpperCase() + \"ChangePlayerNumAgree\", {\"roomID\":roomID,\"agree\":1});\r\n\t},\r\n\r\n\t//发送拒绝修改人数\r\n\tSendChangePlayerRefuse:function(roomID){\r\n\t\tthis.NetManager.SendPack(app.subGameName + \".C\" + app.subGameName.toUpperCase() + \"ChangePlayerNumAgree\", {\"roomID\":roomID,\"agree\":2});\r\n\t},\r\n\r\n\r\n\t//退出房间\r\n\tSendExitRoom:function(roomID, pos){\r\n\t\tthis.NetManager.SendPack(app.subGameName + \".C\" + app.subGameName.toUpperCase() + \"ExitRoom\", {\"roomID\":roomID, \"posIndex\":pos});\r\n\t},\r\n\t//位置发送准备状态\r\n\tSendReady:function(roomID, posIndex){\r\n\t\tthis.NetManager.SendPack(app.subGameName + \".C\" + app.subGameName.toUpperCase() + \"ReadyRoom\", {\"roomID\":roomID, \"posIndex\":posIndex});\r\n\t},\r\n\r\n\t//发送取消准备状态\r\n\tSendUnReady:function(roomID, posIndex){\r\n\t\tthis.NetManager.SendPack(app.subGameName + \".C\" + app.subGameName.toUpperCase() + \"UnReadyRoom\", {\"roomID\":roomID, \"posIndex\":posIndex});\r\n\t},\r\n\r\n\t//房主T人\r\n    SendKickPosIndex:function(roomID, posIndex){\r\n\t\tthis.NetManager.SendPack(app.subGameName + \".C\" + app.subGameName.toUpperCase() + \"KickRoom\", {\"roomID\":roomID, \"posIndex\":posIndex});\r\n\t},\r\n\r\n\t//洗牌\r\n\tSendXiPai:function(roomID){\r\n\t\tthis.NetManager.SendPack(app.subGameName + \".C\" + app.subGameName.toUpperCase() + \"RoomXiPai\", {\"roomID\":roomID});\r\n\t},\r\n});\r\n\r\n\r\nvar g_ddz_GameManager = null;\r\n\r\n/**\r\n * 绑定模块外部方法\r\n */\r\nexports.GetModel = function(){\r\n\tif(!g_ddz_GameManager){\r\n\t\tg_ddz_GameManager = new ddz_GameManager();\r\n\t}\r\n\treturn g_ddz_GameManager;\r\n}"]}