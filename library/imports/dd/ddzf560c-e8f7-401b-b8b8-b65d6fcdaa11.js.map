{"version":3,"sources":["../../../../../assets/script/ui/assets/script/ui/ddz_UIMain.js"],"names":["app","require","cc","Class","extends","subGameName","properties","resVersion","Label","lb_backCode","EditBox","OnCreateInit","practiceConfig","ddz_SysDataManager","GetTableDict","FormManager","ddz_FormManager","RegEvent","Event_GetCurRoomID","Event_CodeError","OnShow","SetGameType","curRoomID","curGameTypeStr","ddz_GameManager","SetGetRoomIDByUI","ddz_NetManager","SendPack","sys","isNative","string","ddz_HotUpdateMgr","getLocalVersion","ShowForm","SetAutoPlayIng","CloseForm","allSwitchGameData","switchGameData","localStorage","getItem","push","JSON","parse","i","length","console","log","action","fromName","setItem","event","serverPack","roomID","gameType","toLowerCase","codeInfo","ShareDefine","NotFind_Room","ddz_SysNotifyManager","ShowSysMsg","OnClose","InitGameBtnList","gameName","SetWaitForConfirm","msgID","type","msgArg","cbArg","ConfirmManager","ddz_ConfirmManager","SetWaitForConfirmForm","OnConFirm","bind","ShowConfirm","clickType","backArgList","Click_btn_goRoom","clubId","clubCardNtfs","splice","data","setTimeout","clubName","roomcardattention","OnClick","btnName","btnNode","Confirm","ExitGame","videoData","backCode","parseInt","stringify","ddz_SceneManager","LoadScene","ErrLog","OnEvent_LoginGetCurRoomID"],"mappings":";;;;;;AAAA,IAAIA,MAAMC,QAAQ,SAAR,CAAV;AACAC,GAAGC,KAAH,CAAS;AACLC,aAASH,QAAQD,IAAIK,WAAJ,GAAkB,WAA1B,CADJ;;AAGLC,gBAAY;AACRC,oBAAWL,GAAGM,KADN;AAERC,qBAAYP,GAAGQ;AAFP,KAHP;AAOLC,kBAAc,wBAAY;AACtB,aAAKC,cAAL,GAAsBZ,IAAIa,kBAAJ,GAAyBC,YAAzB,CAAsC,UAAtC,CAAtB;AACA,aAAKC,WAAL,GAAmBf,IAAIgB,eAAJ,EAAnB;AACA,aAAKC,QAAL,CAAc,cAAd,EAA8B,KAAKC,kBAAnC,EAAuD,IAAvD;AACA,aAAKD,QAAL,CAAc,WAAd,EAA2B,KAAKE,eAAhC,EAAiD,IAAjD;AACH,KAZI;AAaL;AACAC,YAAQ,kBAAY;AAChBpB,YAAIA,IAAIK,WAAJ,GAAkB,QAAtB,EAAgCgB,WAAhC,CAA4C,EAA5C;AACA,aAAKC,SAAL,GAAiB,CAAjB;AACA,aAAKC,cAAL,GAAsB,EAAtB;AACAvB,YAAIwB,eAAJ,GAAsBC,gBAAtB,CAAuC,IAAvC;AACAzB,YAAI0B,cAAJ,GAAqBC,QAArB,CAA8B,qBAA9B,EAAqD,EAArD;;AAEA,YAAGzB,GAAG0B,GAAH,CAAOC,QAAV,EAAmB;AACf,iBAAKtB,UAAL,CAAgBuB,MAAhB,GAAyB,SAAS9B,IAAI+B,gBAAJ,GAAuBC,eAAvB,EAAlC;AACH,SAFD,MAEK;AACD,iBAAKzB,UAAL,CAAgBuB,MAAhB,GAAyB,EAAzB;AACH;AACD,aAAKf,WAAL,CAAiBkB,QAAjB,CAA0BjC,IAAIK,WAAJ,GAAkB,QAA5C,EAAsDL,IAAIK,WAAJ,GAAkB,SAAxE,EAAkF,IAAlF,EAAuF,KAAvF,EAA6F,IAA7F;AACA,aAAKU,WAAL,CAAiBkB,QAAjB,CAA0BjC,IAAIK,WAAJ,GAAkB,cAA5C;AACAL,YAAIwB,eAAJ,GAAsBU,cAAtB,CAAqC,KAArC;AACA,aAAKnB,WAAL,CAAiBoB,SAAjB,CAA2BnC,IAAIK,WAAJ,GAAkB,aAA7C;AACA;AACA,YAAI+B,oBAAoB,EAAxB;AACA,YAAIC,iBAAiBnC,GAAG0B,GAAH,CAAOU,YAAP,CAAoBC,OAApB,CAA4B,gBAA5B,CAArB;AACA,YAAIF,kBAAkB,EAAtB,EAA0B;AACtBD,8BAAkBI,IAAlB,CAAuBC,KAAKC,KAAL,CAAWL,cAAX,CAAvB;AACH;AACD,aAAK,IAAIM,IAAI,CAAb,EAAgBA,IAAIP,kBAAkBQ,MAAtC,EAA8CD,GAA9C,EAAmD;AAC/C,gBAAI,CAACP,kBAAkBO,CAAlB,CAAL,EAA2B;AAC3BE,oBAAQC,GAAR,CAAY,6BAAZ;AACA,gBAAIC,SAASX,kBAAkBO,CAAlB,EAAqBI,MAAlC;AACA,oBAAOA,MAAP;AACI,qBAAK,UAAL;AACI,yBAAKhC,WAAL,CAAiBkB,QAAjB,CAA0BG,kBAAkBO,CAAlB,EAAqBK,QAA/C;AACA;AACJ;AACIH,4BAAQC,GAAR,CAAY,WAAWC,MAAvB;AACA;AANR;AAQH;AACD7C,WAAG0B,GAAH,CAAOU,YAAP,CAAoBW,OAApB,CAA4B,gBAA5B,EAA8C,EAA9C;AACH,KAlDI;;AAoDL/B,wBAAmB,4BAASgC,KAAT,EAAe;AAC9B,YAAIC,aAAaD,KAAjB;AACA,aAAK5B,SAAL,GAAiB6B,WAAWC,MAA5B;AACA,YAAG,KAAK,KAAK9B,SAAb,EAAuB;AACnB,iBAAKC,cAAL,GAAsB4B,WAAWE,QAAX,CAAoBC,WAApB,EAAtB;AACH;AACJ,KA1DI;AA2DLnC,qBAAgB,yBAAS+B,KAAT,EAAe;AAC3B,YAAIK,WAAWL,KAAf;AACA,YAAGK,SAAS,MAAT,KAAoB,KAAKC,WAAL,CAAiBC,YAAxC,EAAqD;AACjDzD,gBAAI0D,oBAAJ,GAA2BC,UAA3B,CAAsC,cAAtC;AACA,iBAAKrC,SAAL,GAAiB,CAAjB;AACA,iBAAKC,cAAL,GAAsB,EAAtB;AACH;AACJ,KAlEI;AAmELqC,aAAQ,mBAAU,CACjB,CApEI;AAqEL;AACAC,qBAAgB,yBAASV,UAAT,EAAoB;AAChC,aAAKpC,WAAL,CAAiBkB,QAAjB,CAA0B,aAA1B,EAAwCkB,UAAxC,EAAmD,KAAKW,QAAxD;AACH,KAxEI;AAyELC,uBAAkB,2BAASC,KAAT,EAAeC,IAAf,EAAuC;AAAA,YAAnBC,MAAmB,uEAAZ,EAAY;AAAA,YAATC,KAAS,uEAAH,EAAG;;AACrD,YAAIC,iBAAiBpE,IAAIqE,kBAAJ,EAArB;AACAD,uBAAeE,qBAAf,CAAqC,KAAKC,SAAL,CAAeC,IAAf,CAAoB,IAApB,CAArC,EAAgER,KAAhE,EAAuEG,KAAvE;AACAC,uBAAeK,WAAf,CAA2BR,IAA3B,EAAiCD,KAAjC,EAAwCE,MAAxC;AACH,KA7EI;AA8ELK,eAAU,mBAASG,SAAT,EAAoBV,KAApB,EAA2BW,WAA3B,EAAuC;AAC7C,YAAGD,aAAa,MAAhB,EAAuB;AACnB;AACH;AACD,YAAG,iBAAiBV,KAApB,EAA0B;AACtB,iBAAKY,gBAAL;AACH,SAFD,MAGK,IAAG,kCAAkCZ,KAArC,EAA2C;AAC5C,gBAAIa,SAASF,YAAY,CAAZ,CAAb;AACA,iBAAI,IAAIhC,IAAE,CAAV,EAAYA,IAAE,KAAKmC,YAAL,CAAkBlC,MAAhC,EAAuCD,GAAvC,EAA2C;AACvC,oBAAG,KAAKmC,YAAL,CAAkBnC,CAAlB,EAAqBkC,MAArB,IAA+BA,MAAlC,EAAyC;AACrC,yBAAKC,YAAL,CAAkBC,MAAlB,CAAyBpC,CAAzB,EAA2B,CAA3B;AACA;AACH;AACJ;AACD,gBAAG,KAAK,KAAKmC,YAAL,CAAkBlC,MAA1B,EAAiC;AAC7B,oBAAIoC,OAAO,KAAKF,YAAL,CAAkB,CAAlB,CAAX;AACAG,2BAAW,YAAU;AACjBjF,wBAAI0D,oBAAJ,GAA2BC,UAA3B,CAAsC,8BAAtC,EAAqE,CAACqB,KAAKE,QAAN,EAAeF,KAAKG,iBAApB,CAArE;AACH,iBAFD,EAEE,GAFF;AAGH;AACJ;AACJ,KApGI;AAqGLC,aAAQ,iBAASC,OAAT,EAAkBC,OAAlB,EAA0B;AAC9B,YAAG,gBAAgBD,OAAnB,EAA2B;AACvB,gBAAG,KAAK,KAAK/D,SAAb,EAAuB;AACnB,qBAAKyC,iBAAL,CAAuB,aAAvB,EAAqC,KAAKP,WAAL,CAAiB+B,OAAtD,EAA8D,CAAC,KAAKhE,cAAN,CAA9D;AACA;AACH;AACJ,iBAAKuC,QAAL,GAAc,KAAd;AACG,iBAAK/C,WAAL,CAAiBkB,QAAjB,CAA0BjC,IAAIK,WAAJ,GAAkB,cAA5C,EAA2D,IAA3D,EAAgE,KAAKyD,QAArE;AACH,SAPD,MAOM,IAAG,aAAWuB,OAAd,EAAsB;AACxB,gBAAG,KAAK,KAAK/D,SAAb,EAAuB;AACnB,qBAAKyC,iBAAL,CAAuB,aAAvB,EAAqC,KAAKP,WAAL,CAAiB+B,OAAtD,EAA8D,CAAC,KAAKhE,cAAN,CAA9D;AACA;AACH;AACD,iBAAKR,WAAL,CAAiBkB,QAAjB,CAA0BjC,IAAIK,WAAJ,GAAkB,aAA5C;AACH,SANK,MAOD,IAAG,cAAcgF,OAAjB,EAAyB;AAC1B,gBAAG,KAAK,KAAK/D,SAAb,EAAuB;AACnB,qBAAKyC,iBAAL,CAAuB,aAAvB,EAAqC,KAAKP,WAAL,CAAiB+B,OAAtD,EAA8D,CAAC,KAAKhE,cAAN,CAA9D;AACA;AACH;AACD,iBAAKR,WAAL,CAAiBkB,QAAjB,CAA0BjC,IAAIK,WAAJ,GAAkB,SAA5C;AACH,SANI,MAOA,IAAG,cAAcgF,OAAjB,EAAyB;AAC1BrF,gBAAIA,IAAIK,WAAJ,GAAkB,QAAtB,EAAgCmF,QAAhC;AACH,SAFI,MAGA,IAAG,cAAcH,OAAjB,EAAyB;AAC1B,iBAAK1B,UAAL,CAAgB,cAAhB;AACA;AACA;AACA;AACH,SALI,MAMA,IAAI,eAAe0B,OAAnB,EAA4B;AAC7B,gBAAII,YAAY,EAAC1C,QAAO,WAAR,EAAqB2C,UAASC,SAAS,KAAKlF,WAAL,CAAiBqB,MAA1B,CAA9B,EAAhB;AACA5B,eAAG0B,GAAH,CAAOU,YAAP,CAAoBW,OAApB,CAA4B,gBAA5B,EAA8CR,KAAKmD,SAAL,CAAeH,SAAf,CAA9C;AACAzF,gBAAI6F,gBAAJ,GAAuBC,SAAvB,CAAiC9F,IAAIK,WAAJ,GAAkB,YAAnD;AACH,SAJI,MAKD;AACA,iBAAK0F,MAAL,CAAY,sBAAZ,EAAmCV,OAAnC;AACH;AAEJ,KA7II;;AA+ILT,sBAAiB,4BAAU;AACvB5E,YAAIA,IAAIK,WAAJ,GAAkB,QAAtB,EAAgCgB,WAAhC,CAA4C,KAAKE,cAAjD;AACA,YAAI2B,QAAQ,EAAZ;AACAA,gBAAQ,EAAR;AACAA,cAAME,MAAN,GAAe,KAAK9B,SAApB;AACAtB,YAAIA,IAAIK,WAAJ,GAAkB,QAAtB,EAAgC2F,yBAAhC,CAA0D9C,KAA1D;AACH;AArJI,CAAT","file":"ddz_UIMain.js","sourceRoot":"../../../../../assets/script/ui","sourcesContent":["var app = require(\"ddz_app\");\r\ncc.Class({\r\n    extends: require(app.subGameName + \"_BaseForm\"),\r\n\r\n    properties: {\r\n        resVersion:cc.Label,\r\n        lb_backCode:cc.EditBox,\r\n    },\r\n    OnCreateInit: function () {\r\n        this.practiceConfig = app.ddz_SysDataManager().GetTableDict(\"practice\");\r\n        this.FormManager = app.ddz_FormManager();\r\n        this.RegEvent(\"GetCurRoomID\", this.Event_GetCurRoomID, this);\r\n        this.RegEvent(\"CodeError\", this.Event_CodeError, this);\r\n    },\r\n    //-----------------显示函数------------------\r\n    OnShow: function () {\r\n        app[app.subGameName + \"Client\"].SetGameType('');\r\n        this.curRoomID = 0;\r\n        this.curGameTypeStr = '';\r\n        app.ddz_GameManager().SetGetRoomIDByUI(true);\r\n        app.ddz_NetManager().SendPack(\"game.C1101GetRoomID\", {});\r\n\r\n        if(cc.sys.isNative){\r\n            this.resVersion.string = \"resV\" + app.ddz_HotUpdateMgr().getLocalVersion();\r\n        }else{\r\n            this.resVersion.string = '';\r\n        }\r\n        this.FormManager.ShowForm(app.subGameName + \"_UITop\", app.subGameName + \"_UIMain\",true,false,true);\r\n        this.FormManager.ShowForm(app.subGameName + \"_UINoticeBar\");\r\n        app.ddz_GameManager().SetAutoPlayIng(false);\r\n        this.FormManager.CloseForm(app.subGameName + \"_UIAutoPlay\");\r\n        //返回大厅检测下是否有需要处理的数据\r\n        let allSwitchGameData = [];\r\n        let switchGameData = cc.sys.localStorage.getItem(\"switchGameData\");\r\n        if (switchGameData != \"\") {\r\n            allSwitchGameData.push(JSON.parse(switchGameData));\r\n        }\r\n        for (let i = 0; i < allSwitchGameData.length; i++) {\r\n            if (!allSwitchGameData[i]) return;\r\n            console.log(\"allSwitchGameData[i].action\");\r\n            let action = allSwitchGameData[i].action;\r\n            switch(action){\r\n                case 'showForm':\r\n                    this.FormManager.ShowForm(allSwitchGameData[i].fromName);\r\n                    break;\r\n                default:\r\n                    console.log('未知动作: ' + action);\r\n                    break;\r\n            }\r\n        }\r\n        cc.sys.localStorage.setItem(\"switchGameData\", \"\");\r\n    },\r\n    \r\n    Event_GetCurRoomID:function(event){\r\n        let serverPack = event;\r\n        this.curRoomID = serverPack.roomID;\r\n        if(0 != this.curRoomID){\r\n            this.curGameTypeStr = serverPack.gameType.toLowerCase();\r\n        }\r\n    },\r\n    Event_CodeError:function(event){\r\n        let codeInfo = event;\r\n        if(codeInfo[\"Code\"] == this.ShareDefine.NotFind_Room){\r\n            app.ddz_SysNotifyManager().ShowSysMsg('DissolveRoom');\r\n            this.curRoomID = 0;\r\n            this.curGameTypeStr = '';\r\n        }\r\n    },\r\n    OnClose:function(){\r\n    },\r\n    //---------点击函数---------------------\r\n    InitGameBtnList:function(serverPack){\r\n        this.FormManager.ShowForm(\"UICreatRoom\",serverPack,this.gameName);\r\n    },\r\n    SetWaitForConfirm:function(msgID,type,msgArg=[],cbArg=[]){\r\n        let ConfirmManager = app.ddz_ConfirmManager();\r\n        ConfirmManager.SetWaitForConfirmForm(this.OnConFirm.bind(this), msgID, cbArg);\r\n        ConfirmManager.ShowConfirm(type, msgID, msgArg);\r\n    },\r\n    OnConFirm:function(clickType, msgID, backArgList){\r\n        if(clickType != \"Sure\"){\r\n            return\r\n        }\r\n        if('MSG_GO_ROOM' == msgID){\r\n            this.Click_btn_goRoom();\r\n        }\r\n        else if('MSG_CLUB_RoomCard_Not_Enough' == msgID){\r\n            let clubId = backArgList[0];\r\n            for(let i=0;i<this.clubCardNtfs.length;i++){\r\n                if(this.clubCardNtfs[i].clubId == clubId){\r\n                    this.clubCardNtfs.splice(i,1);\r\n                    break;\r\n                }\r\n            }\r\n            if(0 != this.clubCardNtfs.length){\r\n                let data = this.clubCardNtfs[0];\r\n                setTimeout(function(){\r\n                    app.ddz_SysNotifyManager().ShowSysMsg('MSG_CLUB_RoomCard_Not_Enough',[data.clubName,data.roomcardattention]);\r\n                },200);\r\n            }\r\n        }\r\n    },\r\n    OnClick:function(btnName, btnNode){\r\n        if('btn_create' == btnName){\r\n            if(0 != this.curRoomID){\r\n                this.SetWaitForConfirm('MSG_GO_ROOM',this.ShareDefine.Confirm,[this.curGameTypeStr]);\r\n                return;\r\n            }\r\n        \tthis.gameName='ddz';\r\n            this.FormManager.ShowForm(app.subGameName + \"_UICreatRoom\",null,this.gameName);\r\n        }else if('btn_lxc'==btnName){\r\n            if(0 != this.curRoomID){\r\n                this.SetWaitForConfirm('MSG_GO_ROOM',this.ShareDefine.Confirm,[this.curGameTypeStr]);\r\n                return;\r\n            }\r\n            this.FormManager.ShowForm(app.subGameName + \"_UIPractice\");\r\n        }\r\n        else if('btn_join' == btnName){\r\n            if(0 != this.curRoomID){\r\n                this.SetWaitForConfirm('MSG_GO_ROOM',this.ShareDefine.Confirm,[this.curGameTypeStr]);\r\n                return;\r\n            }\r\n            this.FormManager.ShowForm(app.subGameName + \"_UIJoin\");\r\n        }\r\n        else if('btn_exit' == btnName){\r\n            app[app.subGameName + \"Client\"].ExitGame();\r\n        }\r\n        else if('btn_race' == btnName){\r\n            this.ShowSysMsg(\"功能暂未开放，尽情期待！\");\r\n            // let videoData = {action:\"showVideo\", backCode:100001};\r\n            // cc.sys.localStorage.setItem(\"switchGameData\", JSON.stringify(videoData));\r\n            // app.ddz_SceneManager().LoadScene(app.subGameName + \"VideoScene\");\r\n        }\r\n        else if (\"btn_video\" == btnName) {\r\n            let videoData = {action:\"showVideo\", backCode:parseInt(this.lb_backCode.string)};\r\n            cc.sys.localStorage.setItem(\"switchGameData\", JSON.stringify(videoData));\r\n            app.ddz_SceneManager().LoadScene(app.subGameName + \"VideoScene\");\r\n        }\r\n        else{\r\n            this.ErrLog(\"OnClick(%s) not find\",btnName);\r\n        }\r\n        \r\n    },\r\n\r\n    Click_btn_goRoom:function(){\r\n        app[app.subGameName + \"Client\"].SetGameType(this.curGameTypeStr);\r\n        let event = {};\r\n        event = {};\r\n        event.roomID = this.curRoomID;\r\n        app[app.subGameName + \"Client\"].OnEvent_LoginGetCurRoomID(event);\r\n    },\r\n});"]}